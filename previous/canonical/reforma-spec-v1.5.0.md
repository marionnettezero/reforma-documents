# ReForma 統合仕様（正本） v1.5.0

## Component Manifest（この正本が参照している分類別仕様の版）

| 分類 | 参照バージョン | 参照ファイル |
|---|---|---|
| 共通仕様 | `v1.5.0` | `classified/common/reforma-common-spec-v1.5.0.json` |
| バックエンド仕様 | `v1.1.0` | `classified/backend/reforma-backend-spec-v1.1.0.json` |
| フロントエンド仕様 | `v1.1.0` | `classified/frontend/reforma-frontend-spec-v1.1.0.json` |
| API仕様 | `v1.3.0` | `classified/api/reforma-api-spec-v1.3.0.json` |
| DB仕様 | `v1.0.0` | `classified/db/reforma-db-spec-v1.0.0.json` |
| Notes/その他 | `v1.1.0` | `classified/notes/reforma-notes-v1.1.0.json` |

## 運用ルール（推奨）

- 分類別仕様（common/backend/frontend/api/db/notes）を先に更新し、バージョンを `v1.x.x` で進める。
- その後、この正本（reforma-spec）を再生成して更新する。
- 正本の更新忘れが起きても、上の Manifest から「どの分類のどの版が正本に入っているか」が追跡できる。

# 共通仕様

## COMMON-0001 reforma-common-spec-v1.2.0

- component_version: `v1.5.0`
- component_file: `classified/common/reforma-common-spec-v1.5.0.json`
- source_files: `latest/common/reforma-common-spec-v1.2.0.json`

```json
{
  "handoff_type": "frontend_to_backend",
  "project": "ReForma",
  "scope": "common_ui_and_behavior",
  "frontend_common_spec_version": "1.2",
  "mandatory_read": [
    "reforma-frontend-common-ui-spec-v1.2.json"
  ],
  "priority_rules": {
    "screen_common_spec": "highest",
    "screen_spec": "second",
    "api_spec": "third"
  },
  "key_frontend_expectations": {
    "auth_source": "/auth/me",
    "rbac": "roles[]",
    "root_only": "is_root",
    "root_only_error": {
      "status": 403,
      "errors.reason": "ROOT_ONLY"
    }
  },
  "error_handling_contract": {
    "base_error_page": "/reforma/error",
    "toast_errors": [
      400,
      403,
      409
    ],
    "page_errors": [
      500,
      503
    ],
    "debug_raw_error": "only_when_VITE_DEBUG_true"
  },
  "destructive_action_policy": {
    "confirmation_required": true,
    "root_only_additional_rule": {
      "id_input_required": true,
      "exact_match": true
    }
  },
  "file_and_async_operations": {
    "progress_required": true,
    "preferred": "progress_endpoint",
    "fallback": "indeterminate_progress"
  },
  "date_number_format_policy": {
    "api": "raw_value",
    "frontend": "format_by_locale"
  },
  "notes": [
    "Do not introduce UI-side assumptions not described in common spec.",
    "Any deviation must be discussed and reflected back into the common spec."
  ]
}
```

## COMMON-0002 reforma-common-spec-v1.3.0

- component_version: `v1.5.0`
- component_file: `classified/common/reforma-common-spec-v1.5.0.json`
- source_files: `latest/common/reforma-common-spec-v1.3.0.json`

{
  "meta": {
    "name": "ReForma Frontend Common UI Specification",
    "version": "1.3",
    "status": "final",
    "scope": "all_screens",
    "purpose": "machine_share_single_source_of_truth",
    "notes": "This file consolidates v1.1, v1.2 and v1.3 into a single definitive common UI spec."
  },

  "priority_rules": {
    "order": [
      "frontend_common_ui_spec",
      "screen_spec",
      "api_spec"
    ],
    "note": "If inconsistencies occur, frontend common UI spec has highest priority."
  },

  "i18n": {
    "policy": "All user-facing texts must be multilingual (ja/en).",
    "exception": {
      "debug_ui": "Japanese only"
    },
    "resource_path": "src/i18n/"
  },

  "display_format_rules": {
    "datetime": {
      "api": "ISO8601",
      "timezone": "explicit_or_utc",
      "frontend_display": "format_by_locale"
    },
    "number": {
      "api": "raw_value",
      "frontend_display": "locale_format_with_separators"
    },
    "id": {
      "display": "raw_value",
      "comparison": "strict_match",
      "use_case": "root_destructive_confirmation"
    }
  },

  "breadcrumbs": {
    "enabled": true,
    "label_source": "screen_name",
    "use_screen_id": false,
    "i18n": true,
    "rule": "Breadcrumb label must be identical to screen title"
  },

  "screen_title": {
    "enabled": true,
    "label_source": "screen_name",
    "i18n": true,
    "display_name_override": {
      "allowed": true,
      "key": "display_screen_name"
    },
    "layout": {
      "separator_line_required": true,
      "description_area_optional": true
    }
  },

  "layout_common": {
    "sidebar": {
      "state_persistence": "localStorage",
      "storage_key": "reforma_sidebar_collapsed",
      "collapsed_style": "icon_only",
      "motif_icon_used": true,
      "file": "src/layout/AppLayout.tsx"
    },
    "top_controls": {
      "items": ["language", "theme"],
      "collapsible": true,
      "state_persistence": "localStorage",
      "mobile_behavior": "always_collapsed",
      "file": "src/components/TopControls.tsx"
    }
  },

  "theme": {
    "modes": ["system", "light", "dark", "reforma"],
    "reforma_icon": "motif_icon",
    "tooltip_policy": "operation_based",
    "persistence": "localStorage"
  },

  "language_switch": {
    "supported_locales": ["ja", "en"],
    "display_rule": {
      "ja": "日本語 / 英語",
      "en": "JA / EN"
    },
    "icon": {
      "type": "svg_tile",
      "path": "src/assets/lang-*-tile.svg"
    }
  },

  "list_screen_common": {
    "features": [
      "search(q)",
      "pagination(page, per_page)",
      "sort(enum, default_fixed)",
      "per_page_selector"
    ],
    "url_state_sync": true,
    "api_policy": "OpenAPI v1.1 list_policy"
  },

  "empty_state": {
    "enabled": true,
    "use_case": ["initial_empty", "search_no_result"],
    "ui_policy": {
      "icon": "common",
      "message": "i18n_required",
      "action_button": "optional"
    },
    "shared_component": {
      "name": "EmptyState",
      "file": "src/components/EmptyState.tsx"
    }
  },

  "loading_indicator": {
    "enabled": true,
    "policy": {
      "initial_load": "full_screen",
      "partial_load": "inline_or_overlay"
    },
    "shared_component": {
      "name": "LoadingOverlay",
      "file": "src/components/LoadingOverlay.tsx"
    }
  },

  "screen_guard": {
    "enabled": true,
    "auth_source": "/auth/me",
    "rbac_key": "roles[]",
    "root_only_key": "is_root",
    "guards": {
      "role": {
        "component": "RequireRole",
        "file": "src/guards/RequireRole.tsx"
      },
      "root_only": {
        "component": "RequireRoot",
        "file": "src/guards/RequireRoot.tsx"
      }
    },
    "policy": "Guard must be evaluated before API call and rendering"
  },

  "form_validation_error": {
    "enabled": true,
    "policy": {
      "display_position": "field_bottom",
      "one_message_per_field": true,
      "i18n_required": true,
      "api_422_mapping": true
    },
    "shared_component": {
      "name": "FormError",
      "file": "src/components/FormError.tsx"
    }
  },

  "api_error_handling": {
    "enabled": true,
    "base_error_page": "/reforma/error",
    "display_policy": {
      "toast": ["400", "403", "409"],
      "error_page": ["500", "503"],
      "root_only": {
        "condition": "errors.reason=ROOT_ONLY",
        "message_type": "dedicated"
      }
    },
    "debug_policy": {
      "when_debug": "show_raw_error_in_debug_ui",
      "otherwise": "hide_raw_error"
    },
    "shared_handler": {
      "name": "apiErrorHandler",
      "file": "src/utils/apiErrorHandler.ts"
    }
  },

  "success_notification": {
    "enabled": true,
    "policy": {
      "display_type": "toast",
      "frequency": "once_per_action",
      "message_style": "short_operation_form",
      "i18n_required": true
    },
    "shared_component": {
      "name": "ToastProvider",
      "file": "src/components/ToastProvider.tsx"
    }
  },

  "destructive_action_confirmation": {
    "enabled": true,
    "base_policy": {
      "dialog_required": true,
      "danger_style": true,
      "default_text": {
        "title": "confirm_delete",
        "description": "irreversible_operation"
      }
    },
    "root_only_additional_policy": {
      "id_input_required": true,
      "input_match_rule": "target_id_exact_match"
    },
    "shared_component": {
      "name": "ConfirmDialog",
      "file": "src/components/ConfirmDialog.tsx"
    }
  },

  "file_operation_progress": {
    "enabled": true,
    "target_operations": ["csv_export", "csv_import", "pdf_generate", "file_upload"],
    "display_policy": {
      "on_start": "loading_overlay",
      "progress_type": "progress_bar",
      "completion": {
        "success": "toast",
        "failure": "api_error_handling"
      }
    },
    "progress_source": {
      "preferred": "api_progress_endpoint",
      "fallback": "indeterminate_progress"
    },
    "shared_component": {
      "name": "ProgressOverlay",
      "file": "src/components/ProgressOverlay.tsx"
    }
  },

  "inline_help_text": {
    "enabled": true,
    "display_position": "below_screen_title",
    "style_policy": {
      "font_size": "small",
      "color": "muted",
      "icon_optional": true
    },
    "i18n_required": true
  },

  "tooltip_policy": {
    "style": "operation_based",
    "i18n_required": true
  },


## COMMON-0003 reforma-common-spec-v1.3.0

- component_version: `v1.5.0`
- component_file: `classified/common/reforma-common-spec-v1.5.0.json`
- source_files: `latest/common/reforma-common-spec-v1.3.0.md`

# ReForma フロントエンド 共通画面仕様 v1.3（確定版）

本書は ReForma フロントエンドにおける **全画面共通仕様の最終確定版** である。
v1.1 / v1.2 の内容をすべて統合している。

---

## 優先順位
画面挙動の優先順位は以下とする。

1. 共通画面仕様（本書 v1.3）
2. 画面仕様書
3. API仕様書

---

## 表示フォーマットの前提（宣言）

### 日時
- API：ISO8601（UTC または明示TZ）
- 表示：フロントエンドで locale に応じて整形

### 数値
- API：生値
- 表示：桁区切り等はフロントエンドで付与

### ID
- 表示：そのまま表示
- 比較：完全一致
- root 削除確認時の入力比較に使用

---

## 多言語化
- 全文言は多言語対応（ja/en）
- デバッグUIのみ日本語固定

---

## パンくず・画面タイトル
- 画面名を表示（画面IDは使用しない）
- パンくずと画面タイトルは同一文言
- 多言語対応
- タイトル下に区切り線、補足情報を表示可能

---

## レイアウト共通
### 左サイドバー
- 開閉状態は localStorage に保存
- 折りたたみ時はアイコン中心
- ReForma モチーフアイコンを使用

### 右上パネル（言語 / テーマ）
- 折りたたみ可能
- モバイルでは常時折りたたみ
- 言語表示：
  - 日本語UI：日本語 / 英語
  - 英語UI：JA / EN

---

## 一覧画面
- 検索 / ページング / 並び順 / 表示件数
- URL と状態同期
- OpenAPI v1.1 list_policy 準拠

---

## 空状態（Empty State）
- データ0件時は必ず表示
- 初期状態と検索結果なしを区別

---

## ローディング・進捗
- 初回ロード：全体ローディング
- 再取得：部分ローディング
- CSV / PDF 等はプログレスバーで進捗表示

---

## フォームエラー
- フィールド直下に表示
- API 422 と統合

---

## APIエラー（非422）
- 基本エラーページ：`/reforma/error`
- 400/403/409：トースト
- 500/503：エラーページ
- ROOT_ONLY：専用文言

---

## 成功通知
- トースト1回
- 短い操作形文言

---

## 破壊的操作（削除等）
- 確認ダイアログ必須
- root 権限操作では **対象IDの入力必須**

---

## 画面ガード
- 描画・API前に権限制御
- `/auth/me` を正本とする

---

## デバッグUI
- `VITE_DEBUG=true` のとき表示
- 画面下部に集約
- 文言は日本語のみ

---

以上。


## COMMON-0004 reforma-common-spec-v1.5.0

- component_version: `v1.5.0`
- component_file: `classified/common/reforma-common-spec-v1.5.0.json`
- source_files: `latest/common/reforma-common-spec-v1.5.0.json`

```json
{
  "meta": {
    "name": "ReForma Frontend Common UI Specification",
    "version": "1.5-updated",
    "status": "final",
    "generated_at": "2026-01-14T07:02:22Z",
    "supersedes": "1.5",
    "single_source_of_truth": true,
    "precedence": [
      "common_ui_spec_v1.5",
      "screen_spec",
      "api_spec"
    ],
    "policy": {
      "no_unwritten_assumptions": true,
      "api_adjustment_allowed_for_ui": true
    }
  },
  "auth_and_authorization": {
    "source_of_truth_endpoint": "/v1/auth/me",
    "fields": {
      "rbac_roles": "roles[]",
      "root_only_flag": "is_root"
    },
    "ui_decision_rules": [
      "UIは roles[] を正本として機能の表示/活性/操作可否を決定する",
      "UIは is_root を正本として root-only 操作の表示/活性/操作可否を決定する（最終防御はAPI）"
    ]
  },
  "api_base_configuration": {
    "env": {
      "VITE_API_BASE": "/reforma/api/",
      "VITE_API_VERSION": "v1"
    },
    "rule": "API URL は VITE_API_BASE + VITE_API_VERSION を結合したものを正とする"
  },
  "error_handling": {
    "normalized_envelope": {
      "authoritative_keys": {
        "classification": "code",
        "machine_reason": "errors.reason",
        "display_message": "message",
        "deprecated": [
          "errors.code"
        ]
      },
      "root_only_contract": {
        "http_status": 403,
        "errors_reason": "ROOT_ONLY",
        "must_distinguish_from_generic_403": true
      }
    },
    "navigation_policy": {
      "by_http_status": {
        "401": "redirect:/login",
        "404": "page:/reforma/not-found",
        "422": "inline-validation",
        "400": "toast",
        "403": "toast",
        "409": "toast",
        "429": "toast",
        "500": "page:/reforma/error",
        "503": "page:/reforma/error"
      },
      "rule": "画面遷移の正本は HTTP ステータス。code / errors.reason は補助判断に用いる"
    },
    "debug_ui": {
      "enabled_when": "VITE_DEBUG=true",
      "visible_fields_minimum": [
        "request_id",
        "endpoint",
        "errors.reason"
      ],
      "optional_fields": [
        "http_status",
        "code",
        "method",
        "timestamp"
      ],
      "raw_error_hidden_in_normal_ui": true
    }
  },
  "destructive_actions": {
    "confirm_dialog_required": true,
    "root_only_delete": {
      "frontend_id_confirmation": {
        "required": true,
        "match_rule": "完全一致（ID生値同士で比較）"
      },
      "backend_requirement": {
        "authorization": "root-only を必須（policyで担保）",
        "id_confirmation": "必須ではない（UI安全装置として扱う）"
      }
    }
  },
  "progress_and_exports": {
    "progress": {
      "endpoint": "/v1/progress/{job_id}",
      "expired_behavior": {
        "http_status": 404,
        "ui": "期限切れ表示（Not Found 画面内で説明）",
        "retry": "再実行導線を表示してよい"
      }
    },
    "exports": {
      "allow_resign_after_url_expired": true,
      "pdf_regeneration_policy": {
        "separate_regenerate_api": false,
        "regenerate_method": "元の生成開始APIを再実行（新job）",
        "note": "再署名(resign)と再生成(regenerate)を区別する"
      }
    }
  },
  "data_format_rules": {
    "datetime": {
      "api": "ISO8601（UTCまたはTZ明示）",
      "ui": "表示整形はフロント"
    },
    "number": {
      "api": "生値",
      "ui": "表示整形はフロント"
    },
    "id": {
      "display": "生値",
      "comparison": "完全一致"
    }
  },
  "user_attributes": {
    "exposed_in": [
      "/v1/auth/me",
      "/v1/system/admin-users (list)",
      "/v1/system/admin-users/{id} (detail)"
    ],
    "fields": {
      "is_root": "boolean",
      "form_create_limit_enabled": "boolean",
      "form_create_limit": {
        "type": "integer|null",
        "constraint": "enabled=true の場合 min=1（0は禁止）"
      }
    },
    "edit_location": "S-02 アカウント編集UI"
  },
  "change_log": [
    {
      "version": "1.5",
      "date": "2026-01-14",
      "changes": [
        "progress job TTL 超過時の UI 挙動（期限切れ表示）を明記",
        "PDF 再生成は当面別APIを作らない方針を明記",
        "画面遷移の正本を HTTP ステータスに統一",
        "Debug UI の最小表示項目を確定",
        "root-only 削除の ID 入力はフロント強制・認可は backend に限定"
      ]
    },
    {
      "version": "1.5-updated",
      "date": "2026-01-14",
      "changes": [
        "toast 表示文言の優先順位（message > errors.reason > code）を明記"
      ]
    }
  ],
  "ui_requirements": {
    "toast_message_priority": {
      "priority": [
        "message",
        "errors.reason",
        "code"
      ],
      "rule": "Toast 表示は message を最優先。message が無い場合に errors.reason を補助表示し、それも無い場合は code をフォールバックとして使用する。",
      "notes": [
        "errors.reason は機械判定が主用途。表示は ROOT_ONLY 等の限定ケースに留める。",
        "raw error（stack 等）は toast に表示しない。Debug UI のみで表示する。"
      ]
    }
  }
}
```

## COMMON-0005 reforma-common-spec-v1.5.0

- component_version: `v1.5.0`
- component_file: `classified/common/reforma-common-spec-v1.5.0.json`
- source_files: `latest/common/reforma-common-spec-v1.5.0.md`

# ReForma 画面共通仕様 v1.5-updated

本書は **画面共通仕様 v1.5** に、toast 表示文言の優先順位を明記した更新版です。

## Toast 表示文言の優先順位（確定）

Toast 表示は以下の優先順位で文言を決定する。

1. **`message`（最優先）**
2. **`errors.reason`（補助表示）**
3. **`code`（最終フォールバック）**

### 運用ルール
- `errors.reason` は機械判定が主用途。表示は ROOT_ONLY 等の限定ケースに留める。
- raw error（stack trace 等）は toast に表示しない。
- raw error の表示は Debug UI（`VITE_DEBUG=true`）に限定する。

### 擬似コード例

```ts
const toastText =
  error.message
  ?? mapReason(error.errors?.reason)
  ?? mapCode(error.code)
  ?? "処理に失敗しました";
```

## 変更履歴
- v1.5-updated (2026-01-14): toast 表示文言の優先順位を明記


# バックエンド仕様

## BACKEND-0001 reforma-backend-spec-v1.0.0-Backend-共有テンプレ-.json

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.0.0-Backend-共有テンプレ-.json.json`

```json
{
  "meta": {
    "title": "ReForma 開発チャット共有テンプレ（バックエンド）",
    "version": "1.0",
    "generated_at": "2026-01-12T16:56:01.989787",
    "timezone": "Asia/Tokyo",
    "target": "Laravel 12 Backend"
  },
  "paste_template": {
    "sections": [
      {
        "title": "前提",
        "body": [
          "本チャットは ReForma バックエンド（Laravel 12）実装フェーズの継続です。仕様の再検討はしません。",
          "正本仕様に従い「API実装」「条件分岐（A-06）評価」「ACK/PDF/通知/検索/権限」を実装に落とします。"
        ]
      },
      {
        "title": "正本仕様（必ず前提）",
        "body": [
          "01.ReForma-basic-spec-v1.1-consolidated.final.json",
          "02.ReForma-screen-spec-v1.1-consolidated.json",
          "03.ReForma-api-spec-v1.1-consolidated.json",
          "04.ReForma-db-spec-v1.1-consolidated.json",
          "05.ReForma-extension-spec-v1.1-consolidated.json",
          "condition-ui-spec-v1.0.json",
          "form-feature-attachments-v1.1.json（A-06が条件分岐の正本）",
          "form-feature-spec-v1.0.complete.json"
        ]
      },
      {
        "title": "重要な設計原則（厳守）",
        "body": [
          "条件分岐ルール正本は Attachments v1.1 / A-06",
          "UI は and/or を必ず明示（暗黙優先順位なし）",
          "評価不能時は安全側（非表示／必須解除／遷移不可）",
          "UIとAPIの二重防御（APIで最終確定）",
          "v1.x では条件ネスト 1段まで"
        ]
      },
      {
        "title": "今回の実装対象（APIカテゴリ）",
        "body": [
          "7.1 Auth",
          "7.2 Forms",
          "7.3 Submissions / Responses",
          "7.4 ACK / PDF",
          "7.7 Dashboard",
          "7.8 System Admin（SUP + root-only）"
        ]
      },
      {
        "title": "既に作成済みの成果物（このチャット生成物）",
        "body": [
          "openapi-reforma-v1.1-full.yaml / openapi-reforma-v1.1-full.json",
          "ReForma_Laravel12_最小実装設計_OpenAPIv1.1-full.json",
          "ReForma_条件分岐_評価結果IF_v1.0.json / .pdf"
        ]
      },
      {
        "title": "バックエンド側でまずやること（優先順）",
        "body": [
          "OpenAPI v1.1-full を source-of-truth として Laravel のルーティング/Controller/FormRequest/Service を起こす",
          "ConditionEvaluator（A-06）実装（安全側フォールバック、max_nesting=1）",
          "公開 submit / ack / 管理 responses / pdf を通す（E2E可能にする）",
          "RBAC（System Admin / Form Admin / Log Admin / root-only）を Gate/Policy で固定"
        ]
      },
      {
        "title": "出力してほしいもの",
        "body": [
          "実装雛形コード（Laravel 12）: routes/controllers/requests/services/policies/jobs/migrations",
          "APIのエラーレスポンス統一（envelope + code + fields/step/rule）",
          "ConditionState をレスポンスに載せる（公開submitなど）"
        ]
      }
    ]
  },
  "attachments_to_share": {
    "must_include": [
      {
        "file": "openapi-reforma-v1.1-full.yaml",
        "path": "sandbox:/mnt/data/openapi-reforma-v1.1-full.yaml",
        "purpose": "OpenAPI（実装可能な粒度）"
      },
      {
        "file": "openapi-reforma-v1.1-full.json",
        "path": "sandbox:/mnt/data/openapi-reforma-v1.1-full.json",
        "purpose": "OpenAPI（JSON版）"
      },
      {
        "file": "ReForma_Laravel12_最小実装設計_OpenAPIv1.1-full.json",
        "path": "sandbox:/mnt/data/ReForma_Laravel12_最小実装設計_OpenAPIv1.1-full.json",
        "purpose": "Laravel最小実装設計（routes/controllers/requests/services/policies/jobs）"
      },
      {
        "file": "ReForma_条件分岐_評価結果IF_v1.0.json",
        "path": "sandbox:/mnt/data/ReForma_条件分岐_評価結果IF_v1.0.json",
        "purpose": "ConditionState I/F（API→UI）"
      },
      {
        "file": "ReForma_条件分岐_評価結果IF_v1.0.pdf",
        "path": "sandbox:/mnt/data/ReForma_条件分岐_評価結果IF_v1.0.pdf",
        "purpose": "ConditionState I/F（PDF）"
      }
    ],
    "reference_specs": [
      "03.ReForma-api-spec-v1.1-consolidated.json（カテゴリ一覧）",
      "04.ReForma-db-spec-v1.1-consolidated.json（テーブル/関係/スナップショット）",
      "form-feature-attachments-v1.1.json（A-06 条件分岐）"
    ]
  }
}
```

## BACKEND-0002 reforma-backend-spec-v1.0.0-backend-chat-init.json

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.0.0-backend-chat-init.json.json`

```json
{
  "purpose": "ReForma Backend 開発チャット初期共有テンプレ",
  "role": "Backend single source of truth",
  "references": {
    "specs": [
      "01.ReForma 基本仕様書 v1.0",
      "02.ReForma 画面仕様書 v1.0",
      "03.ReForma API 仕様書 v1.0",
      "04.ReForma DB 仕様書 v1.0",
      "05.ReForma 拡張仕様書 v1.0 (+v1.1)",
      "06.ReForma React 運用・画面UI仕様書 v0.3"
    ],
    "sup": "ReForma Frontend 補足仕様（SUP-FE）【統合・最新版】"
  },
  "admin_users": {
    "invite": {
      "token": {
        "ttl_hours": 72,
        "single_use": true,
        "resend_new_token": true
      },
      "status": [
        "invited",
        "active",
        "disabled"
      ]
    },
    "security": {
      "password_policy": "admin/respondent 共通・設定変更可",
      "lock_policy": "失敗回数・ロック時間とも設定変更可",
      "session_ttl": "設定変更可"
    },
    "root_admin": {
      "seeded": true,
      "immutable": [
        "disable",
        "delete"
      ]
    }
  },
  "respondent": {
    "model": "hybrid",
    "profile": {
      "email": "nullable unique",
      "external_ref": "unique"
    },
    "flow": "login or register -> email verify -> redirect to form"
  }
}
```

## BACKEND-0003 補足仕様: API パス構成の正規化（/api 重複排除）

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.0.0.json`

```json
{
  "rule": "External base /reforma/api/ + Laravel prefix /v1 => /reforma/api/v1/...",
  "implementation": {
    "laravel_routes_prefix": "/v1 (no /api prefix)",
    "apache_alias": "/reforma/api/ -> backend/public/"
  }
}
```

## BACKEND-0004 補足仕様: httpd（Apache）既存マウント構成への準拠

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.0.0.json`

```json
{
  "react_mount": "/reforma/ -> frontend/dist/",
  "api_mount": "/reforma/api/ -> backend/public/",
  "app_url_recommended": "https://<host>/reforma/api",
  "notes": [
    "Keep Laravel standard .htaccess rewrite",
    "Avoid trailing slash mismatches in APP_URL"
  ]
}
```

## BACKEND-0005 補足仕様: セッション無効（401/419）扱い

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.0.0.json`

```json
{
  "frontend": "401/419 => /logout?reason=session_invalid, invalidate state",
  "backend": [
    "401 for unauth",
    "419 may occur for CSRF/session; normalize to envelope"
  ]
}
```

## BACKEND-0006 推奨案（初期実装のベースライン提案）

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.0.0.json`

```json
{
  "auth_admin": {
    "method": "Sanctum PAT",
    "ttl_days": 30,
    "rolling_extension": "once_per_day",
    "expired_code": "TOKEN_EXPIRED"
  },
  "auth_respondent": {
    "method": "session-based",
    "confirm_url_auth": "token-based"
  },
  "queue": {
    "driver": "database",
    "dlq": "failed_jobs",
    "retries": {
      "tries": 5,
      "backoff_seconds": [
        60,
        300,
        900
      ]
    }
  },
  "pdf": {
    "storage": {
      "default": "s3",
      "fallback": "local"
    },
    "regeneration": "snapshot source, default no-regenerate, admin explicit regenerate with audit"
  },
  "confirm_url": {
    "types": {
      "confirm_submission": {
        "ttl": "24h",
        "one_time": true
      },
      "ack_action": {
        "ttl": "24h",
        "one_time": true
      },
      "view_pdf": {
        "ttl": "7d",
        "one_time": false
      }
    },
    "token_storage": "hash only in DB"
  },
  "settings": {
    "store": "DB settings table",
    "scope": "system",
    "ui": "future"
  }
}
```

## BACKEND-0007 確定事項（Backend 追加前提・2026-01-12）

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.0.0.json`

```json
{
  "settings_scope": "system fixed",
  "pdf_storage": "S3 default, switchable to local",
  "respondent_scope": "browser may cross forms",
  "confirm_url_view_pdf_one_time": "default false, configurable"
}
```

## BACKEND-0008 reforma-backend-spec-v1.1.0

- component_version: `v1.1.0`
- component_file: `classified/backend/reforma-backend-spec-v1.1.0.json`
- source_files: `latest/backend/reforma-backend-spec-v1.1.0.json`

```json
{
  "meta": {
    "title": "ReForma Backend 共有テンプレ（追補反映）",
    "version": "1.1",
    "generated_at": "2026-01-13T01:08:32.431777",
    "timezone": "Asia/Tokyo"
  },
  "paste_template": {
    "sections": [
      {
        "title": "前提",
        "body": [
          "本チャットは ReForma バックエンド（Laravel 12）実装フェーズの継続。仕様の再検討はしない。",
          "正本仕様＋追補パッチに従い API/条件分岐/表示モード/テーマ/計算フィールド を実装に落とす。"
        ]
      },
      {
        "title": "正本仕様（必ず前提）",
        "body": [
          "01.ReForma-basic-spec-v1.1-consolidated.final.json",
          "03.ReForma-api-spec-v1.1-consolidated.json",
          "04.ReForma-db-spec-v1.1-consolidated.json",
          "form-feature-attachments-v1.1.json（A-06 条件分岐 正本）",
          "form-feature-spec-v1.0.complete.json"
        ]
      },
      {
        "title": "追補（本チャットで追加：必ず反映）",
        "body": [
          "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json（表示モード/テーマ/計算フィールド）",
          "テーマ分離: 公開フォームテーマは管理画面テーマに追従しない（フォーム設定 theme_id/theme_tokens のみ適用）"
        ]
      },
      {
        "title": "実装原則",
        "body": [
          "UIとAPIの二重防御（最終確定はAPI）",
          "評価不能時は安全側（非表示／必須解除／遷移不可／計算は空・保存しない等）",
          "v1.x：条件ネスト1段、計算依存も循環禁止・深い依存グラフ禁止",
          "保存の正は value、label はスナップショット（表示モード追補）"
        ]
      },
      {
        "title": "今回の実装対象（APIカテゴリ）",
        "body": [
          "7.1 Auth / 7.2 Forms / 7.3 Responses / 7.4 ACK/PDF / 7.7 Dashboard / 7.8 System Admin（SUP + root-only）"
        ]
      },
      {
        "title": "出力してほしいもの",
        "body": [
          "Laravel 12 雛形コード（routes/controllers/requests/services/policies/jobs/migrations）",
          "RuleValidator: A-06 + computed_rule の妥当性検証（参照存在/型/循環/制限）",
          "Submit: ConditionEvaluator + ComputedEvaluator を実行して確定値を保存（クライアント計算値は信用しない）"
        ]
      }
    ]
  },
  "attachments_to_share": {
    "must_include": [
      {
        "file": "openapi-reforma-v1.1-full.yaml",
        "path": "sandbox:/mnt/data/openapi-reforma-v1.1-full.yaml",
        "purpose": "OpenAPI（実装参照）"
      },
      {
        "file": "ReForma_Laravel12_最小実装設計_OpenAPIv1.1-full.json",
        "path": "sandbox:/mnt/data/ReForma_Laravel12_最小実装設計_OpenAPIv1.1-full.json",
        "purpose": "Laravel最小設計"
      },
      {
        "file": "ReForma_条件分岐_評価結果IF_v1.0.json",
        "path": "sandbox:/mnt/data/ReForma_条件分岐_評価結果IF_v1.0.json",
        "purpose": "ConditionState I/F"
      },
      {
        "file": "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
        "path": "sandbox:/mnt/data/ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
        "purpose": "追補パッチ（テーマ分離含む）"
      }
    ]
  }
}
```

# フロントエンド仕様

## FRONTEND-0001 メタデータ

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "meta",
  "title": "メタデータ",
  "blocks": [
    {
      "type": "kv",
      "items": {
        "document_name": "ReForma React 運用・画面UI仕様書",
        "target": "React（Vite/TS）フロントエンド（管理画面 + 公開フォーム関連）",
        "source_of_truth": "仕様書JSON（画面仕様書JSONの ui: fields/actions/columns 等）"
      }
    },
    {
      "type": "list",
      "title": "バージョン運用",
      "items": [
        "修正時はリビジョン（patch）のみインクリメント",
        "マイナー/メジャーはユーザー指示で変更",
        "例: v0.2.x 継続 → 次工程を v0.3.x"
      ]
    },
    {
      "type": "list",
      "title": "成果物提供方針",
      "items": [
        "通常: diff zip（変更/追加ファイルのみ）",
        "指定時: フル zip"
      ]
    }
  ]
}
```

## FRONTEND-0002 前提とスコープ

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "scope",
  "title": "前提とスコープ",
  "blocks": [
    {
      "type": "list",
      "title": "前提",
      "items": [
        "UI は Tailwind CSS を使用",
        "SPA（React Router）",
        "画面仕様書JSONを正として自動描画（共通レンダラ）",
        "Storybook 自動生成 + Playwright VRT（スナップショット比較）",
        "言語/テーマは cookie 優先（無ければブラウザ言語/OS設定）"
      ]
    },
    {
      "type": "list",
      "title": "スコープ",
      "items": [
        "管理画面（ログイン/ログアウト/ダッシュボード/一覧/詳細）",
        "公開フォーム（U-01）",
        "Debug UI（仕様書準拠の補足情報表示）"
      ]
    }
  ]
}
```

## FRONTEND-0003 環境・デプロイ前提

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "env_deploy",
  "title": "環境・デプロイ前提",
  "blocks": [
    {
      "type": "kv",
      "title": "サーバ環境（参考）",
      "items": {
        "os": "Red Hat Enterprise Linux release 10.1 (Coughlan)",
        "httpd": "2.4.63-4",
        "php": "8.3.26-1",
        "mysql": "8.4.7-1",
        "aurora_mysql": "3.08.2"
      }
    },
    {
      "type": "list",
      "title": "Apache マウント構成",
      "items": [
        "React SPA: /reforma/ → /var/www/reforma/frontend/dist/",
        "Laravel API: /reforma/api/ → /var/www/reforma/backend/public/",
        "SPA fallback: /reforma/* は index.html に rewrite（/reforma/api/* は除外）"
      ]
    }
  ]
}
```

## FRONTEND-0004 設定ファイル（.env）

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "dotenv",
  "title": "設定ファイル（.env）",
  "blocks": [
    {
      "type": "list",
      "title": "ファイル構成",
      "items": [
        ".env（デフォルト）",
        ".env.stg（staging: 3文字表記）",
        ".env.prd（production: 3文字表記）",
        ".env.example"
      ]
    },
    {
      "type": "kv",
      "title": "デフォルト値（例）",
      "items": {
        "VITE_ENV": "local",
        "VITE_BASE": "/reforma/",
        "VITE_API_BASE": "/reforma/api",
        "VITE_COPYRIGHT_OWNER": "ReForma",
        "VITE_COPYRIGHT_SINCE": "2026",
        "VITE_DEBUG": "true|false"
      }
    },
    {
      "type": "list",
      "title": "参照ルール",
      "items": [
        "vite build は mode に応じて .env.<mode> を参照",
        "STG ビルドは vite build --mode stg を使用"
      ]
    }
  ]
}
```

## FRONTEND-0005 共通UI: 言語と表示モード

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "prefs",
  "title": "共通UI: 言語と表示モード",
  "blocks": [
    {
      "type": "object",
      "title": "言語",
      "value": {
        "supported": [
          "ja",
          "en"
        ],
        "toggle_label": {
          "ja_ui": "日 / 英",
          "en_ui": "JA / EN"
        },
        "priority": [
          "cookie",
          "browser_language"
        ]
      }
    },
    {
      "type": "object",
      "title": "表示モード（テーマ）",
      "value": {
        "modes": [
          "system",
          "light",
          "dark",
          "reforma"
        ],
        "behavior": {
          "system": "prefers-color-scheme に追従",
          "light": "Tailwind 公式配色準拠",
          "dark": "Tailwind 公式配色準拠",
          "reforma": "旧黒背景の ReForma テーマ"
        },
        "storage": "cookie",
        "ui": "segmented control（選択状態が明確）"
      }
    },
    {
      "type": "list",
      "title": "右上固定パネル",
      "items": [
        "言語/表示モード切替は右上固定パネル",
        "設定系ボタンは同パネルに追加",
        "全画面共通で利用"
      ]
    }
  ]
}
```

## FRONTEND-0006 ヘッダ / サイドバー / パンくず

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "layout",
  "title": "ヘッダ / サイドバー / パンくず",
  "blocks": [
    {
      "type": "list",
      "title": "ヘッダ",
      "items": [
        "ロゴ過多を避ける",
        "表示タイトルは title タグ文言を利用（言語切替に追従）"
      ]
    },
    {
      "type": "object",
      "title": "title タグ（全画面共通）",
      "value": {
        "ja": "ReForma（リフォルマ）- Flexible Form Management Platform",
        "other": "ReForma - Flexible Form Management Platform"
      }
    },
    {
      "type": "object",
      "title": "Breadcrumb（推奨）",
      "value": {
        "purpose": "現在地の把握",
        "pc": "ホーム / セクション / 画面名",
        "mobile": "省略（画面名中心）",
        "source": "画面仕様書の screen_id / label（定義は attachments 化可能）"
      }
    },
    {
      "type": "object",
      "title": "サイドバー",
      "value": {
        "pc": "常時表示",
        "mobile": "Drawer（ハンバーガーで開閉）",
        "copyright": "ログイン以外はサイドバー下部"
      }
    }
  ]
}
```

## FRONTEND-0007 画面仕様（主要）

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "screens",
  "title": "画面仕様（主要）",
  "blocks": [
    {
      "type": "object",
      "title": "A-01 ログイン画面",
      "value": {
        "top_right_panel": "言語/表示モード",
        "fields": [
          {
            "key": "login_id_email",
            "label": "ログイン ID（メールアドレス）"
          },
          {
            "key": "password",
            "label": "パスワード",
            "password_toggle": true
          }
        ],
        "layout": "縦並び（モバイル前提）",
        "validation": [
          "required",
          "email_format"
        ],
        "login_failed_message": "i18n 文言で表示",
        "from_ux": "state.from があれば戻り先案内（debugで詳細）",
        "footer": {
          "rule": "since〜現在年（同一年なら単年）",
          "owner_env": "VITE_COPYRIGHT_OWNER",
          "since_env": "VITE_COPYRIGHT_SINCE"
        }
      }
    },
    {
      "type": "object",
      "title": "A-02 ログアウト",
      "value": {
        "confirm_dialog": {
          "buttons": [
            "OK",
            "Cancel"
          ]
        }
      }
    },
    {
      "type": "object",
      "title": "ダッシュボード（ログイン後）",
      "value": {
        "id_rule": "screen_id ベース",
        "button_visibility": "light/dark/reforma で視認性確保",
        "layout": "メインはフル幅（右ペイン幅制限しない）"
      }
    },
    {
      "type": "object",
      "title": "一覧系（テーブル/カード）",
      "value": {
        "pc": "table",
        "mobile": "cards",
        "order": "actions は仕様書JSONの順序通り"
      }
    }
  ]
}
```

## FRONTEND-0008 Spec-driven 共通レンダラ

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "renderer",
  "title": "Spec-driven 共通レンダラ",
  "blocks": [
    {
      "type": "list",
      "title": "原則",
      "items": [
        "ui.fields / ui.actions / ui.columns を仕様書順で描画",
        "手書きUIを減らしデグレを防ぐ"
      ]
    },
    {
      "type": "list",
      "title": "レンダリング対象",
      "items": [
        "fields",
        "actions",
        "columns",
        "blocks（role別含む）"
      ]
    },
    {
      "type": "list",
      "title": "例外",
      "items": [
        "A-01 など UX が強い画面は spec を尊重しつつ手書き補強を許容"
      ]
    }
  ]
}
```

## FRONTEND-0009 Debug UI

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "debug_ui",
  "title": "Debug UI",
  "blocks": [
    {
      "type": "list",
      "title": "表示条件",
      "items": [
        "VITE_DEBUG=true で有効",
        "query(debug=1) は補助（最終判断は env）"
      ]
    },
    {
      "type": "list",
      "title": "表示内容",
      "items": [
        "screen_id / screen_key",
        "権限ロール/アクセス可否",
        "仕様書JSON抜粋（折り畳み + pre 整形）",
        "copy ボタン（JSON/画面情報）",
        "UI: Tailwind / Spec: JSON v1.0 は Debug UI に集約"
      ]
    },
    {
      "type": "list",
      "title": "見た目",
      "items": [
        "通常UIと区別できる枠/背景"
      ]
    }
  ]
}
```

## FRONTEND-0010 QA / 自動化

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "qa",
  "title": "QA / 自動化",
  "blocks": [
    {
      "type": "list",
      "title": "Spec Lint / Schema Validation",
      "items": [
        "npm run spec:lint で仕様書JSON検証",
        "スキーマは attachments 化可能（例: src/specs/schema.json）"
      ]
    },
    {
      "type": "list",
      "title": "Storybook 自動生成",
      "items": [
        "storybook:gen で仕様書更新→生成",
        "predev / prebuild で spec 変更時に自動生成（差分検知: SPEC_UNCHANGED 等）"
      ]
    },
    {
      "type": "list",
      "title": "Playwright VRT",
      "items": [
        "初回は --update-snapshots で snapshot 生成",
        "以降は差分検知"
      ]
    },
    {
      "type": "list",
      "title": "警告対応ポリシー",
      "items": [
        "重大（ビルド/実行阻害・セキュリティ）: 優先対応",
        "非重大（deprecation 等）: 影響評価の上、計画的に対応"
      ]
    }
  ]
}
```

## FRONTEND-0011 コマンド運用（ローカル/サーバ）

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "ops_commands",
  "title": "コマンド運用（ローカル/サーバ）",
  "blocks": [
    {
      "type": "list",
      "title": "展開〜反映（例）",
      "items": [
        "cd /var/www/reforma/frontend",
        "unzip -o <zip-file> -d ."
      ]
    },
    {
      "type": "list",
      "title": "クリーンインストール",
      "items": [
        "rm -rf node_modules dist .vite",
        "npm ci（lock あり） / npm install"
      ]
    },
    {
      "type": "list",
      "title": "ビルド（STG）",
      "items": [
        "npm run build:stg"
      ]
    },
    {
      "type": "list",
      "title": "Podman（Playwright）",
      "items": [
        "RHEL では apt-get が無いため Playwright の依存導入は Podman 前提",
        "コンテナ導入〜実行手順は運用手順として追記対象"
      ]
    }
  ]
}
```

## FRONTEND-0012 attachments（後で分離するもの）

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.3.0.json`

```json
{
  "id": "attachments",
  "title": "attachments（後で分離するもの）",
  "blocks": [
    {
      "type": "attachments_index",
      "items": [
        {
          "key": "screen_spec_json",
          "description": "画面仕様書JSON（screen registry / ui schema）"
        },
        {
          "key": "json_schema",
          "description": "JSON Schema（Ajv 用）"
        },
        {
          "key": "breadcrumb_map",
          "description": "画面ID・パンくず階層定義"
        },
        {
          "key": "roles",
          "description": "role 定義（system_admin / form_admin / operator / viewer / public 等）"
        },
        {
          "key": "i18n_dict",
          "description": "i18n 文言辞書（ja/en）"
        },
        {
          "key": "supplement_spec_v1",
          "description": "補足仕様書 v1.0（パスワード表示ボタン必須、debug 表示仕様 等）"
        }
      ]
    }
  ]
}
```

## FRONTEND-0013 reforma-frontend-spec-v0.5.8-frontend-handoff-.json

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.5.8-frontend-handoff-.json.json`

```json
{
  "metadata": {
    "project": "ReForma",
    "component": "frontend-react",
    "handoff_title": "ReForma React 引き継ぎパック（v0.5.8 時点）",
    "generated_at": "2026-01-14T00:19:22.141465+09:00",
    "timezone": "Asia/Tokyo",
    "language": "ja",
    "status": "active",
    "notes": [
      "このJSONは新しいChatGPTチャットに貼り付け・添付して使う機械共有用。",
      "フルZIPがダウンロード不可になる事象が発生したため、以後は差分ZIP運用を基本とし、フルZIPはユーザー側でバックアップ生成する方針も併記。"
    ]
  },
  "baseline": {
    "source_of_truth_version": "0.5.8",
    "baseline_source": "ユーザー環境に適用済みの v0.5.8 相当（v0.4.12.3 + v0.5.x 差分適用）",
    "previous_baseline_zip": "reforma-react-v0.4.12.3.zip",
    "package_version_required": true,
    "build_log_expected_prefix": "reforma-react@0.5.8",
    "zip_distribution_constraints": {
      "default": "diff_zip_only",
      "full_zip": "依頼時のみ（ただしダウンロード制限が起きる可能性あり）",
      "diff_zip_structure_rule": "トップディレクトリを含めず、プロジェクト直下に上書き展開できる構造（例: src/, package.json 等が直に入る）"
    }
  },
  "delivery_rules": {
    "versioning": {
      "must_update_package_json_version_each_release": true,
      "must_match_build_output": true
    },
    "zip_apply_commands": {
      "no_path_prefix_rule": "コマンド例で /path/to/ は付けない（zipは作業ディレクトリに置く前提）",
      "diff_apply": [
        "cd /var/www/reforma/frontend",
        "unzip -o reforma-react-vX.Y.Z-diff.zip -d ."
      ],
      "full_apply": [
        "cd /var/www/reforma/frontend",
        "unzip -o reforma-react-vX.Y.Z.zip -d .",
        "npm install"
      ]
    },
    "cache_clear_required": {
      "reason": "適用したはずなのに修正が見えない場合が多発するため",
      "commands": [
        "cd /var/www/reforma/frontend",
        "rm -rf dist",
        "rm -rf node_modules/.vite"
      ],
      "browser": [
        "Chrome/Edge: Ctrl+Shift+R（強制再読み込み）",
        "DevTools > Network > Disable cache を有効化して再読込"
      ]
    }
  },
  "specs_and_artifacts": {
    "core_specs_in_project_files": [
      "01.ReForma 基本仕様書 v1.0.json",
      "02.ReForma 画面仕様書 v1.0.json",
      "03.ReForma API 仕様書 v1.0.json",
      "04.ReForma DB 仕様書 v1.0.json",
      "05.ReForma 拡張仕様書 v1.0.json",
      "06.ReForma React 運用・画面ui仕様書 V0.3.json"
    ],
    "latest_consolidated_specs_shared": [
      "01.ReForma-basic-spec-v1.1-consolidated.final.json",
      "02.ReForma-screen-spec-v1.1-consolidated.json",
      "form-feature-spec-v1.0.complete.json",
      "form-feature-attachments-v1.1.json",
      "condition-ui-spec-v1.0.json",
      "ReForma_条件分岐_実装整理パック_v1.0.json",
      "ReForma_条件分岐_評価結果IF_v1.0.json",
      "ReForma_API_条件分岐_追補_適用ガイド_OperationIdマッピング_v1.0.json",
      "ReForma_API_条件分岐評価結果IF_追補_v1.0.patch.json",
      "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
      "reforma-root-only-policy-v1.0.json"
    ],
    "openapi": {
      "use_as_source_of_truth": true,
      "latest": [
        "openapi-reforma-v1.1-full.updated.yaml",
        "openapi-reforma-v1.1-full.updated.json"
      ],
      "supplements_variants": [
        "openapi-reforma-v1.1-full+supplements.yaml",
        "openapi-reforma-v1.1-full+supplements.json",
        "ReForma_OpenAPI_追補反映_patch_v1.0.json"
      ]
    },
    "generated_by_chatgpt": [
      "condition-operator-matrix-ui-v1.0.json (attachments化前提の field type × operator 許可表 + operator別 value_input UI 推奨)"
    ]
  },
  "auth_and_rbac": {
    "api_auth": "auth:sanctum + abilities:admin + reforma.admin_pat",
    "rbac_role_key": "roles[] in /auth/me",
    "root_flag_key": "is_root in /auth/me",
    "rbac_roles_known": [
      "reforma.system_admin"
    ],
    "root_only": {
      "enforced_at_api": "reforma.root_only (APIレベル強制)",
      "ui_source_of_truth": [
        "/auth/me roles[]",
        "/auth/me is_root"
      ],
      "error_handling": {
        "http_status": 403,
        "code": "FORBIDDEN",
        "errors.reason": "ROOT_ONLY",
        "ui_message_ja": "root 権限が必要です（この操作は root-only です）",
        "must_be_distinct_from_generic_forbidden": true
      }
    }
  },
  "ui_completed_work_v0_5_x": {
    "sidebar": {
      "pc_collapsible": true,
      "collapsed_behavior": [
        "モチーフロゴ(SVG)クリックで開閉トグル",
        "メニューはアイコン化",
        "ログアウトはロゴ直下に配置",
        "ボタンサイズ/中央寄せ/幅を統一（開閉両方）"
      ],
      "tooltips_i18n": "折りたたみ/展開のツールチップは言語に応じて切替（ja/en/zh 想定）"
    },
    "logo_glow": {
      "login_logo": "ロゴ領域hover/focusのみでグロー（画面hoverでは発火しない）",
      "app_logo": "左上ロゴも同様"
    },
    "logout_dialog": {
      "positioning": "PCは上寄り（タイトルパネル下あたり）、モバイルは中央",
      "status": "OK"
    }
  },
  "known_constraints_and_caveats": {
    "file_download_instability": [
      "長いチャットではZIPがダウンロード不能になる場合がある（特にフルZIP）",
      "可能ならユーザー環境で Git もしくは自前ZIPで v0.5.8 正本を保存しておく"
    ],
    "api_not_connected_yet": "現時点ではAPI未接続で進行（Authはスタブ/未接続想定）"
  },
  "next_recommended_tasks": [
    {
      "id": "NEXT-A",
      "title": "Auth/me 接続（最小）",
      "why": "roles[]/is_root を正本として UI 制御・root-only 判定を実データに移行するため",
      "scope": [
        "GET /v1/auth/me の接続",
        "401/419 -> /logout?reason=session_invalid",
        "403 reason(ROOT_ONLY) の共通処理の再確認"
      ]
    },
    {
      "id": "NEXT-B",
      "title": "S-02 アカウント一覧（System Admin）着手",
      "scope": [
        "一覧/検索/ソート/ページング",
        "root-only 操作（system_admin昇格）UI制御"
      ]
    }
  ],
  "files_to_attach_in_new_chat": {
    "must_attach": [
      "このJSON（reforma-frontend-handoff-v0.5.8.json）",
      "reforma-root-only-policy-v1.0.json",
      "openapi-reforma-v1.1-full.updated.yaml（または .json）",
      "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
      "condition-operator-matrix-ui-v1.0.json"
    ],
    "recommended_attach": [
      "02.ReForma-screen-spec-v1.1-consolidated.json（画面/パンくず/タイトル準拠の確認用）",
      "06.ReForma React 運用・画面ui仕様書 V0.3.json（デバッグUI/共通UIルール）",
      "ReForma_Frontend_共有テンプレ_v1.1_追補反映.json（開発開始テンプレ）"
    ],
    "if_possible_best": [
      "ユーザー環境の v0.5.8 正本ソース（Git repo かユーザーが生成したフルZIP）",
      "直近のスクリーンショット（サイドバー開/閉）"
    ]
  }
}
```

## FRONTEND-0014 reforma-frontend-spec-v0.5.8

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v0.5.8.json`

```json
{
  "metadata": {
    "project": "ReForma",
    "component": "frontend-react",
    "handoff_title": "ReForma React 引き継ぎパック（v0.5.8 時点・テンプレ埋め込み版）",
    "generated_at": "2026-01-14T00:19:22.141465+09:00",
    "timezone": "Asia/Tokyo",
    "language": "ja",
    "status": "active",
    "notes": [
      "このJSONは新しいChatGPTチャットに貼り付け・添付して使う機械共有用。",
      "フルZIPがダウンロード不可になる事象が発生したため、以後は差分ZIP運用を基本とし、フルZIPはユーザー側でバックアップ生成する方針も併記。"
    ],
    "updated_at": "2026-01-14T00:47:07.802954+09:00",
    "version": "1.1.0"
  },
  "baseline": {
    "source_of_truth_version": "0.5.8",
    "baseline_source": "ユーザー環境に適用済みの v0.5.8 相当（v0.4.12.3 + v0.5.x 差分適用）",
    "previous_baseline_zip": "reforma-react-v0.4.12.3.zip",
    "package_version_required": true,
    "build_log_expected_prefix": "reforma-react@0.5.8",
    "zip_distribution_constraints": {
      "default": "diff_zip_only",
      "full_zip": "依頼時のみ（ただしダウンロード制限が起きる可能性あり）",
      "diff_zip_structure_rule": "トップディレクトリを含めず、プロジェクト直下に上書き展開できる構造（例: src/, package.json 等が直に入る）"
    }
  },
  "delivery_rules": {
    "versioning": {
      "must_update_package_json_version_each_release": true,
      "must_match_build_output": true
    },
    "zip_apply_commands": {
      "no_path_prefix_rule": "コマンド例で /path/to/ は付けない（zipは作業ディレクトリに置く前提）",
      "diff_apply": [
        "cd /var/www/reforma/frontend",
        "unzip -o reforma-react-vX.Y.Z-diff.zip -d ."
      ],
      "full_apply": [
        "cd /var/www/reforma/frontend",
        "unzip -o reforma-react-vX.Y.Z.zip -d .",
        "npm install"
      ]
    },
    "cache_clear_required": {
      "reason": "適用したはずなのに修正が見えない場合が多発するため",
      "commands": [
        "cd /var/www/reforma/frontend",
        "rm -rf dist",
        "rm -rf node_modules/.vite"
      ],
      "browser": [
        "Chrome/Edge: Ctrl+Shift+R（強制再読み込み）",
        "DevTools > Network > Disable cache を有効化して再読込"
      ]
    }
  },
  "specs_and_artifacts": {
    "core_specs_in_project_files": [
      "01.ReForma 基本仕様書 v1.0.json",
      "02.ReForma 画面仕様書 v1.0.json",
      "03.ReForma API 仕様書 v1.0.json",
      "04.ReForma DB 仕様書 v1.0.json",
      "05.ReForma 拡張仕様書 v1.0.json",
      "06.ReForma React 運用・画面ui仕様書 V0.3.json"
    ],
    "latest_consolidated_specs_shared": [
      "01.ReForma-basic-spec-v1.1-consolidated.final.json",
      "02.ReForma-screen-spec-v1.1-consolidated.json",
      "form-feature-spec-v1.0.complete.json",
      "form-feature-attachments-v1.1.json",
      "condition-ui-spec-v1.0.json",
      "ReForma_条件分岐_実装整理パック_v1.0.json",
      "ReForma_条件分岐_評価結果IF_v1.0.json",
      "ReForma_API_条件分岐_追補_適用ガイド_OperationIdマッピング_v1.0.json",
      "ReForma_API_条件分岐評価結果IF_追補_v1.0.patch.json",
      "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
      "reforma-root-only-policy-v1.0.json"
    ],
    "openapi": {
      "use_as_source_of_truth": true,
      "latest": [
        "openapi-reforma-v1.1-full.updated.yaml",
        "openapi-reforma-v1.1-full.updated.json"
      ],
      "supplements_variants": [
        "openapi-reforma-v1.1-full+supplements.yaml",
        "openapi-reforma-v1.1-full+supplements.json",
        "ReForma_OpenAPI_追補反映_patch_v1.0.json"
      ]
    },
    "generated_by_chatgpt": [
      "condition-operator-matrix-ui-v1.0.json (attachments化前提の field type × operator 許可表 + operator別 value_input UI 推奨)"
    ]
  },
  "auth_and_rbac": {
    "api_auth": "auth:sanctum + abilities:admin + reforma.admin_pat",
    "rbac_role_key": "roles[] in /auth/me",
    "root_flag_key": "is_root in /auth/me",
    "rbac_roles_known": [
      "reforma.system_admin"
    ],
    "root_only": {
      "enforced_at_api": "reforma.root_only (APIレベル強制)",
      "ui_source_of_truth": [
        "/auth/me roles[]",
        "/auth/me is_root"
      ],
      "error_handling": {
        "http_status": 403,
        "code": "FORBIDDEN",
        "errors.reason": "ROOT_ONLY",
        "ui_message_ja": "root 権限が必要です（この操作は root-only です）",
        "must_be_distinct_from_generic_forbidden": true
      }
    }
  },
  "ui_completed_work_v0_5_x": {
    "sidebar": {
      "pc_collapsible": true,
      "collapsed_behavior": [
        "モチーフロゴ(SVG)クリックで開閉トグル",
        "メニューはアイコン化",
        "ログアウトはロゴ直下に配置",
        "ボタンサイズ/中央寄せ/幅を統一（開閉両方）"
      ],
      "tooltips_i18n": "折りたたみ/展開のツールチップは言語に応じて切替（ja/en/zh 想定）"
    },
    "logo_glow": {
      "login_logo": "ロゴ領域hover/focusのみでグロー（画面hoverでは発火しない）",
      "app_logo": "左上ロゴも同様"
    },
    "logout_dialog": {
      "positioning": "PCは上寄り（タイトルパネル下あたり）、モバイルは中央",
      "status": "OK"
    }
  },
  "known_constraints_and_caveats": {
    "file_download_instability": [
      "長いチャットではZIPがダウンロード不能になる場合がある（特にフルZIP）",
      "可能ならユーザー環境で Git もしくは自前ZIPで v0.5.8 正本を保存しておく"
    ],
    "api_not_connected_yet": "現時点ではAPI未接続で進行（Authはスタブ/未接続想定）"
  },
  "next_recommended_tasks": [
    {
      "id": "NEXT-A",
      "title": "Auth/me 接続（最小）",
      "why": "roles[]/is_root を正本として UI 制御・root-only 判定を実データに移行するため",
      "scope": [
        "GET /v1/auth/me の接続",
        "401/419 -> /logout?reason=session_invalid",
        "403 reason(ROOT_ONLY) の共通処理の再確認"
      ]
    },
    {
      "id": "NEXT-B",
      "title": "S-02 アカウント一覧（System Admin）着手",
      "scope": [
        "一覧/検索/ソート/ページング",
        "root-only 操作（system_admin昇格）UI制御"
      ]
    }
  ],
  "files_to_attach_in_new_chat": {
    "must_attach": [
      "このJSON（reforma-frontend-handoff-v0.5.8.json）",
      "reforma-root-only-policy-v1.0.json",
      "openapi-reforma-v1.1-full.updated.yaml（または .json）",
      "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
      "condition-operator-matrix-ui-v1.0.json"
    ],
    "recommended_attach": [
      "02.ReForma-screen-spec-v1.1-consolidated.json（画面/パンくず/タイトル準拠の確認用）",
      "06.ReForma React 運用・画面ui仕様書 V0.3.json（デバッグUI/共通UIルール）",
      "ReForma_Frontend_共有テンプレ_v1.1_追補反映.json（開発開始テンプレ）"
    ],
    "if_possible_best": [
      "ユーザー環境の v0.5.8 正本ソース（Git repo かユーザーが生成したフルZIP）",
      "直近のスクリーンショット（サイドバー開/閉）"
    ]
  },
  "templates": {
    "new_chat_initial_post": "ReForma React 開発の続き（新チャット）です。\n\n0. 前提（正本）\n- 正本ソース：ユーザー環境の v0.5.8（/var/www/reforma/frontend に適用済み）\n- 今後の配布：差分ZIPのみが基本（フルZIPは依頼時のみ。ただしダウンロード不能になる可能性あり）\n- API は現状未接続（Auth/me は将来的に接続）\n\n1. 提供ルール（必須）\n- 差分ZIPはトップディレクトリを含めず、プロジェクト直下に上書き展開できる構造（例：src/, package.json が直に入る）\n- 各リリース毎に package.json の version を必ず更新し、buildログ表示（reforma-react@X.Y.Z）も追従させる\n- コマンド例に /path/to/ は付けない（zipは作業ディレクトリに置く前提）\n- 提供手順にはキャッシュクリア手順を必ず含める（dist と node_modules/.vite 削除、ブラウザ強制再読み込み）\n\n2. 差分ZIP適用手順\n```bash\ncd /var/www/reforma/frontend\nunzip -o reforma-react-vX.Y.Z-diff.zip -d .\n# 必要なら npm install\n```\n\n3. キャッシュクリア & ビルド（反映確認）\n```bash\ncd /var/www/reforma/frontend\nrm -rf dist\nrm -rf node_modules/.vite\nnpm run build:stg\n```\nブラウザ：Ctrl+Shift+R（強制再読み込み）／DevTools > Network > Disable cache\n\n4. ローカルGit運用（正本固定＋差分管理）\n初回のみ（v0.5.8 固定）\n```bash\ncd /var/www/reforma/frontend\ngit init\ngit branch -M main\ncat > .gitignore <<'EOF'\nnode_modules/\ndist/\n.vite/\nnode_modules/.vite/\n.env\n.env.*\n.DS_Store\n*.log\nEOF\ngit add .\ngit commit -m \"chore: baseline v0.5.8 (local canonical snapshot)\"\ngit tag -a v0.5.8 -m \"ReForma React canonical baseline v0.5.8\"\n```\n\n開発時（推奨）\n```bash\ngit checkout -b feature/<task-name>\n# 作業\ngit add .\ngit commit -m \"feat: <summary>\"\n```\n\n手元フルZIP生成（保険）\n```bash\ngit archive --format=zip --output=reforma-react-v0.5.8.zip v0.5.8\n```\n\n5. 仕様・参照ファイル（添付推奨）\n必須：reforma-root-only-policy-v1.0.json / openapi-reforma-v1.1-full.updated.yaml / ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json / condition-operator-matrix-ui-v1.0.json / reforma-frontend-handoff-v0.5.8.json\n推奨：02.ReForma-screen-spec-v1.1-consolidated.json / 06.ReForma React 運用・画面ui仕様書 V0.3.json / ReForma_Frontend_共有テンプレ_v1.1_追補反映.json\n\n6. 現状の実装済み（v0.5.8）\n- サイドバー：PC折りたたみ、モチーフロゴ(SVG)クリックで開閉、メニューアイコン化、ログアウト位置（ロゴ直下）、ボタン幅/サイズ/中央寄せ統一\n- ロゴグロー：ロゴ領域 hover/focus のみで発火（画面hoverでは発火しない）\n- ログアウトダイアログ：PC上寄り、モバイル中央\n- root-only：/auth/me の roles[] と is_root を正本にUI制御、403 reason=ROOT_ONLY を専用表示\n\n7. 次にやりたい作業\n- （ここに今回進めたい作業を記載）\n"
  }
}
```

## FRONTEND-0015 reforma-frontend-spec-v1.0.0-Frontend-共有テンプレ-.json

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0-Frontend-共有テンプレ-.json.json`

```json
{
  "meta": {
    "title": "ReForma 開発チャット共有テンプレ（フロントエンド）",
    "version": "1.0",
    "generated_at": "2026-01-12T16:56:01.989787",
    "timezone": "Asia/Tokyo",
    "target": "React Frontend"
  },
  "paste_template": {
    "sections": [
      {
        "title": "前提",
        "body": [
          "本チャットは ReForma フロントエンド（React）実装フェーズの継続です。仕様の再検討はしません。",
          "フォーム機能・条件分岐UI（ビルダー＋公開フォーム）の実装、E2E整理を進めます。"
        ]
      },
      {
        "title": "正本仕様（必ず前提）",
        "body": [
          "01.ReForma-basic-spec-v1.1-consolidated.final.json",
          "02.ReForma-screen-spec-v1.1-consolidated.json",
          "condition-ui-spec-v1.0.json（F-03/F-05配置・保存先JSON・権限/文言/v1.x制約）",
          "form-feature-attachments-v1.1.json（A-06が条件分岐の正本）",
          "form-feature-spec-v1.0.complete.json",
          "06.ReForma React 運用・画面ui仕様書 V0.3.json",
          "フロントソース: reforma-react-v0.4.12.3.zip（次の開発は v0.5.0 から）"
        ]
      },
      {
        "title": "重要な設計原則（厳守）",
        "body": [
          "and/or は必ず明示（暗黙優先順位なし）",
          "v1.x では条件ネストは 1段まで",
          "評価不能時は安全側（非表示／必須解除／遷移不可）",
          "UIとAPIの二重防御（UI即時評価＋API最終確定）"
        ]
      },
      {
        "title": "フロントで扱う条件分岐I/F（ConditionState）",
        "body": [
          "API が返す ConditionState をそのまま UI に適用（fields.visible/required/store）",
          "reasons/eval は任意（UIは presence 依存しない）"
        ]
      },
      {
        "title": "既に作成済みの成果物（参照/生成）",
        "body": [
          "ReForma_条件分岐_評価結果IF_v1.0.json（ConditionState I/F）",
          "openapi-reforma-v1.1-full.yaml（APIクライアント生成/参照用）"
        ]
      },
      {
        "title": "今回のフロント実装対象（優先）",
        "body": [
          "F-03/F-05: 条件分岐ビルダーUI（1段ネスト制限、AND/OR明示、field type別 operator/value UI、保存JSONは condition-ui-spec に準拠）",
          "公開フォーム（/f/{form_key}）: ConditionState適用（非表示/必須解除/遷移不可）、submit 422 errors 表示",
          "E2E（Playwright等）: ビルダー保存→再読込再現、公開フォーム表示/必須/遷移、異常系フォールバック"
        ]
      },
      {
        "title": "出力してほしいもの",
        "body": [
          "実装チェックリスト / E2Eシナリオ（最小セット）",
          "ConditionState 適用の状態管理方針（Renderer/Builderの責務分離）"
        ]
      }
    ]
  },
  "attachments_to_share": {
    "must_include": [
      {
        "file": "ReForma_条件分岐_評価結果IF_v1.0.json",
        "path": "sandbox:/mnt/data/ReForma_条件分岐_評価結果IF_v1.0.json",
        "purpose": "ConditionState I/F（API→UI）"
      },
      {
        "file": "openapi-reforma-v1.1-full.yaml",
        "path": "sandbox:/mnt/data/openapi-reforma-v1.1-full.yaml",
        "purpose": "OpenAPI（API参照/クライアント生成）"
      },
      {
        "file": "condition-ui-spec-v1.0.json",
        "path": "sandbox:/mnt/data/condition-ui-spec-v1.0.json",
        "purpose": "条件分岐UI仕様（保存先JSON/配置/権限/文言）"
      },
      {
        "file": "form-feature-attachments-v1.1.json",
        "path": "sandbox:/mnt/data/form-feature-attachments-v1.1.json",
        "purpose": "Attachments（A-06 条件分岐 正本）"
      },
      {
        "file": "reforma-react-v0.4.12.3.zip",
        "path": "sandbox:/mnt/data/reforma-react-v0.4.12.3.zip",
        "purpose": "既存フロントソース（v0.5.0から開始）"
      }
    ],
    "reference_specs": [
      "02.ReForma-screen-spec-v1.1-consolidated.json（画面遷移/配置）",
      "06.ReForma React 運用・画面ui仕様書 V0.3.json（UI規約）"
    ]
  }
}
```

## FRONTEND-0016 reforma-frontend-spec-v1.0.0-condition-operator-matrix-ui-.json

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0-condition-operator-matrix-ui-.json.json`

```json
{
  "metadata": {
    "document_id": "reforma-condition-operator-matrix",
    "title": "ReForma 条件分岐: field type × operator 許可表 + operator別 value_input UI（v1.x 推奨）",
    "version": "1.0.0",
    "status": "proposed",
    "timezone": "Asia/Tokyo",
    "generated_at": "2026-01-13T02:32:54.632904+09:00",
    "compatibility": {
      "condition_spec": "ReForma_条件分岐_実装整理パック_v1.0 (A-06 contract)",
      "constraints": {
        "max_nesting": 1,
        "max_conditions": 10,
        "logic_ops": [
          "and",
          "or",
          "not"
        ],
        "comparison_ops": [
          "eq",
          "ne",
          "in",
          "contains",
          "gt",
          "gte",
          "lt",
          "lte",
          "between",
          "exists"
        ]
      }
    },
    "notes": [
      "本JSONは attachments 化を前提に、仕様書/実装で共通利用できるように正規化している。",
      "UIは『row = field_selector / operator_selector / value_input』を前提とする。",
      "logic_ops(and/or/not) は型依存しない（グループ構築用）。本表は comparison_ops の許可を中心に定義する。"
    ]
  },
  "attachments": {
    "index": [
      {
        "attachment_id": "ATTACHMENT_CONDITION_FIELD_TYPE_GROUPS_V1",
        "title": "フィールド型グルーピング（条件分岐用）",
        "kind": "mapping"
      },
      {
        "attachment_id": "ATTACHMENT_CONDITION_OPERATOR_CATALOG_V1",
        "title": "演算子カタログ（logic/comparison）",
        "kind": "catalog"
      },
      {
        "attachment_id": "ATTACHMENT_CONDITION_OPERATOR_MATRIX_V1",
        "title": "field type group × operator 許可表（comparison）",
        "kind": "matrix"
      },
      {
        "attachment_id": "ATTACHMENT_CONDITION_VALUE_INPUT_UI_V1",
        "title": "operator別 value_input UI 推奨",
        "kind": "ui_spec"
      }
    ],
    "items": [
      {
        "attachment_id": "ATTACHMENT_CONDITION_FIELD_TYPE_GROUPS_V1",
        "kind": "mapping",
        "field_type_groups": [
          {
            "group_id": "text_like",
            "label": {
              "ja": "テキスト系",
              "en": "Text-like",
              "zh": "文本类"
            },
            "field_types": [
              "text",
              "textarea",
              "email",
              "tel"
            ],
            "value_shape": "string"
          },
          {
            "group_id": "number",
            "label": {
              "ja": "数値",
              "en": "Number",
              "zh": "数值"
            },
            "field_types": [
              "number"
            ],
            "value_shape": "number"
          },
          {
            "group_id": "date_like",
            "label": {
              "ja": "日付/日時",
              "en": "Date/Datetime",
              "zh": "日期/日期时间"
            },
            "field_types": [
              "date",
              "datetime"
            ],
            "value_shape": "date_or_datetime"
          },
          {
            "group_id": "choice_single",
            "label": {
              "ja": "選択（単一）",
              "en": "Single choice",
              "zh": "单选"
            },
            "field_types": [
              "select",
              "radio"
            ],
            "value_shape": "string"
          },
          {
            "group_id": "choice_multi",
            "label": {
              "ja": "選択（複数）",
              "en": "Multi choice",
              "zh": "多选"
            },
            "field_types": [
              "checkbox"
            ],
            "value_shape": "array<string>"
          },
          {
            "group_id": "boolean",
            "label": {
              "ja": "真偽（同意）",
              "en": "Boolean (agree)",
              "zh": "布尔（同意）"
            },
            "field_types": [
              "agree"
            ],
            "value_shape": "boolean"
          },
          {
            "group_id": "file",
            "label": {
              "ja": "ファイル",
              "en": "File",
              "zh": "文件"
            },
            "field_types": [
              "file"
            ],
            "value_shape": "file_state"
          },
          {
            "group_id": "display_only",
            "label": {
              "ja": "表示のみ（値なし）",
              "en": "Display-only",
              "zh": "仅展示"
            },
            "field_types": [
              "section",
              "paragraph"
            ],
            "value_shape": "none"
          }
        ],
        "resolution_rules": [
          "未知の field_type は display_only と同等に扱い（comparison禁止）、exists のみ許可するか、UIから除外する。",
          "複数の field_type が同一 group に属する場合は group の許可表を適用する。"
        ]
      },
      {
        "attachment_id": "ATTACHMENT_CONDITION_OPERATOR_CATALOG_V1",
        "kind": "catalog",
        "operators": [
          {
            "op": "and",
            "kind": "logic",
            "label": {
              "ja": "AND（すべて満たす）",
              "en": "AND (all)",
              "zh": "且（全部满足）"
            },
            "description": {
              "ja": "子条件をすべて満たす",
              "en": "All child conditions must match",
              "zh": "所有子条件都需满足"
            }
          },
          {
            "op": "or",
            "kind": "logic",
            "label": {
              "ja": "OR（いずれか満たす）",
              "en": "OR (any)",
              "zh": "或（任一满足）"
            },
            "description": {
              "ja": "子条件のいずれかを満たす",
              "en": "Any child condition matches",
              "zh": "任一子条件满足即可"
            }
          },
          {
            "op": "not",
            "kind": "logic",
            "label": {
              "ja": "NOT（否定）",
              "en": "NOT",
              "zh": "非"
            },
            "description": {
              "ja": "子条件を否定する（v1.xはネスト1まで）",
              "en": "Negates a child condition (max nesting 1)",
              "zh": "对子条件取反（v1.x最多1层嵌套）"
            }
          },
          {
            "op": "eq",
            "kind": "comparison",
            "label": {
              "ja": "＝（一致）",
              "en": "Equals",
              "zh": "等于"
            },
            "value_shape": "scalar"
          },
          {
            "op": "ne",
            "kind": "comparison",
            "label": {
              "ja": "≠（不一致）",
              "en": "Not equals",
              "zh": "不等于"
            },
            "value_shape": "scalar"
          },
          {
            "op": "in",
            "kind": "comparison",
            "label": {
              "ja": "含む（いずれか一致）",
              "en": "In (any of)",
              "zh": "包含（任一匹配）"
            },
            "value_shape": "array"
          },
          {
            "op": "contains",
            "kind": "comparison",
            "label": {
              "ja": "部分一致（含む）",
              "en": "Contains",
              "zh": "包含（子串）"
            },
            "value_shape": "string"
          },
          {
            "op": "gt",
            "kind": "comparison",
            "label": {
              "ja": "＞",
              "en": "Greater than",
              "zh": "大于"
            },
            "value_shape": "scalar"
          },
          {
            "op": "gte",
            "kind": "comparison",
            "label": {
              "ja": "≧",
              "en": "Greater or equal",
              "zh": "大于等于"
            },
            "value_shape": "scalar"
          },
          {
            "op": "lt",
            "kind": "comparison",
            "label": {
              "ja": "＜",
              "en": "Less than",
              "zh": "小于"
            },
            "value_shape": "scalar"
          },
          {
            "op": "lte",
            "kind": "comparison",
            "label": {
              "ja": "≦",
              "en": "Less or equal",
              "zh": "小于等于"
            },
            "value_shape": "scalar"
          },
          {
            "op": "between",
            "kind": "comparison",
            "label": {
              "ja": "範囲（between）",
              "en": "Between",
              "zh": "区间"
            },
            "value_shape": "range"
          },
          {
            "op": "exists",
            "kind": "comparison",
            "label": {
              "ja": "値がある/ない",
              "en": "Exists",
              "zh": "有值/无值"
            },
            "value_shape": "boolean"
          }
        ],
        "ui_grouping_recommendation": [
          {
            "group": "basic",
            "ops": [
              "eq",
              "ne",
              "in",
              "contains"
            ]
          },
          {
            "group": "numeric_date",
            "ops": [
              "gt",
              "gte",
              "lt",
              "lte",
              "between"
            ]
          },
          {
            "group": "presence",
            "ops": [
              "exists"
            ]
          }
        ]
      },
      {
        "attachment_id": "ATTACHMENT_CONDITION_OPERATOR_MATRIX_V1",
        "kind": "matrix",
        "matrix_type": "group_x_operator",
        "applies_to": {
          "dimension_x": "field_type_group_id",
          "dimension_y": "comparison_operator"
        },
        "allow": {
          "text_like": [
            "eq",
            "ne",
            "in",
            "contains",
            "exists"
          ],
          "number": [
            "eq",
            "ne",
            "in",
            "gt",
            "gte",
            "lt",
            "lte",
            "between",
            "exists"
          ],
          "date_like": [
            "eq",
            "ne",
            "in",
            "gt",
            "gte",
            "lt",
            "lte",
            "between",
            "exists"
          ],
          "choice_single": [
            "eq",
            "ne",
            "in",
            "exists"
          ],
          "choice_multi": [
            "in",
            "exists"
          ],
          "boolean": [
            "eq",
            "ne",
            "exists"
          ],
          "file": [
            "exists"
          ],
          "display_only": []
        },
        "policy_notes": [
          "logic_ops(and/or/not) は型依存しないため本matrix対象外。",
          "choice_multi(checkbox) の eq/ne は意味がぶれやすいため v1.x 推奨では許可しない（any-of は in を使用）。",
          "file は v1.x 推奨では exists のみに限定（アップロード有無の判定）。"
        ],
        "frontend_behavior": {
          "operator_selector_filtering": "フィールド選択後、matrix.allow[group] に含まれる op のみ表示する。",
          "invalid_operator_on_load": "既存ルールが matrix 外の場合は、UI上で警告表示し、保存時にバリデーションエラーとする（もしくは自動変換せず保持する）。"
        }
      },
      {
        "attachment_id": "ATTACHMENT_CONDITION_VALUE_INPUT_UI_V1",
        "kind": "ui_spec",
        "row_model": {
          "fields": [
            "field_selector",
            "operator_selector",
            "value_input"
          ],
          "notes": [
            "value_input は operator と field_type_group により型/部品が決定される。",
            "exists は value を boolean 固定（true/false）として扱い、入力はトグル/セグメントで提供する。"
          ]
        },
        "operator_ui": [
          {
            "operator": "eq",
            "value_shape": "scalar",
            "ui": {
              "component_by_group": {
                "text_like": "TextInput",
                "number": "NumberInput",
                "date_like": "DateOrDatetimePicker",
                "choice_single": "SingleSelect",
                "choice_multi": "N/A (use 'in')",
                "boolean": "BooleanSegment",
                "file": "N/A (use 'exists')"
              }
            },
            "validation": {
              "required": true
            }
          },
          {
            "operator": "ne",
            "value_shape": "scalar",
            "ui": {
              "component_by_group": {
                "text_like": "TextInput",
                "number": "NumberInput",
                "date_like": "DateOrDatetimePicker",
                "choice_single": "SingleSelect",
                "choice_multi": "N/A (use 'in')",
                "boolean": "BooleanSegment",
                "file": "N/A (use 'exists')"
              }
            },
            "validation": {
              "required": true
            }
          },
          {
            "operator": "in",
            "value_shape": "array",
            "ui": {
              "component_by_group": {
                "text_like": "TagInput (Enter to add)",
                "number": "TagInputNumeric (Enter to add)",
                "date_like": "MultiDatePicker (or TagInputDate)",
                "choice_single": "MultiSelect",
                "choice_multi": "MultiSelect (options)",
                "boolean": "N/A",
                "file": "N/A"
              },
              "display_hint": {
                "choice_multi": {
                  "ja": "含む（いずれか一致）",
                  "en": "Includes any of",
                  "zh": "包含任一"
                }
              }
            },
            "validation": {
              "min_items": 1
            }
          },
          {
            "operator": "contains",
            "value_shape": "string",
            "ui": {
              "component": "TextInput",
              "placeholder_i18n_key": "condition.value.contains.placeholder"
            },
            "validation": {
              "required": true
            }
          },
          {
            "operator": "gt",
            "value_shape": "scalar",
            "ui": {
              "component_by_group": {
                "number": "NumberInput",
                "date_like": "DateOrDatetimePicker"
              }
            },
            "validation": {
              "required": true
            }
          },
          {
            "operator": "gte",
            "value_shape": "scalar",
            "ui": {
              "component_by_group": {
                "number": "NumberInput",
                "date_like": "DateOrDatetimePicker"
              }
            },
            "validation": {
              "required": true
            }
          },
          {
            "operator": "lt",
            "value_shape": "scalar",
            "ui": {
              "component_by_group": {
                "number": "NumberInput",
                "date_like": "DateOrDatetimePicker"
              }
            },
            "validation": {
              "required": true
            }
          },
          {
            "operator": "lte",
            "value_shape": "scalar",
            "ui": {
              "component_by_group": {
                "number": "NumberInput",
                "date_like": "DateOrDatetimePicker"
              }
            },
            "validation": {
              "required": true
            }
          },
          {
            "operator": "between",
            "value_shape": "range",
            "ui": {
              "component_by_group": {
                "number": "RangeNumber (from/to)",
                "date_like": "RangeDateOrDatetime (from/to)"
              },
              "labels_i18n": {
                "from": "condition.value.between.from",
                "to": "condition.value.between.to"
              }
            },
            "validation": {
              "required": true,
              "both_required": true,
              "from_lte_to": true
            }
          },
          {
            "operator": "exists",
            "value_shape": "boolean",
            "ui": {
              "component": "BooleanSegment",
              "options": [
                {
                  "value": true,
                  "label_i18n_key": "condition.value.exists.true"
                },
                {
                  "value": false,
                  "label_i18n_key": "condition.value.exists.false"
                }
              ]
            },
            "validation": {
              "required": true
            }
          }
        ],
        "i18n_keys_minimum_set": [
          "condition.operator.eq",
          "condition.operator.ne",
          "condition.operator.in",
          "condition.operator.contains",
          "condition.operator.gt",
          "condition.operator.gte",
          "condition.operator.lt",
          "condition.operator.lte",
          "condition.operator.between",
          "condition.operator.exists",
          "condition.value.contains.placeholder",
          "condition.value.between.from",
          "condition.value.between.to",
          "condition.value.exists.true",
          "condition.value.exists.false"
        ]
      }
    ]
  }
}
```

## FRONTEND-0017 reforma-frontend-spec-v1.0.0-condition-ui-.json

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0-condition-ui-.json.json`

```json
{
  "meta": {
    "title": "条件分岐 UI 仕様（06.UI 連携）",
    "version": "1.0",
    "generated_at": "2026-01-12T15:23:57.297125",
    "depends_on": [
      "フォーム機能別表（Attachments） v1.1 / A-06",
      "条件分岐 UI 操作例 v1.0",
      "06.ReForma React 運用・画面ui仕様書"
    ]
  },
  "screens": {
    "F-03_field_edit": {
      "visibility_rule": {
        "label": "次の条件を満たすとき表示",
        "toggle": true,
        "save_as": "field.visibility_rule"
      },
      "required_rule": {
        "label": "次の条件を満たすとき必須",
        "toggle": true,
        "exclusive_with": "is_required",
        "save_as": "field.required_rule"
      }
    },
    "F-05_step_edit": {
      "transition_rule": {
        "label": "次へ進む条件",
        "toggle": true,
        "save_as": "step.transition_rule"
      }
    }
  },
  "builder": {
    "row": [
      "field_selector",
      "operator_selector",
      "value_input"
    ],
    "logic": {
      "group": [
        "AND",
        "OR"
      ],
      "nesting": "max_1_level_v1"
    },
    "validation": [
      "field_required",
      "type_match",
      "no_self_reference"
    ]
  },
  "permissions": {
    "edit": [
      "form_admin",
      "system_admin",
      "root"
    ],
    "view": [
      "viewer",
      "operator"
    ]
  },
  "storage": {
    "field": {
      "visibility_rule": "form_definition.fields[].visibility_rule",
      "required_rule": "form_definition.fields[].required_rule"
    },
    "step": {
      "transition_rule": "form_definition.steps[].transition_rule"
    }
  },
  "constraints": {
    "max_conditions": 10,
    "max_nesting": 1
  }
}
```

## FRONTEND-0018 reforma-frontend-spec-v1.0.0-condition-ui-examples-.json

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0-condition-ui-examples-.json.json`

```json
{
  "meta": {
    "title": "条件分岐 UI 操作例 v1.0",
    "version": "1.0",
    "generated_at": "2026-01-12T15:17:18.777520",
    "positioning": {
      "canonical_rules": "フォーム機能別表（Attachments） v1.1 / A-06",
      "this_doc": "UI creation examples + saved JSON examples"
    }
  },
  "assumptions": {
    "form_code": "CONTACT_2026",
    "fields": [
      {
        "field_key": "category",
        "type": "select",
        "label": "お問い合わせ種別"
      },
      {
        "field_key": "company_name",
        "type": "text",
        "label": "会社名"
      },
      {
        "field_key": "department",
        "type": "text",
        "label": "部署"
      },
      {
        "field_key": "email",
        "type": "email",
        "label": "メール"
      },
      {
        "field_key": "terms",
        "type": "terms",
        "label": "同意"
      }
    ],
    "steps": [
      {
        "step": "STEP1",
        "fields": [
          "category",
          "company_name",
          "department",
          "email"
        ]
      },
      {
        "step": "STEP2",
        "fields": [
          "terms"
        ]
      }
    ]
  },
  "examples": [
    {
      "id": "ex1_visibility_department_by_category",
      "target": {
        "kind": "field",
        "field_key": "department"
      },
      "rule_type": "visibility_rule",
      "ui_steps": [
        "フォーム編集→項目→department",
        "表示条件(Visibility) ON",
        "条件: category == business",
        "プレビュー確認→保存"
      ],
      "saved_rule": {
        "version": "1",
        "op": "eq",
        "field": "category",
        "value": "business"
      },
      "expected_behavior": [
        "category=business → department表示",
        "otherwise → 非表示（値は保存しない）"
      ]
    },
    {
      "id": "ex2_required_department_when_company_name_exists",
      "target": {
        "kind": "field",
        "field_key": "department"
      },
      "rule_type": "required_rule",
      "ui_steps": [
        "department を選択",
        "固定必須はOFF",
        "必須条件(Required condition) ON",
        "条件: company_name exists",
        "保存"
      ],
      "saved_rule": {
        "version": "1",
        "op": "exists",
        "field": "company_name",
        "value": true
      },
      "expected_behavior": [
        "company_name empty → department任意",
        "company_name filled → department必須"
      ]
    },
    {
      "id": "ex3_visibility_or_group",
      "target": {
        "kind": "field",
        "field_key": "department"
      },
      "rule_type": "visibility_rule",
      "ui_steps": [
        "department → 表示条件",
        "論理結合を OR に設定",
        "条件1: category == business",
        "条件2: company_name exists",
        "保存"
      ],
      "saved_rule": {
        "version": "1",
        "op": "or",
        "items": [
          {
            "op": "eq",
            "field": "category",
            "value": "business"
          },
          {
            "op": "exists",
            "field": "company_name",
            "value": true
          }
        ]
      },
      "expected_behavior": [
        "category=business または company_name 入力済み → 表示",
        "それ以外 → 非表示"
      ]
    },
    {
      "id": "ex4_step_transition_terms_required",
      "target": {
        "kind": "step",
        "step": "STEP2"
      },
      "rule_type": "step_transition_rule",
      "ui_steps": [
        "STEP設定→STEP2",
        "次へ進む条件(Transition) ON",
        "条件: terms == true",
        "保存"
      ],
      "saved_rule": {
        "version": "1",
        "op": "eq",
        "field": "terms",
        "value": true
      },
      "expected_behavior": [
        "terms未同意 → 遷移不可＋エラー",
        "terms同意 → 遷移可"
      ]
    }
  ],
  "implementation_notes": [
    "and/or を必ず明示して保存する（暗黙優先順位なし）",
    "UIはfield_keyを選択式にして未定義参照を防ぐ",
    "評価不能時は安全側（非表示／必須解除／遷移不可）"
  ]
}
```

## FRONTEND-0019 reforma-frontend-spec-v1.0.0-frontend-chat-init.json

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0-frontend-chat-init.json.json`

```json
{
  "purpose": "ReForma Frontend 新規チャット初期共有テンプレ",
  "role": "Frontend single source of truth",
  "baseline": {
    "version": "v0.4.12.3",
    "type": "full zip"
  },
  "references": {
    "specs": [
      "01.ReForma 基本仕様書 v1.0",
      "02.ReForma 画面仕様書 v1.0",
      "03.ReForma API 仕様書 v1.0",
      "04.ReForma DB 仕様書 v1.0",
      "05.ReForma 拡張仕様書 v1.0 (+v1.1)",
      "06.ReForma React 運用・画面UI仕様書 v0.3"
    ],
    "sup": "ReForma Frontend 補足仕様（SUP-FE）【統合・最新版】"
  },
  "current_target": {
    "screen": "S-02 アカウント一覧",
    "role": "System Admin",
    "features": [
      "list",
      "search",
      "filter",
      "sort",
      "pagination",
      "bulk invite resend"
    ]
  },
  "rules": {
    "routing": "401/419 -> /logout?reason=session_invalid",
    "title": "breadcrumb と一致",
    "theme": "ReForma 背景共通",
    "diff_policy": "diff zip 管理"
  }
}
```

## FRONTEND-0020 reforma-frontend-spec-v1.0.0-frontend-handoff-20260112.json

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0-frontend-handoff-20260112.json.json`

```json
{
  "meta": {
    "project": "ReForma",
    "channel": "Frontend handoff from Backend chat",
    "date": "2026-01-12",
    "timezone": "Asia/Tokyo",
    "version": "backend-handoff-20260112-01"
  },
  "api": {
    "mount": {
      "spa_base": "/reforma/",
      "api_base": "/reforma/api/",
      "version_prefix": "/v1",
      "example": "/reforma/api/v1/auth/me"
    },
    "routing_rule": {
      "no_api_double_prefix": true,
      "note": "Laravel側では /api プレフィックスを使わず、/v1 を先頭にする。Apache Alias が /reforma/api/ を担当。"
    },
    "response_envelope": {
      "shape": {
        "success": "boolean",
        "data": "any",
        "message": "string|null",
        "errors": "object|null"
      },
      "error_extras": {
        "code": "string|null",
        "request_id": "string"
      }
    },
    "list_policy": {
      "page_required": true,
      "per_page_required": true,
      "sort_optional": true,
      "sort_enum": [
        "created_at_desc",
        "created_at_asc"
      ],
      "default_sort": "created_at_desc",
      "response_fields_required": [
        "items",
        "total",
        "page",
        "per_page"
      ]
    }
  },
  "auth": {
    "frontend_behavior_already_confirmed": {
      "session_invalid_handling": {
        "trigger_statuses": [
          401,
          419
        ],
        "redirect": "/logout?reason=session_invalid",
        "logout_page_public": true,
        "client_state": "front invalidates logged-in state"
      }
    },
    "admin_auth": {
      "method": "Sanctum Personal Access Token (PAT)",
      "token_transport": "Authorization: Bearer <token>",
      "token_ttl_days_default": 30,
      "token_ttl_configurable": true,
      "rolling_extension": {
        "enabled": true,
        "update_frequency": "once_per_day",
        "expired_behavior": {
          "http_status": 401,
          "code": "TOKEN_EXPIRED"
        }
      }
    },
    "respondent_auth": {
      "method": "session-based per SUP spec",
      "authorization_for_confirm_url": "token-based (confirm_url token) is sufficient",
      "respondent_session_scope": "same browser may cross multiple forms (state may persist), but authorization remains token-based"
    }
  },
  "roles": {
    "system_admin": {
      "fixed": true,
      "constraints": [
        "system_admin must never become 0",
        "cannot revoke own system_admin",
        "cannot disable self"
      ]
    },
    "others": {
      "modifiable": true,
      "recommended_immutables": [
        "slug"
      ],
      "modifiable_fields": [
        "display_name",
        "permission_assignment"
      ]
    }
  },
  "confirm_url": {
    "token_storage": "store only token_hash in DB; raw token appears only in URL",
    "token_types": {
      "confirm_submission": {
        "ttl": "24h",
        "one_time": true
      },
      "ack_action": {
        "ttl": "24h",
        "one_time": true
      },
      "view_pdf": {
        "ttl": "7d",
        "one_time": false
      }
    },
    "ttl_configurable_via_settings": true,
    "one_time_configurable": {
      "view_pdf": true
    }
  },
  "pdf": {
    "storage": {
      "default": "S3",
      "switchable": [
        "local"
      ],
      "reason": "production has 2 web servers; avoid local divergence"
    },
    "regeneration_policy": {
      "source_of_truth": "submission-time snapshot",
      "default": "do not regenerate",
      "exception": "system_admin explicit action with audit log"
    }
  },
  "queue": {
    "driver": "database",
    "dlq_equivalent": "failed_jobs",
    "worker": "systemd (recommended)",
    "retries": {
      "tries": 5,
      "backoff_seconds": [
        60,
        300,
        900
      ]
    },
    "queues_recommended": [
      "default",
      "notifications",
      "pdf"
    ]
  },
  "settings": {
    "storage": "DB table: settings",
    "scope": "system (fixed for now)",
    "initial_impl": "no UI; initial values inserted manually or via seeder/SQL; app reads via cache",
    "recommended_schema": {
      "columns": [
        "id",
        "scope",
        "key",
        "type",
        "value_json",
        "description",
        "is_secret",
        "updated_by",
        "created_at",
        "updated_at"
      ],
      "unique": [
        "scope",
        "key"
      ]
    }
  }
}
```

## FRONTEND-0021 共通レイアウト

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.common.layout",
  "type": "common",
  "title": "共通レイアウト",
  "layout": {
    "header": {
      "elements": [
        "system_name",
        "user_info",
        "logout_action"
      ]
    },
    "sidebar": {
      "behavior": "role_based_menu"
    },
    "content": {
      "behavior": "screen_specific"
    }
  }
}
```

## FRONTEND-0022 権限制御

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.common.authorization",
  "type": "common",
  "title": "権限制御",
  "authorization": {
    "model": "role_based",
    "roles": {
      "viewer": {
        "description": "参照権限（閲覧可能範囲内）"
      },
      "operator": {
        "description": "運用権限（回答・検索の運用）"
      },
      "form_admin": {
        "description": "フォーム管理権限（フォーム作成・編集・項目設定）"
      },
      "system_admin": {
        "description": "システム管理権限（全機能・ログ閲覧）"
      }
    },
    "enforcement": [
      "screen_level",
      "field_level"
    ],
    "rules": [
      "user は自身の権限範囲を超える情報を閲覧できない"
    ]
  }
}
```

## FRONTEND-0023 多言語対応

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.common.i18n",
  "type": "common",
  "title": "多言語対応",
  "i18n": {
    "languages": [
      "ja",
      "en",
      "zh"
    ],
    "strategy": "i18n_dictionary",
    "requirements": [
      "画面文言はすべて i18n キーで管理する"
    ]
  }
}
```

## FRONTEND-0024 バリデーション・エラー表示

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.common.validation_and_errors",
  "type": "common",
  "title": "バリデーション・エラー表示",
  "validation": {
    "ui": {
      "on_field": "immediate",
      "on_submit": "full"
    }
  },
  "errors": {
    "ui": {
      "api_error_display": [
        "toast",
        "error_screen"
      ]
    },
    "references": {
      "error_code_ref": "ERROR_CODES_V1"
    }
  }
}
```

## FRONTEND-0025 ログイン画面

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.A-01.LOGIN",
  "type": "screen",
  "screen_no": "A-01",
  "screen_id": "LOGIN",
  "title": "ログイン画面",
  "role": "ReForma 管理画面への認証を行う",
  "permissions": {
    "allow_roles": [
      "viewer",
      "operator",
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/login"
  },
  "apis": [
    {
      "method": "POST",
      "path": "/api/v1/auth/login",
      "purpose": "認証"
    },
    {
      "method": "GET",
      "path": "/api/v1/auth/me",
      "purpose": "ログインユーザー取得"
    }
  ],
  "ui": {
    "fields": [
      {
        "key": "email",
        "required": true
      },
      {
        "key": "password",
        "required": true
      }
    ],
    "actions": [
      {
        "key": "submit_login"
      }
    ]
  },
  "errors": [
    {
      "code": "AUTH_FAILED",
      "ref": "ERROR_CODES_V1"
    }
  ]
}
```

## FRONTEND-0026 ログアウト

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.A-02.LOGOUT",
  "type": "screen",
  "screen_no": "A-02",
  "screen_id": "LOGOUT",
  "title": "ログアウト",
  "role": "ログアウト処理を行いログイン画面へ遷移する",
  "permissions": {
    "allow_roles": [
      "viewer",
      "operator",
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/logout"
  },
  "apis": [
    {
      "method": "POST",
      "path": "/api/v1/auth/logout",
      "purpose": "セッション破棄"
    }
  ],
  "ui": {
    "actions": [
      {
        "key": "execute_logout"
      }
    ]
  }
}
```

## FRONTEND-0027 システム管理ダッシュボード

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.S-01.SYS_DASH",
  "type": "screen",
  "screen_no": "S-01",
  "screen_id": "SYS_DASH",
  "title": "システム管理ダッシュボード",
  "role": "ログインユーザーが自身の権限範囲内で閲覧可能な情報を俯瞰する",
  "permissions": {
    "allow_roles": [
      "viewer",
      "operator",
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/dashboard"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/dashboard/summary",
      "purpose": "サマリー"
    },
    {
      "method": "GET",
      "path": "/api/v1/dashboard/forms",
      "purpose": "閲覧可能フォーム情報"
    },
    {
      "method": "GET",
      "path": "/api/v1/dashboard/responses",
      "purpose": "閲覧可能回答サマリー"
    },
    {
      "method": "GET",
      "path": "/api/v1/dashboard/errors",
      "purpose": "エラーサマリー（system_adminのみ）",
      "constraints": {
        "allow_roles": [
          "system_admin"
        ]
      }
    }
  ],
  "ui": {
    "blocks_by_role": {
      "viewer": {
        "blocks": [
          {
            "key": "accessible_form_count"
          },
          {
            "key": "accessible_response_count"
          },
          {
            "key": "recent_responses_readonly"
          },
          {
            "key": "notices"
          }
        ]
      },
      "operator": {
        "blocks": [
          {
            "key": "unprocessed_response_count"
          },
          {
            "key": "responses_by_period"
          },
          {
            "key": "notification_status_summary"
          },
          {
            "key": "minor_error_warnings"
          }
        ]
      },
      "form_admin": {
        "blocks": [
          {
            "key": "form_level_aggregations"
          },
          {
            "key": "ack_pdf_setting_status"
          },
          {
            "key": "recent_form_setting_changes"
          }
        ]
      },
      "system_admin": {
        "blocks": [
          {
            "key": "system_error_summary"
          },
          {
            "key": "processing_failure_summary"
          },
          {
            "key": "link_to_logs"
          },
          {
            "key": "system_info"
          }
        ]
      }
    }
  }
}
```

## FRONTEND-0028 フォーム一覧

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.F-01.FORM_LIST",
  "type": "screen",
  "screen_no": "F-01",
  "screen_id": "FORM_LIST",
  "title": "フォーム一覧",
  "role": "フォームの作成・管理の起点",
  "permissions": {
    "allow_roles": [
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/forms"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/forms",
      "purpose": "フォーム一覧"
    },
    {
      "method": "POST",
      "path": "/api/v1/forms",
      "purpose": "フォーム作成"
    }
  ],
  "ui": {
    "list": {
      "columns": [
        "form_name",
        "status",
        "languages",
        "response_count"
      ],
      "actions": [
        {
          "key": "open_form_edit"
        },
        {
          "key": "open_form_preview"
        }
      ]
    }
  }
}
```

## FRONTEND-0029 フォーム編集

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.F-02.FORM_EDIT",
  "type": "screen",
  "screen_no": "F-02",
  "screen_id": "FORM_EDIT",
  "title": "フォーム編集",
  "role": "フォーム基本情報の設定",
  "permissions": {
    "allow_roles": [
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/forms/{form_id}/edit"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/forms/{form_id}",
      "purpose": "フォーム取得"
    },
    {
      "method": "PUT",
      "path": "/api/v1/forms/{form_id}",
      "purpose": "フォーム更新"
    }
  ],
  "ui": {
    "fields": [
      {
        "key": "form_name_i18n",
        "required": true
      },
      {
        "key": "description_i18n",
        "required": false
      },
      {
        "key": "publish_status",
        "required": true
      },
      {
        "key": "post_submit_behavior",
        "required": true,
        "values": [
          "ack",
          "redirect"
        ]
      }
    ],
    "actions": [
      {
        "key": "save"
      }
    ]
  }
}
```

## FRONTEND-0030 フォーム項目設定

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.F-03.FORM_ITEM",
  "type": "screen",
  "screen_no": "F-03",
  "screen_id": "FORM_ITEM",
  "title": "フォーム項目設定",
  "role": "フォーム入力項目を定義する",
  "permissions": {
    "allow_roles": [
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/forms/{form_id}/items"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/forms/{form_id}/items",
      "purpose": "項目一覧"
    },
    {
      "method": "POST",
      "path": "/api/v1/forms/{form_id}/items",
      "purpose": "項目作成"
    },
    {
      "method": "PUT",
      "path": "/api/v1/forms/{form_id}/items/{item_id}",
      "purpose": "項目更新"
    }
  ],
  "ui": {
    "item_fields": [
      {
        "key": "label_i18n",
        "required": true
      },
      {
        "key": "type",
        "required": true,
        "ref": "FORM_ITEM_TYPE_V1"
      },
      {
        "key": "required",
        "required": true
      },
      {
        "key": "options",
        "required_if": {
          "type_in": [
            "select",
            "radio",
            "checkbox"
          ]
        }
      }
    ],
    "conditional_display": {
      "rule_ref": "CONDITION_RULE_V1"
    }
  }
}
```

## FRONTEND-0031 フォームプレビュー

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.F-04.FORM_PREVIEW",
  "type": "screen",
  "screen_no": "F-04",
  "screen_id": "FORM_PREVIEW",
  "title": "フォームプレビュー",
  "role": "公開前にフォームの表示・動作を確認する",
  "permissions": {
    "allow_roles": [
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/forms/{form_id}/preview"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/forms/{form_id}/preview",
      "purpose": "プレビュー用データ"
    }
  ],
  "ui": {
    "behavior": [
      "read_only_preview"
    ]
  }
}
```

## FRONTEND-0032 公開フォーム画面

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.U-01.FORM_VIEW",
  "type": "screen",
  "screen_no": "U-01",
  "screen_id": "FORM_VIEW",
  "title": "公開フォーム画面",
  "role": "一般利用者がフォーム入力を行う",
  "permissions": {
    "allow_roles": [
      "public"
    ]
  },
  "route": {
    "path": "/f/{form_key}"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/public/forms/{form_key}",
      "purpose": "公開フォーム定義取得"
    },
    {
      "method": "POST",
      "path": "/api/v1/public/forms/{form_key}/submit",
      "purpose": "回答送信"
    }
  ],
  "ui": {
    "fields_source": [
      {
        "ref": "FORM_ITEM_TYPE_V1"
      }
    ],
    "actions": [
      {
        "key": "submit"
      }
    ]
  },
  "errors": [
    {
      "code": "VALIDATION_ERROR",
      "ref": "ERROR_CODES_V1"
    }
  ]
}
```

## FRONTEND-0033 ACK（受付完了）画面

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.A-03.ACK_VIEW",
  "type": "screen",
  "screen_no": "A-03",
  "screen_id": "ACK_VIEW",
  "title": "ACK（受付完了）画面",
  "role": "フォーム送信完了を通知する",
  "permissions": {
    "allow_roles": [
      "public"
    ]
  },
  "route": {
    "path": "/f/{form_key}/ack"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/public/forms/{form_key}/ack",
      "purpose": "ACK 表示情報"
    }
  ],
  "ui": {
    "blocks": [
      {
        "key": "completion_message_i18n"
      },
      {
        "key": "receipt_number",
        "optional": true
      },
      {
        "key": "notes_i18n",
        "optional": true
      }
    ]
  }
}
```

## FRONTEND-0034 回答一覧

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.R-01.RESPONSE_LIST",
  "type": "screen",
  "screen_no": "R-01",
  "screen_id": "RESPONSE_LIST",
  "title": "回答一覧",
  "role": "フォーム回答の一覧・検索を行う",
  "permissions": {
    "allow_roles": [
      "operator",
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/responses"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/responses",
      "purpose": "回答一覧"
    }
  ],
  "ui": {
    "list": {
      "columns": [
        "received_at",
        "form_name",
        "status"
      ],
      "actions": [
        {
          "key": "open_response_detail"
        }
      ]
    }
  }
}
```

## FRONTEND-0035 回答詳細

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.R-02.RESPONSE_DETAIL",
  "type": "screen",
  "screen_no": "R-02",
  "screen_id": "RESPONSE_DETAIL",
  "title": "回答詳細",
  "role": "個別の回答内容を確認する",
  "permissions": {
    "allow_roles": [
      "operator",
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/responses/{response_id}"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/responses/{response_id}",
      "purpose": "回答詳細"
    }
  ],
  "ui": {
    "blocks": [
      {
        "key": "response_header"
      },
      {
        "key": "answers"
      },
      {
        "key": "status_and_actions"
      }
    ]
  }
}
```

## FRONTEND-0036 処理ログ一覧

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.L-01.LOG_LIST",
  "type": "screen",
  "screen_no": "L-01",
  "screen_id": "LOG_LIST",
  "title": "処理ログ一覧",
  "role": "API・通知・PDF 処理ログを確認する",
  "permissions": {
    "allow_roles": [
      "system_admin"
    ]
  },
  "route": {
    "path": "/logs"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/logs",
      "purpose": "ログ一覧"
    }
  ],
  "ui": {
    "list": {
      "columns": [
        "created_at",
        "category",
        "status",
        "message"
      ],
      "actions": [
        {
          "key": "open_log_detail"
        }
      ]
    }
  }
}
```

## FRONTEND-0037 処理ログ詳細

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.L-02.LOG_DETAIL",
  "type": "screen",
  "screen_no": "L-02",
  "screen_id": "LOG_DETAIL",
  "title": "処理ログ詳細",
  "role": "処理ログの詳細を確認する",
  "permissions": {
    "allow_roles": [
      "system_admin"
    ]
  },
  "route": {
    "path": "/logs/{log_id}"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/logs/{log_id}",
      "purpose": "ログ詳細"
    }
  ],
  "ui": {
    "blocks": [
      {
        "key": "log_header"
      },
      {
        "key": "payload_excerpt",
        "note": "実体スキーマは attachments に分離"
      },
      {
        "key": "error_details"
      }
    ]
  }
}
```

## FRONTEND-0038 横断検索画面

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.C-01.SEARCH",
  "type": "screen",
  "screen_no": "C-01",
  "screen_id": "SEARCH",
  "title": "横断検索画面",
  "role": "フォーム・回答・ログを横断的に検索する",
  "permissions": {
    "allow_roles": [
      "operator",
      "form_admin",
      "system_admin"
    ]
  },
  "route": {
    "path": "/search"
  },
  "apis": [
    {
      "method": "GET",
      "path": "/api/v1/search",
      "purpose": "横断検索"
    }
  ],
  "ui": {
    "query": {
      "fields": [
        "keyword",
        "from_date",
        "to_date",
        "category"
      ]
    },
    "results": {
      "sections": [
        "forms",
        "responses",
        "logs"
      ]
    }
  }
}
```

## FRONTEND-0039 エラー画面

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.E-01.ERROR",
  "type": "screen",
  "screen_no": "E-01",
  "screen_id": "ERROR",
  "title": "エラー画面",
  "role": "権限エラー等の共通エラー表示",
  "permissions": {
    "allow_roles": [
      "viewer",
      "operator",
      "form_admin",
      "system_admin",
      "public"
    ]
  },
  "route": {
    "path": "/error"
  },
  "ui": {
    "blocks": [
      {
        "key": "error_title"
      },
      {
        "key": "error_message"
      },
      {
        "key": "guidance"
      }
    ]
  },
  "references": {
    "error_code_ref": "ERROR_CODES_V1"
  }
}
```

## FRONTEND-0040 Not Found（404）画面

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.screen.N-01.NOT_FOUND",
  "type": "screen",
  "screen_no": "N-01",
  "screen_id": "NOT_FOUND",
  "title": "Not Found（404）画面",
  "role": "存在しないページへのアクセス時に表示",
  "permissions": {
    "allow_roles": [
      "viewer",
      "operator",
      "form_admin",
      "system_admin",
      "public"
    ]
  },
  "route": {
    "path": "*"
  },
  "ui": {
    "blocks": [
      {
        "key": "not_found_title"
      },
      {
        "key": "not_found_message"
      },
      {
        "key": "link_to_home"
      }
    ]
  }
}
```

## FRONTEND-0041 画面遷移（概要）

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.0.0.json`

```json
{
  "id": "section.navigation.flows",
  "type": "navigation",
  "title": "画面遷移（概要）",
  "flows": [
    {
      "name": "admin_login",
      "steps": [
        {
          "from": "/login",
          "to": "/dashboard"
        }
      ]
    },
    {
      "name": "form_management",
      "steps": [
        {
          "from": "/dashboard",
          "to": "/forms"
        },
        {
          "from": "/forms",
          "to": "/forms/{form_id}/edit"
        },
        {
          "from": "/forms/{form_id}/edit",
          "to": "/forms/{form_id}/items"
        },
        {
          "from": "/forms/{form_id}/items",
          "to": "/forms/{form_id}/preview"
        }
      ]
    },
    {
      "name": "response_management",
      "steps": [
        {
          "from": "/dashboard",
          "to": "/responses"
        },
        {
          "from": "/responses",
          "to": "/responses/{response_id}"
        }
      ]
    },
    {
      "name": "system_logs",
      "constraints": {
        "allow_roles": [
          "system_admin"
        ]
      },
      "steps": [
        {
          "from": "/dashboard",
          "to": "/logs"
        },
        {
          "from": "/logs",
          "to": "/logs/{log_id}"
        }
      ]
    },
    {
      "name": "public_submit",
      "steps": [
        {
          "from": "/f/{form_key}",
          "to": "/f/{form_key}/ack"
        }
      ]
    }
  ]
}
```

## FRONTEND-0042 reforma-frontend-spec-v1.1.0

- component_version: `v1.1.0`
- component_file: `classified/frontend/reforma-frontend-spec-v1.1.0.json`
- source_files: `latest/frontend/reforma-frontend-spec-v1.1.0.json`

```json
{
  "meta": {
    "title": "ReForma Frontend 共有テンプレ（追補反映）",
    "version": "1.1",
    "generated_at": "2026-01-13T01:08:32.431777",
    "timezone": "Asia/Tokyo"
  },
  "paste_template": {
    "sections": [
      {
        "title": "前提",
        "body": [
          "本チャットは ReForma フロントエンド（React）実装フェーズの継続。仕様の再検討はしない。",
          "正本仕様＋追補パッチに従い 条件分岐UI/表示モード/テーマ/計算フィールド を実装する。"
        ]
      },
      {
        "title": "正本仕様（必ず前提）",
        "body": [
          "02.ReForma-screen-spec-v1.1-consolidated.json",
          "condition-ui-spec-v1.0.json（条件分岐UI・保存JSON）",
          "form-feature-attachments-v1.1.json（A-06 条件分岐 正本）",
          "06.ReForma React 運用・画面ui仕様書 V0.3.json",
          "reforma-react-v0.4.12.3.zip（v0.5.0から開始）"
        ]
      },
      {
        "title": "追補（本チャットで追加：必ず反映）",
        "body": [
          "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
          "テーマ分離: 公開フォームテーマは管理画面テーマに追従しない（フォーム theme_id/theme_tokens のみ）",
          "計算フィールド: readonly + built-in 関数（UI計算はUX、submit時はAPI再計算で確定）"
        ]
      },
      {
        "title": "実装ポイント",
        "body": [
          "公開フォーム: theme_tokens をフォームコンテナに CSS variables として適用（:root/bodyには当てない、.rf-form 名前空間で完結）",
          "表示モード: 保存の正は value。表示は label/ both / value を切替可。label_snapshot がある場合はそれを優先表示可能。",
          "計算フィールド: 依存フィールド変更で再計算、readonly表示。循環/深い依存は扱わない（v1.x制限）",
          "条件分岐: and/or 明示、評価不能は安全側。ConditionStateを適用。"
        ]
      }
    ]
  },
  "attachments_to_share": {
    "must_include": [
      {
        "file": "ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
        "path": "sandbox:/mnt/data/ReForma_追補パッチ_表示モード_テーマ_計算フィールド_v1.0.1.json",
        "purpose": "追補パッチ（テーマ分離含む）"
      },
      {
        "file": "ReForma_条件分岐_評価結果IF_v1.0.json",
        "path": "sandbox:/mnt/data/ReForma_条件分岐_評価結果IF_v1.0.json",
        "purpose": "ConditionState I/F"
      },
      {
        "file": "openapi-reforma-v1.1-full.yaml",
        "path": "sandbox:/mnt/data/openapi-reforma-v1.1-full.yaml",
        "purpose": "API参照"
      },
      {
        "file": "condition-ui-spec-v1.0.json",
        "path": "sandbox:/mnt/data/condition-ui-spec-v1.0.json",
        "purpose": "条件分岐UI仕様"
      },
      {
        "file": "form-feature-attachments-v1.1.json",
        "path": "sandbox:/mnt/data/form-feature-attachments-v1.1.json",
        "purpose": "Attachments（A-06）"
      }
    ]
  }
}
```

# API仕様

## API-0001 reforma-api-spec-v1.0.0-API-条件分岐-追補-適用ガイド-OperationIdマッピング-.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0-API-条件分岐-追補-適用ガイド-OperationIdマッピング-.json.json`

```json
{
  "meta": {
    "title": "ReForma API patch apply guide (ConditionState) - operationId mapping",
    "version": "1.0",
    "generated_at": "2026-01-12T16:04:32.699437",
    "timezone": "Asia/Tokyo",
    "inputs_required": [
      "backend OpenAPI yaml/json (paths/components)",
      "ReForma_API_条件分岐評価結果IF_追補_v1.0.patch.json"
    ]
  },
  "mapping_template": [
    {
      "purpose": "public_form_get",
      "description": "公開フォーム初期描画（GET）",
      "method": "GET",
      "path": "<fill>",
      "operationId": "<optional>",
      "patch": {
        "add_to_success_response": {
          "path": "data.condition_state",
          "schema_ref": "#/components/schemas/ConditionState"
        }
      }
    },
    {
      "purpose": "step_transition",
      "description": "STEP 次へ遷移チェック／次STEP取得",
      "method": "POST",
      "path": "<fill>",
      "operationId": "<optional>",
      "patch": {
        "add_to_success_response": {
          "path": "data.condition_state",
          "schema_ref": "#/components/schemas/ConditionState"
        },
        "add_to_error_422": {
          "path": "errors.step",
          "schema_ref": "#/components/schemas/StepTransitionState",
          "error_code": "STEP_TRANSITION_DENIED"
        }
      }
    },
    {
      "purpose": "submit",
      "description": "最終 submit",
      "method": "POST",
      "path": "<fill>",
      "operationId": "<optional>",
      "patch": {
        "notes": [
          "422 VALIDATION_ERROR errors.fields は visible=true & required=true の field_key のみ返す"
        ]
      }
    }
  ],
  "apply_steps": [
    {
      "step": "STEP-1",
      "do": "identify endpoints in OpenAPI (method/path/operationId)"
    },
    {
      "step": "STEP-2",
      "do": "add schemas_add into components.schemas"
    },
    {
      "step": "STEP-3",
      "do": "add condition_state into success responses"
    },
    {
      "step": "STEP-4",
      "do": "add errors.step into 422 for step transition with STEP_TRANSITION_DENIED"
    },
    {
      "step": "STEP-5",
      "do": "reflect submit validation constraint note"
    },
    {
      "step": "STEP-6",
      "do": "diff + compatibility check"
    }
  ],
  "verification_checks": [
    "public GET returns condition_state",
    "step transition denied returns 422 errors.step",
    "runtime eval error uses safe fallback",
    "submit errors.fields only for visible+required"
  ]
}
```

## API-0002 reforma-api-spec-v1.0.0-API-条件分岐評価結果IF-追補-.patch.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0-API-条件分岐評価結果IF-追補-.patch.json.json`

```json
{
  "meta": {
    "title": "ReForma API v1.0 patch - ConditionState",
    "version": "1.0",
    "generated_at": "2026-01-12T15:57:07.712033",
    "timezone": "Asia/Tokyo",
    "targets": [
      "OpenAPI components.schemas",
      "Public form GET response",
      "Step transition response/error",
      "Submit validation error"
    ],
    "notes": [
      "API正本JSONにはOpenAPI本文が含まれていないため、patchは operationId/purpose ベースで提供する。",
      "具体の path/operationId は backend repo 側 OpenAPI に合わせてマッピングする。"
    ]
  },
  "schemas_add": {
    "Reason": {
      "type": "object",
      "properties": {
        "kind": {
          "type": "string",
          "enum": [
            "rule",
            "type",
            "missing_field",
            "unknown_operator"
          ]
        },
        "path": {
          "type": "string"
        },
        "message": {
          "type": "string"
        }
      },
      "required": [
        "kind"
      ]
    },
    "FieldConditionState": {
      "type": "object",
      "properties": {
        "visible": {
          "type": "boolean"
        },
        "required": {
          "type": "boolean"
        },
        "store": {
          "type": "string",
          "enum": [
            "store",
            "do_not_store"
          ]
        },
        "eval": {
          "type": "string",
          "enum": [
            "ok",
            "fallback",
            "error"
          ]
        },
        "reasons": {
          "type": "array",
          "items": {
            "$ref": "#/components/schemas/Reason"
          }
        }
      },
      "required": [
        "visible",
        "required",
        "store",
        "eval"
      ]
    },
    "StepTransitionState": {
      "type": "object",
      "properties": {
        "can_transition": {
          "type": "boolean"
        },
        "eval": {
          "type": "string",
          "enum": [
            "ok",
            "fallback",
            "error"
          ]
        },
        "message": {
          "type": "string"
        },
        "reasons": {
          "type": "array",
          "items": {
            "$ref": "#/components/schemas/Reason"
          }
        }
      },
      "required": [
        "can_transition",
        "eval"
      ]
    },
    "ConditionState": {
      "type": "object",
      "properties": {
        "version": {
          "type": "string",
          "enum": [
            "1"
          ]
        },
        "evaluated_at": {
          "type": "string",
          "format": "date-time"
        },
        "fields": {
          "type": "object",
          "additionalProperties": {
            "$ref": "#/components/schemas/FieldConditionState"
          }
        },
        "step": {
          "$ref": "#/components/schemas/StepTransitionState"
        }
      },
      "required": [
        "version",
        "evaluated_at",
        "fields"
      ]
    }
  },
  "responses_patch": [
    {
      "purpose": "public_form_get",
      "add_to_success_response": {
        "path": "data.condition_state",
        "schema_ref": "#/components/schemas/ConditionState"
      }
    },
    {
      "purpose": "step_transition",
      "add_to_success_response": {
        "path": "data.condition_state",
        "schema_ref": "#/components/schemas/ConditionState"
      },
      "add_to_error_422": {
        "path": "errors.step",
        "schema_ref": "#/components/schemas/StepTransitionState",
        "error_code": "STEP_TRANSITION_DENIED"
      }
    },
    {
      "purpose": "submit",
      "notes": [
        "422 VALIDATION_ERROR errors.fields は visible=true & required=true の field_key のみ返す"
      ]
    }
  ],
  "error_codes_add": [
    {
      "code": "STEP_TRANSITION_DENIED",
      "http": 422,
      "when": "step transition evaluated false"
    },
    {
      "code": "CONDITION_EVAL_ERROR",
      "http": [
        200,
        422
      ],
      "when": "runtime evaluation error; step uses 422 preferred"
    },
    {
      "code": "CONDITION_RULE_INVALID",
      "http": 422,
      "when": "rule invalid on admin save/publish"
    }
  ]
}
```

## API-0003 reforma-api-spec-v1.0.0-OpenAPI-追補反映-patch-.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0-OpenAPI-追補反映-patch-.json.json`

```json
{
  "meta": {
    "title": "ReForma OpenAPI 追補反映パッチ（theme_id/theme_tokens + computed field）",
    "version": "1.0",
    "generated_at": "2026-01-13T01:10:27.754879",
    "timezone": "Asia/Tokyo",
    "patch_type": "openapi_json_patch_like",
    "base_openapi": "openapi-reforma-v1.1-full.json",
    "result_version": "1.1-full+supplements"
  },
  "operations": [
    {
      "op": "add",
      "path": "/components/schemas/Form/properties/theme_id",
      "value": {
        "type": [
          "string",
          "null"
        ],
        "description": "フォームテーマID（公開フォーム専用）"
      }
    },
    {
      "op": "add",
      "path": "/components/schemas/Form/properties/theme_tokens",
      "value": {
        "type": [
          "object",
          "null"
        ],
        "description": "テーマトークン（CSS変数）",
        "additionalProperties": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "number"
            },
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    {
      "op": "add",
      "path": "/paths//v1/forms/post/requestBody/content/application~1json/schema/properties/theme_id",
      "value": {
        "type": [
          "string",
          "null"
        ]
      }
    },
    {
      "op": "add",
      "path": "/paths//v1/forms/post/requestBody/content/application~1json/schema/properties/theme_tokens",
      "value": {
        "type": [
          "object",
          "null"
        ],
        "additionalProperties": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "number"
            },
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    {
      "op": "add",
      "path": "/paths//v1/forms/{id}/put/requestBody/content/application~1json/schema/properties/theme_id",
      "value": {
        "type": [
          "string",
          "null"
        ]
      }
    },
    {
      "op": "add",
      "path": "/paths//v1/forms/{id}/put/requestBody/content/application~1json/schema/properties/theme_tokens",
      "value": {
        "type": [
          "object",
          "null"
        ],
        "additionalProperties": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "number"
            },
            {
              "type": "boolean"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    {
      "op": "add",
      "path": "/components/schemas/FormField/properties/is_readonly",
      "value": {
        "type": [
          "boolean",
          "null"
        ],
        "description": "readonly（computed等で利用）"
      }
    },
    {
      "op": "add",
      "path": "/components/schemas/FormField/properties/computed_rule",
      "value": {
        "type": [
          "object",
          "null"
        ],
        "description": "計算フィールド規則（v1.x: built_in_functions）",
        "properties": {
          "engine": {
            "type": "string",
            "enum": [
              "built_in_functions"
            ]
          },
          "fn": {
            "type": "string",
            "enum": [
              "sum",
              "multiply",
              "tax",
              "round",
              "min",
              "max",
              "if"
            ]
          },
          "args": {
            "type": "array",
            "items": {
              "oneOf": [
                {
                  "type": "string",
                  "description": "ref:FIELD_KEY 形式の参照"
                },
                {
                  "type": "number"
                },
                {
                  "type": "boolean"
                },
                {
                  "type": "null"
                }
              ]
            }
          },
          "result_type": {
            "type": "string",
            "enum": [
              "number",
              "string"
            ]
          },
          "format": {
            "type": [
              "string",
              "null"
            ],
            "enum": [
              "integer",
              "decimal",
              "currency",
              null
            ]
          },
          "fallback": {
            "type": "object",
            "properties": {
              "on_error": {
                "type": "string",
                "enum": [
                  "blank",
                  "zero"
                ]
              },
              "store": {
                "type": "string",
                "enum": [
                  "store",
                  "do_not_store"
                ]
              }
            }
          }
        },
        "required": [
          "engine",
          "fn",
          "args"
        ]
      }
    },
    {
      "op": "add",
      "path": "/components/schemas/Form/properties/theme_scope",
      "value": {
        "type": [
          "string",
          "null"
        ],
        "description": "(契約) テーマ適用スコープ。公開フォームは form_container_only（管理画面テーマと分離）",
        "enum": [
          "form_container_only",
          null
        ]
      }
    },
    {
      "op": "add",
      "path": "/paths/~1v1~1forms~1{form_key}~1submit/post/requestBody/content/application~1json/schema/description",
      "value": "（追補）computed フィールドの値を answers に含めても無視され、API側で再計算して確定します。"
    }
  ]
}
```

## API-0004 reforma-api-spec-v1.0.0-rbac-matrix.draft-20260112-root-only.jso

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0-rbac-matrix.draft-20260112-root-only.jso.json`

```json
{
  "meta": {
    "id": "RBAC_MATRIX_DRAFT",
    "version": "draft-2026-01-12+root-only",
    "source": [
      "02.ReForma 画面仕様書 v1.0",
      "SUP-FE latest",
      "backend-frontend handoff 2026-01-12"
    ],
    "notes": [
      "v1.0 allow_roles + S-01 blocks_by_role + SUP S-02..S-05 system_admin only",
      "Root-only is separated from permission_assignment; enforced by users.is_root",
      "Root-only must be enforced at both screen and API level"
    ]
  },
  "roles": {
    "viewer": {
      "screens_allow": [
        "A-01",
        "A-02",
        "S-01",
        "E-01",
        "N-01"
      ],
      "apis_deny": [
        "GET:/api/v1/dashboard/errors"
      ],
      "ui_blocks_allow": {
        "S-01": [
          "accessible_form_count",
          "accessible_response_count",
          "recent_responses_readonly",
          "notices"
        ]
      }
    },
    "operator": {
      "screens_allow": [
        "A-01",
        "A-02",
        "S-01",
        "R-01",
        "R-02",
        "C-01",
        "E-01",
        "N-01"
      ],
      "apis_deny": [
        "GET:/api/v1/dashboard/errors"
      ],
      "ui_blocks_allow": {
        "S-01": [
          "unprocessed_response_count",
          "responses_by_period",
          "notification_status_summary",
          "minor_error_warnings"
        ]
      }
    },
    "form_admin": {
      "screens_allow": [
        "A-01",
        "A-02",
        "S-01",
        "F-01",
        "F-02",
        "F-03",
        "F-04",
        "R-01",
        "R-02",
        "C-01",
        "E-01",
        "N-01"
      ],
      "apis_deny": [
        "GET:/api/v1/dashboard/errors"
      ],
      "ui_blocks_allow": {
        "S-01": [
          "form_level_aggregations",
          "ack_pdf_setting_status",
          "recent_form_setting_changes"
        ]
      }
    },
    "system_admin": {
      "screens_allow": [
        "A-01",
        "A-02",
        "S-01",
        "S-02",
        "S-03",
        "S-04",
        "S-05",
        "F-01",
        "F-02",
        "F-03",
        "F-04",
        "R-01",
        "R-02",
        "L-01",
        "L-02",
        "C-01",
        "E-01",
        "N-01"
      ],
      "apis_allow_overrides": [
        "GET:/api/v1/dashboard/errors"
      ],
      "ui_blocks_allow": {
        "S-01": [
          "system_error_summary",
          "processing_failure_summary",
          "link_to_logs",
          "system_info"
        ]
      }
    },
    "public": {
      "screens_allow": [
        "U-01",
        "A-03",
        "E-01",
        "N-01"
      ]
    }
  },
  "root_only": {
    "user_attribute": "is_root",
    "required_role": "system_admin",
    "screens": [
      {
        "screen_id": "S-XX",
        "name": "SYSTEM_SETTINGS",
        "route": "/system/settings",
        "status": "planned"
      },
      {
        "screen_id": "S-YY",
        "name": "ROLE_PERMISSION_ASSIGN",
        "route": "/system/roles/permissions",
        "status": "planned"
      }
    ],
    "apis": [
      {
        "api": "GET:/api/v1/system/settings",
        "status": "planned"
      },
      {
        "api": "PUT:/api/v1/system/settings",
        "status": "planned"
      },
      {
        "api": "GET:/api/v1/system/roles/permissions",
        "status": "planned"
      },
      {
        "api": "PUT:/api/v1/system/roles/permissions",
        "status": "planned"
      }
    ],
    "enforcement": {
      "screen_flag": "allow_root_only",
      "api_middleware": "RootOnly (system_admin && is_root)",
      "double_defense_required": true,
      "audit_log_required": true
    }
  },
  "screen_catalog": {
    "A-01": {
      "route": "/login"
    },
    "A-02": {
      "route": "/logout"
    },
    "S-01": {
      "route": "/dashboard"
    },
    "S-02": {
      "route": "/system/accounts",
      "source": "SUP"
    },
    "S-03": {
      "route": "/system/accounts/{id}",
      "source": "SUP"
    },
    "S-04": {
      "route": "/system/accounts/create",
      "source": "SUP"
    },
    "S-05": {
      "route": "/system/accounts/audit",
      "source": "SUP"
    },
    "S-XX": {
      "route": "/system/settings",
      "source": "planned"
    },
    "S-YY": {
      "route": "/system/roles/permissions",
      "source": "planned"
    },
    "F-01": {
      "route": "/forms"
    },
    "F-02": {
      "route": "/forms/{form_id}/edit"
    },
    "F-03": {
      "route": "/forms/{form_id}/items"
    },
    "F-04": {
      "route": "/forms/{form_id}/preview"
    },
    "R-01": {
      "route": "/responses"
    },
    "R-02": {
      "route": "/responses/{response_id}"
    },
    "L-01": {
      "route": "/logs"
    },
    "L-02": {
      "route": "/logs/{log_id}"
    },
    "C-01": {
      "route": "/search"
    },
    "E-01": {
      "route": "/error"
    },
    "N-01": {
      "route": "*"
    },
    "U-01": {
      "route": "/f/{form_key}"
    },
    "A-03": {
      "route": "/f/{form_key}/ack"
    }
  },
  "api_constraints": [
    {
      "api": "GET:/api/v1/dashboard/errors",
      "screen": "S-01",
      "allow_roles": [
        "system_admin"
      ],
      "source": "02.ReForma 画面仕様書 v1.0"
    }
  ]
}
```

## API-0005 概要

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0.json`

```json
{
  "description": "ReForma 基本仕様書 v1.0 および ReForma 画面仕様書 v1.0 に基づく API 仕様。"
}
```

## API-0006 共通仕様

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0.json`

```json
{
  "methods": [
    "GET",
    "POST",
    "PUT",
    "PATCH",
    "DELETE"
  ],
  "response_envelope": {
    "success": "boolean",
    "data": "object|null",
    "message": "string|null",
    "errors": "object|null"
  },
  "roles": [
    "SystemAdmin",
    "FormAdmin",
    "Operator",
    "Viewer"
  ]
}
```

## API-0007 一覧系API共通ポリシー

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0.json`

```json
{
  "pagination": {
    "type": "page/per_page",
    "required_query": [
      "page",
      "per_page"
    ],
    "required_response": [
      "items",
      "total",
      "page",
      "per_page"
    ]
  },
  "sort": {
    "enum": [
      "created_at_desc",
      "created_at_asc"
    ],
    "default": "created_at_desc"
  }
}
```

## API-0008 APIエンドポイント一覧

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0.json`

```json
{
  "id": "endpoints",
  "title": "APIエンドポイント一覧",
  "attachments_ref": "openapi.yaml"
}
```

## API-0009 RBAC

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0.json`

```json
{
  "id": "rbac",
  "title": "RBAC",
  "attachments_ref": "rbac-matrix.json"
}
```

## API-0010 差分仕様（v1.1+）

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0.json`

```json
{
  "async_queue": [
    "mail",
    "pdf",
    "webhook"
  ],
  "pdf_regeneration": true,
  "confirm_url_tokens": [
    "submitter",
    "admin",
    "notifier"
  ]
}
```

## API-0011 reforma-api-spec-v1.0.0

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.0.0.md`

# ReForma 配布物①：S-02 アカウント一覧（System Admin）実装セット（v1.0 + SUP + 2026-01-12 合意）

## 1. 画面の目的
- System Admin が管理アカウントを一覧・検索・絞り込み・並び替え・ページングし、招待の再送（bulk）を行う。

## 2. アクセス制御
- 画面アクセス：System Admin のみ（SUP-FE-006/007）
- API：Sanctum PAT（Bearer）
- 401/419：フロントは `/logout?reason=session_invalid` に統一遷移（2026-01-12 合意）

## 3. 一覧取得（List）要件
### 3.1 機能
- list / search / filter / sort / pagination
- 表示は server-side paging を前提

### 3.2 クエリ仕様（共通ポリシー準拠）
- page: required
- per_page: required
- sort: optional（enum）
  - created_at_desc（default）
  - created_at_asc
- keyword: optional（email/name 部分一致の想定）
- filters（optional）
  - status: invited | active | disabled
  - role: system_admin | form_admin | operator | viewer（表示名は別）
  - invited_only: boolean（invited のみ簡易フィルタ、必要なら）

### 3.3 レスポンス（Envelope + list_policy）
```json
{
  "success": true,
  "data": {
    "items": [
      {
        "id": 1,
        "email": "user@example.com",
        "name": "山田 太郎",
        "role": "system_admin",
        "status": "active",
        "note": null,
        "invited_at": "2026-01-01T12:34:56+09:00",
        "last_login_at": "2026-01-10T08:00:00+09:00"
      }
    ],
    "total": 123,
    "page": 1,
    "per_page": 20
  },
  "message": null,
  "errors": null
}
```

## 4. 招待再送（Bulk resend）要件
### 4.1 機能
- 一覧のチェックボックスで複数選択 → 「招待再送」
- 対象は基本的に `status=invited`（active/disabled への再送は UI 上で抑止推奨）
- 再送ポリシー：新 token 発行・旧 token 無効化（SUP-FE-007）
- レート制限（SUP-FE-007）
  - min_interval_sec: 60
  - per_hour: 5
  - per_day: 20

### 4.2 リクエスト例（提案API）
```json
{
  "user_ids": [1,2,3]
}
```

### 4.3 レスポンス例
```json
{
  "success": true,
  "data": {
    "results": [
      {"user_id": 1, "status": "sent"},
      {"user_id": 2, "status": "skipped", "reason": "not_invited_status"},
      {"user_id": 3, "status": "failed", "reason": "rate_limited"}
    ]
  },
  "message": "invite resend processed",
  "errors": null
}
```

## 5. UI 仕様（最小）
### 5.1 画面構成
- タイトル：S-02 アカウント一覧
- 検索/フィルタバー
  - keyword（input）
  - status（select）
  - role（select）
  - sort（select）
  - per_page（select 例: 20/50/100）
  - 検索実行（button）/ クリア（button）
- 一覧テーブル（推奨列）
  - checkbox
  - email
  - name
  - role
  - status
  - invited_at（任意）
  - last_login_at（任意）
  - actions（個別：再送ボタン ※ invited のみ）
- 一括アクション
  - 選択件数表示
  - 招待再送（bulk）
- pagination（page/per_page 前提）

### 5.2 禁止/安全ルール（必須）
- cannot disable self / cannot downgrade own system_admin / system_admin 0人禁止（SUP-FE-007）
  - S-02 では「編集」まで入れないとしても、将来 S-03/S-04 で必須になるので UI 側も前提として扱う

## 6. API（提案：S-02実装に必要な最小セット）
> ここは v1.0 正本に未収載のため「S-02 実装に必要な追加API（提案）」として定義。
- GET `/api/v1/system/admin-users`
  - query: page, per_page, sort, keyword?, status?, role?
- POST `/api/v1/system/admin-users/invites/resend`
  - body: user_ids[]
- GET `/api/v1/system/roles`（role フィルタのマスタ表示が必要な場合）

## 7. フロント実装メモ（事故防止）
- API base は `/reforma/api/v1`（/api 二重禁止）
- 401/419 は SessionInvalidWatcher などで統一リダイレクト
- bulk resend は部分成功を許容し、結果を toast + 詳細ダイアログで表示するのが安全


## API-0012 reforma-api-spec-v1.1.0-Laravel12-最小実装設計-API-AuthFormsResponsesA

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-Laravel12-最小実装設計-API-AuthFormsResponsesA.json`

```json
{
  "meta": {
    "title": "ReForma Laravel 12 最小実装設計（API v1.1 対象: Auth/Forms/Responses/ACK-PDF/Dashboard/SystemAdmin(SUP)）",
    "version": "1.0",
    "generated_at": "2026-01-12T16:27:29.503804",
    "timezone": "Asia/Tokyo",
    "assumptions": [
      "Laravel 12 + Sanctum（SPA session）を基本。token方式を使う場合も bearerAuth 互換。",
      "Envelope: success/data/message/errors を統一。",
      "条件分岐 ConditionState は submit/公開フォームGETで返却（UI最小I/F）。"
    ]
  },
  "routing": {
    "prefix": "/v1",
    "files": [
      {
        "file": "routes/api.php",
        "groups": [
          {
            "name": "public",
            "middleware": [],
            "routes": [
              {
                "method": "POST",
                "uri": "/forms/{form_key}/submit",
                "action": "Public\\FormSubmitController@store"
              },
              {
                "method": "GET",
                "uri": "/forms/{form_key}/ack",
                "action": "Public\\AckController@show"
              }
            ]
          },
          {
            "name": "auth",
            "middleware": [
              "auth:sanctum"
            ],
            "routes": [
              {
                "method": "POST",
                "uri": "/auth/logout",
                "action": "Auth\\LogoutController@__invoke"
              },
              {
                "method": "GET",
                "uri": "/auth/me",
                "action": "Auth\\MeController@__invoke"
              }
            ]
          },
          {
            "name": "admin",
            "middleware": [
              "auth:sanctum"
            ],
            "routes": [
              {
                "method": "GET",
                "uri": "/forms",
                "action": "Admin\\FormsController@index"
              },
              {
                "method": "POST",
                "uri": "/forms",
                "action": "Admin\\FormsController@store"
              },
              {
                "method": "GET",
                "uri": "/forms/{id}",
                "action": "Admin\\FormsController@show"
              },
              {
                "method": "PUT",
                "uri": "/forms/{id}",
                "action": "Admin\\FormsController@update"
              },
              {
                "method": "DELETE",
                "uri": "/forms/{id}",
                "action": "Admin\\FormsController@destroy"
              },
              {
                "method": "GET",
                "uri": "/forms/{id}/fields",
                "action": "Admin\\FormFieldsController@index"
              },
              {
                "method": "PUT",
                "uri": "/forms/{id}/fields",
                "action": "Admin\\FormFieldsController@update"
              },
              {
                "method": "GET",
                "uri": "/responses",
                "action": "Admin\\ResponsesController@index"
              },
              {
                "method": "GET",
                "uri": "/responses/{id}",
                "action": "Admin\\ResponsesController@show"
              },
              {
                "method": "GET",
                "uri": "/responses/{id}/pdf",
                "action": "Admin\\ResponsePdfController@show"
              },
              {
                "method": "GET",
                "uri": "/dashboard/summary",
                "action": "Admin\\DashboardController@summary"
              },
              {
                "method": "GET",
                "uri": "/dashboard/errors",
                "action": "Admin\\DashboardController@errors"
              },
              {
                "method": "GET",
                "uri": "/system/admin-users",
                "action": "System\\AdminUsersController@index"
              },
              {
                "method": "POST",
                "uri": "/system/admin-users",
                "action": "System\\AdminUsersController@store"
              },
              {
                "method": "PUT",
                "uri": "/system/admin-users/{id}",
                "action": "System\\AdminUsersController@update"
              },
              {
                "method": "POST",
                "uri": "/system/admin-users/invites/resend",
                "action": "System\\AdminUsersInviteController@resend"
              },
              {
                "method": "GET",
                "uri": "/system/admin-audit-logs",
                "action": "System\\AdminAuditLogsController@index"
              }
            ]
          },
          {
            "name": "root_only",
            "middleware": [
              "auth:sanctum",
              "can:root-only"
            ],
            "routes": [
              {
                "method": "GET",
                "uri": "/system/roles/permissions",
                "action": "Root\\RolePermissionsController@show"
              },
              {
                "method": "PUT",
                "uri": "/system/roles/permissions",
                "action": "Root\\RolePermissionsController@update"
              },
              {
                "method": "GET",
                "uri": "/system/settings",
                "action": "Root\\SettingsController@show"
              },
              {
                "method": "PUT",
                "uri": "/system/settings",
                "action": "Root\\SettingsController@update"
              }
            ]
          }
        ]
      }
    ]
  },
  "layers": {
    "controllers": "HTTP層。Request(FormRequest)で入力検証→Service呼び出し→Envelopeで返却。",
    "services": [
      "AuthService(Login/Logout/Me)",
      "FormService(Forms CRUD + publish validation hook)",
      "FormFieldService(一括更新/条件分岐ルール検証)",
      "ResponseService(list/detail + access control)",
      "PublicSubmitService(normalize→evaluate→validate→persist→dispatch async)",
      "AckService(ACK表示データ組立 + token確認)",
      "PdfService(PDF生成/取得 + latest判定)",
      "DashboardService(summary/errors)",
      "SystemAdminService(admin-users/invite/audit-logs)",
      "RootOnlyService(settings/role-permissions)"
    ],
    "domain_helpers": [
      "ConditionEvaluator(A-06) : evaluate(rule_json, answers, form_definition) -> ConditionState",
      "AnswerNormalizer : payload -> typed answers",
      "RuleValidator : ルールスキーマ・field_key存在・型整合を検証（保存/Publish時）"
    ]
  },
  "models": [
    {
      "name": "User",
      "table": "users",
      "relations": [
        "roles (belongsToMany)"
      ]
    },
    {
      "name": "Role",
      "table": "roles",
      "relations": [
        "users (belongsToMany)"
      ]
    },
    {
      "name": "Form",
      "table": "forms",
      "relations": [
        "fields (hasMany)",
        "translations (hasMany)"
      ]
    },
    {
      "name": "FormField",
      "table": "form_fields",
      "relations": [
        "form (belongsTo)",
        "translations (hasMany)"
      ]
    },
    {
      "name": "Submission",
      "table": "submissions",
      "relations": [
        "values (hasMany)",
        "pdfs (hasMany)",
        "notifications (hasMany)"
      ]
    },
    {
      "name": "SubmissionValue",
      "table": "submission_values",
      "relations": [
        "submission (belongsTo)"
      ]
    },
    {
      "name": "SubmissionPdf",
      "table": "submission_pdfs",
      "relations": [
        "submission (belongsTo)"
      ]
    }
  ],
  "migrations_min": [
    "users, roles, user_roles",
    "forms, form_translations, form_fields, form_field_translations",
    "submissions, submission_values, notifications",
    "confirm_tokens(tokens) (v1.1), submission_pdfs (v1.1)",
    "admin_audit_logs / activity_logs (名称はDB仕様のテーブルに合わせる)"
  ],
  "policies_gates": [
    {
      "gate": "root-only",
      "who": "SYSTEM_ADMIN (root flag)",
      "note": "roles/permissions, settings のみ"
    },
    {
      "policy": "FormPolicy",
      "rules": [
        "viewAny(FormAdmin/SystemAdmin)",
        "update(FormAdmin/SystemAdmin)",
        "delete(SystemAdmin)"
      ]
    },
    {
      "policy": "ResponsePolicy",
      "rules": [
        "view(LogAdmin/FormAdmin/SystemAdmin)",
        "downloadPdf(same as view)"
      ]
    },
    {
      "policy": "SystemAdminPolicy",
      "rules": [
        "manageUsers(SystemAdmin)",
        "viewAudit(SystemAdmin)"
      ]
    }
  ],
  "validation_notes": [
    "forms list/responses list/dashboard errors は page/per_page 必須（API仕様のlist_policyに揃える）",
    "FormFields 更新時に A-06 ルールの検証（RuleValidator）を実施し、CONDITION_RULE_INVALID(422) を返す",
    "Public submit では ConditionEvaluator で visible/required/store を再評価し、visible=true & required=true のみ入力検証",
    "PDF取得は権限制御 + is_latest の最新版を返す（再生成ポリシーは保留事項に従う）"
  ]
}
```

## API-0013 reforma-api-spec-v1.1.0-Laravel12-最小実装設計-OpenAPI-full.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-Laravel12-最小実装設計-OpenAPI-full.json.json`

```json
{
  "meta": {
    "title": "ReForma Laravel 12 最小実装設計（OpenAPI v1.1-full 対応）",
    "version": "1.1-full",
    "generated_at": "2026-01-12T16:39:26.031600",
    "timezone": "Asia/Tokyo",
    "scope": [
      "7.1 Auth",
      "7.2 Forms",
      "7.3 Responses",
      "7.4 ACK/PDF",
      "7.7 Dashboard",
      "7.8 System Admin(SUP)"
    ]
  },
  "stack": {
    "framework": "Laravel 12",
    "auth": "Sanctum (SPA session) + optional Bearer token",
    "queue": "database queue (v1.x) - mail/slack/pdf jobs",
    "storage": "S3 (pdfs) + local(dev)"
  },
  "routing": {
    "prefix": "/v1",
    "groups": [
      {
        "name": "public",
        "middleware": [],
        "routes": [
          {
            "method": "POST",
            "uri": "/forms/{form_key}/submit",
            "controller": "App\\Http\\Controllers\\Public\\FormSubmitController@store",
            "request": "PublicSubmitRequest"
          },
          {
            "method": "GET",
            "uri": "/forms/{form_key}/ack",
            "controller": "App\\Http\\Controllers\\Public\\AckController@show",
            "request": "AckShowRequest"
          }
        ]
      },
      {
        "name": "auth",
        "middleware": [
          "auth:sanctum"
        ],
        "routes": [
          {
            "method": "POST",
            "uri": "/auth/logout",
            "controller": "App\\Http\\Controllers\\Auth\\LogoutController@__invoke"
          },
          {
            "method": "GET",
            "uri": "/auth/me",
            "controller": "App\\Http\\Controllers\\Auth\\MeController@__invoke"
          }
        ]
      },
      {
        "name": "admin",
        "middleware": [
          "auth:sanctum"
        ],
        "routes": [
          {
            "method": "GET",
            "uri": "/forms",
            "controller": "App\\Http\\Controllers\\Admin\\FormsController@index",
            "request": "IndexRequest"
          },
          {
            "method": "POST",
            "uri": "/forms",
            "controller": "App\\Http\\Controllers\\Admin\\FormsController@store",
            "request": "FormStoreRequest"
          },
          {
            "method": "GET",
            "uri": "/forms/{id}",
            "controller": "App\\Http\\Controllers\\Admin\\FormsController@show"
          },
          {
            "method": "PUT",
            "uri": "/forms/{id}",
            "controller": "App\\Http\\Controllers\\Admin\\FormsController@update",
            "request": "FormUpdateRequest"
          },
          {
            "method": "DELETE",
            "uri": "/forms/{id}",
            "controller": "App\\Http\\Controllers\\Admin\\FormsController@destroy"
          },
          {
            "method": "GET",
            "uri": "/forms/{id}/fields",
            "controller": "App\\Http\\Controllers\\Admin\\FormFieldsController@index",
            "request": "FormFieldsIndexRequest"
          },
          {
            "method": "PUT",
            "uri": "/forms/{id}/fields",
            "controller": "App\\Http\\Controllers\\Admin\\FormFieldsController@update",
            "request": "FormFieldsUpdateRequest"
          },
          {
            "method": "GET",
            "uri": "/responses",
            "controller": "App\\Http\\Controllers\\Admin\\ResponsesController@index",
            "request": "ResponsesIndexRequest"
          },
          {
            "method": "GET",
            "uri": "/responses/{id}",
            "controller": "App\\Http\\Controllers\\Admin\\ResponsesController@show"
          },
          {
            "method": "GET",
            "uri": "/responses/{id}/pdf",
            "controller": "App\\Http\\Controllers\\Admin\\ResponsePdfController@show",
            "request": "ResponsePdfShowRequest"
          },
          {
            "method": "GET",
            "uri": "/dashboard/summary",
            "controller": "App\\Http\\Controllers\\Admin\\DashboardController@summary"
          },
          {
            "method": "GET",
            "uri": "/dashboard/errors",
            "controller": "App\\Http\\Controllers\\Admin\\DashboardController@errors",
            "request": "IndexRequest"
          },
          {
            "method": "GET",
            "uri": "/system/admin-users",
            "controller": "App\\Http\\Controllers\\System\\AdminUsersController@index",
            "request": "IndexRequest"
          },
          {
            "method": "POST",
            "uri": "/system/admin-users",
            "controller": "App\\Http\\Controllers\\System\\AdminUsersController@store",
            "request": "AdminUserStoreRequest"
          },
          {
            "method": "PUT",
            "uri": "/system/admin-users/{id}",
            "controller": "App\\Http\\Controllers\\System\\AdminUsersController@update",
            "request": "AdminUserUpdateRequest"
          },
          {
            "method": "POST",
            "uri": "/system/admin-users/invites/resend",
            "controller": "App\\Http\\Controllers\\System\\AdminUsersInviteController@resend",
            "request": "AdminUserInviteResendRequest"
          },
          {
            "method": "GET",
            "uri": "/system/admin-audit-logs",
            "controller": "App\\Http\\Controllers\\System\\AdminAuditLogsController@index",
            "request": "IndexRequest"
          }
        ]
      },
      {
        "name": "root_only",
        "middleware": [
          "auth:sanctum",
          "can:root-only"
        ],
        "routes": [
          {
            "method": "GET",
            "uri": "/system/roles/permissions",
            "controller": "App\\Http\\Controllers\\Root\\RolePermissionsController@show"
          },
          {
            "method": "PUT",
            "uri": "/system/roles/permissions",
            "controller": "App\\Http\\Controllers\\Root\\RolePermissionsController@update",
            "request": "RolePermissionsUpdateRequest"
          },
          {
            "method": "GET",
            "uri": "/system/settings",
            "controller": "App\\Http\\Controllers\\Root\\SettingsController@show"
          },
          {
            "method": "PUT",
            "uri": "/system/settings",
            "controller": "App\\Http\\Controllers\\Root\\SettingsController@update",
            "request": "SettingsUpdateRequest"
          }
        ]
      }
    ]
  },
  "requests": {
    "common": [
      {
        "name": "IndexRequest",
        "rules": {
          "page": "required|integer|min:1",
          "per_page": "required|integer|min:1|max:200",
          "sort": "nullable|in:created_at_desc,created_at_asc"
        }
      }
    ],
    "admin": [
      {
        "name": "FormStoreRequest",
        "rules": {
          "code": "required|string|max:100|unique:forms,code",
          "is_public": "boolean",
          "translations": "array",
          "translations.*.locale": "in:ja,en",
          "translations.*.title": "required_with:translations|string"
        }
      },
      {
        "name": "FormUpdateRequest",
        "rules": {
          "status": "in:draft,published,closed",
          "is_public": "boolean",
          "translations": "array"
        }
      },
      {
        "name": "FormFieldsUpdateRequest",
        "rules": {
          "fields": "required|array",
          "fields.*.field_key": "required|string",
          "fields.*.type": "required|string",
          "fields.*.sort_order": "required|integer",
          "fields.*.is_required": "boolean",
          "fields.*.visibility_rule": "nullable|array",
          "fields.*.required_rule": "nullable|array",
          "fields.*.step_transition_rule": "nullable|array"
        }
      },
      {
        "name": "ResponsesIndexRequest",
        "rules": {
          "page": "required|integer|min:1",
          "per_page": "required|integer|min:1|max:200",
          "sort": "nullable|in:created_at_desc,created_at_asc",
          "form_id": "nullable|integer",
          "status": "nullable|in:received,confirmed",
          "q": "nullable|string"
        }
      },
      {
        "name": "ResponsePdfShowRequest",
        "rules": {
          "pdf_type": "nullable|in:submission,ack"
        }
      },
      {
        "name": "AdminUserStoreRequest",
        "rules": {
          "name": "required|string",
          "email": "required|email|unique:users,email",
          "roles": "required|array",
          "roles.*": "in:SYSTEM_ADMIN,FORM_ADMIN,LOG_ADMIN"
        }
      },
      {
        "name": "AdminUserUpdateRequest",
        "rules": {
          "name": "nullable|string",
          "status": "nullable|in:active,suspended",
          "roles": "nullable|array",
          "roles.*": "in:SYSTEM_ADMIN,FORM_ADMIN,LOG_ADMIN"
        }
      },
      {
        "name": "AdminUserInviteResendRequest",
        "rules": {
          "user_id": "required|integer|exists:users,id"
        }
      }
    ],
    "public": [
      {
        "name": "PublicSubmitRequest",
        "rules": {
          "answers": "required|array",
          "locale": "nullable|in:ja,en",
          "mode": "nullable|in:both,value,label"
        }
      },
      {
        "name": "AckShowRequest",
        "rules": {
          "token": "nullable|string",
          "submission_id": "nullable|integer"
        }
      }
    ],
    "root_only": [
      {
        "name": "RolePermissionsUpdateRequest",
        "rules": {
          "roles": "required|array",
          "roles.*.role": "required|string",
          "roles.*.permissions": "required|array"
        }
      },
      {
        "name": "SettingsUpdateRequest",
        "rules": {
          "settings": "required|array"
        }
      }
    ]
  },
  "services": [
    {
      "name": "ConditionEvaluator",
      "responsibility": "A-06 ルール評価→ConditionState生成（安全側フォールバック）"
    },
    {
      "name": "RuleValidator",
      "responsibility": "フォーム項目更新/Publish時にルール妥当性検証（CONDITION_RULE_INVALID）"
    },
    {
      "name": "PublicSubmitService",
      "responsibility": "answers正規化→評価→visible/required検証→保存→notifications/pdf jobs dispatch"
    },
    {
      "name": "PdfService",
      "responsibility": "submission_pdfs の最新版取得/生成（再生成ポリシーは保留事項へ委譲）"
    },
    {
      "name": "DashboardService",
      "responsibility": "集計/エラー一覧"
    },
    {
      "name": "SystemAdminService",
      "responsibility": "管理者ユーザ管理/招待/監査ログ"
    },
    {
      "name": "RootOnlyService",
      "responsibility": "settings/role-permissions"
    }
  ],
  "jobs": [
    {
      "name": "SendNotificationJob",
      "channel": "mail/slack",
      "trigger": "after submission commit"
    },
    {
      "name": "GenerateSubmissionPdfJob",
      "trigger": "after submission commit or on-demand"
    }
  ],
  "models": [
    {
      "name": "User",
      "table": "users"
    },
    {
      "name": "Role",
      "table": "roles"
    },
    {
      "name": "Form",
      "table": "forms"
    },
    {
      "name": "FormTranslation",
      "table": "form_translations"
    },
    {
      "name": "FormField",
      "table": "form_fields"
    },
    {
      "name": "FormFieldTranslation",
      "table": "form_field_translations"
    },
    {
      "name": "Submission",
      "table": "submissions"
    },
    {
      "name": "SubmissionValue",
      "table": "submission_values"
    },
    {
      "name": "Notification",
      "table": "notifications"
    },
    {
      "name": "SubmissionPdf",
      "table": "submission_pdfs"
    }
  ],
  "policies": [
    {
      "name": "FormPolicy",
      "rules": [
        "viewAny(form_admin|system_admin)",
        "update(form_admin|system_admin)",
        "delete(system_admin)"
      ]
    },
    {
      "name": "ResponsePolicy",
      "rules": [
        "view(log_admin|form_admin|system_admin)",
        "downloadPdf(viewと同等)"
      ]
    },
    {
      "name": "SystemAdminPolicy",
      "rules": [
        "manageUsers(system_admin)",
        "viewAudit(system_admin)"
      ]
    }
  ],
  "responses": {
    "envelope": "success/data/message/errors",
    "error_codes": [
      "VALIDATION_ERROR",
      "CONDITION_RULE_INVALID",
      "CONDITION_EVAL_ERROR",
      "STEP_TRANSITION_DENIED",
      "UNAUTHORIZED",
      "FORBIDDEN"
    ]
  }
}
```

## API-0014 reforma-api-spec-v1.1.0-openapi-draft.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-openapi-draft.json.json`

```json
{
  "openapi": "3.0.3",
  "info": {
    "title": "ReForma API v1.1 (OpenAPI Draft) - Auth/Forms/Responses/ACK-PDF/Dashboard/SystemAdmin(SUP)",
    "version": "1.1-draft",
    "description": "03.ReForma API 仕様書 v1.1（統合版）を元に、実装フェーズ向けに OpenAPI を起草（不足パラメータは v1.1 正本で追補予定）。"
  },
  "servers": [
    {
      "url": "/"
    }
  ],
  "tags": [
    {
      "name": "Auth"
    },
    {
      "name": "Forms"
    },
    {
      "name": "Responses"
    },
    {
      "name": "ACK"
    },
    {
      "name": "PDF"
    },
    {
      "name": "Dashboard"
    },
    {
      "name": "System"
    },
    {
      "name": "SUP (root-only)"
    }
  ],
  "components": {
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "JWT",
        "description": "v1.0例は Bearer JWT。v1.1は Sanctum等のSPAセッションも許容（実装で統一）。"
      }
    },
    "schemas": {
      "EnvelopeSuccess": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": [
              "object",
              "null"
            ]
          }
        },
        "required": [
          "success",
          "data",
          "message",
          "errors"
        ]
      },
      "EnvelopeError": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "null"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": [
              "object",
              "null"
            ]
          }
        },
        "required": [
          "success",
          "data",
          "message",
          "errors"
        ]
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "ユーザID"
          },
          "name": {
            "type": "string",
            "description": "表示名"
          },
          "email": {
            "type": "string",
            "description": "メールアドレス"
          },
          "status": {
            "type": "string",
            "description": "active / suspended",
            "enum": [
              "active",
              "suspended"
            ]
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "description": "ロール（代表）"
          }
        },
        "required": [
          "id",
          "name",
          "email",
          "status"
        ]
      },
      "Form": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "フォームID"
          },
          "code": {
            "type": "string",
            "description": "フォーム識別子（form_key/公開キー）"
          },
          "status": {
            "type": "string",
            "description": "draft / published / closed",
            "enum": [
              "draft",
              "published",
              "closed"
            ]
          },
          "version": {
            "type": "integer",
            "format": "int64",
            "description": "定義バージョン（任意）"
          },
          "title": {
            "type": "string",
            "description": "フォーム名（既定ロケール）"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "code",
          "status"
        ]
      },
      "FormField": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "項目ID"
          },
          "field_key": {
            "type": "string",
            "description": "field_key"
          },
          "type": {
            "type": "string",
            "description": "field type"
          },
          "label": {
            "type": "string",
            "description": "表示ラベル（既定ロケール）"
          },
          "is_required": {
            "type": "boolean",
            "description": "固定必須"
          },
          "visibility_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 条件分岐 JSON (visibility_rule)"
          },
          "required_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 条件分岐 JSON (required_rule)"
          }
        },
        "required": [
          "id",
          "field_key",
          "type",
          "label",
          "is_required"
        ]
      },
      "ConditionState": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "enum": [
              "1"
            ]
          },
          "evaluated_at": {
            "type": "string",
            "format": "date-time"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean"
                },
                "required": {
                  "type": "boolean"
                },
                "store": {
                  "type": "string",
                  "enum": [
                    "store",
                    "do_not_store"
                  ]
                },
                "eval": {
                  "type": "string",
                  "enum": [
                    "ok",
                    "fallback",
                    "error"
                  ]
                },
                "reasons": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "kind": {
                        "type": "string",
                        "enum": [
                          "rule",
                          "type",
                          "missing_field",
                          "unknown_operator"
                        ]
                      },
                      "path": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  },
                  "description": "任意（デバッグ用途）"
                }
              },
              "required": [
                "visible",
                "required",
                "store",
                "eval"
              ]
            }
          },
          "step": {
            "type": [
              "object",
              "null"
            ],
            "description": "STEP遷移状態（将来/STEPモード）"
          }
        },
        "required": [
          "version",
          "evaluated_at",
          "fields"
        ],
        "description": "条件分岐評価結果（API→UI I/F）"
      },
      "Submission": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "送信ID"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "forms.id"
          },
          "status": {
            "type": "string",
            "description": "received / confirmed",
            "enum": [
              "received",
              "confirmed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "form_id",
          "status",
          "created_at"
        ]
      },
      "SubmissionValue": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "field_key": {
            "type": "string"
          },
          "value": {
            "type": [
              "string",
              "number",
              "boolean",
              "array",
              "object",
              "null"
            ],
            "description": "value(JSON)"
          },
          "label": {
            "type": [
              "string",
              "null"
            ],
            "description": "label snapshot (optional)"
          }
        },
        "required": [
          "id",
          "submission_id",
          "field_key",
          "value"
        ]
      },
      "PaginatedForms": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "format": "int64",
                  "description": "フォームID"
                },
                "code": {
                  "type": "string",
                  "description": "フォーム識別子（form_key/公開キー）"
                },
                "status": {
                  "type": "string",
                  "description": "draft / published / closed",
                  "enum": [
                    "draft",
                    "published",
                    "closed"
                  ]
                },
                "version": {
                  "type": "integer",
                  "format": "int64",
                  "description": "定義バージョン（任意）"
                },
                "title": {
                  "type": "string",
                  "description": "フォーム名（既定ロケール）"
                },
                "updated_at": {
                  "type": "string",
                  "format": "date-time"
                }
              },
              "required": [
                "id",
                "code",
                "status"
              ]
            }
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "total": {
            "type": "integer",
            "format": "int32"
          }
        },
        "required": [
          "items",
          "page",
          "per_page",
          "total"
        ]
      },
      "PaginatedResponses": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "id": {
                  "type": "integer",
                  "format": "int64",
                  "description": "送信ID"
                },
                "form_id": {
                  "type": "integer",
                  "format": "int64",
                  "description": "forms.id"
                },
                "status": {
                  "type": "string",
                  "description": "received / confirmed",
                  "enum": [
                    "received",
                    "confirmed"
                  ]
                },
                "created_at": {
                  "type": "string",
                  "format": "date-time"
                }
              },
              "required": [
                "id",
                "form_id",
                "status",
                "created_at"
              ]
            }
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "total": {
            "type": "integer",
            "format": "int32"
          }
        },
        "required": [
          "items",
          "page",
          "per_page",
          "total"
        ]
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "401 Unauthorized",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "type": "boolean"
                },
                "data": {
                  "type": "null"
                },
                "message": {
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "errors": {
                  "type": [
                    "object",
                    "null"
                  ]
                }
              },
              "required": [
                "success",
                "data",
                "message",
                "errors"
              ]
            }
          }
        }
      },
      "Forbidden": {
        "description": "403 Forbidden",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "type": "boolean"
                },
                "data": {
                  "type": "null"
                },
                "message": {
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "errors": {
                  "type": [
                    "object",
                    "null"
                  ]
                }
              },
              "required": [
                "success",
                "data",
                "message",
                "errors"
              ]
            }
          }
        }
      },
      "ValidationError": {
        "description": "422 Validation Error",
        "content": {
          "application/json": {
            "schema": {
              "type": "object",
              "properties": {
                "success": {
                  "type": "boolean"
                },
                "data": {
                  "type": "null"
                },
                "message": {
                  "type": [
                    "string",
                    "null"
                  ]
                },
                "errors": {
                  "type": [
                    "object",
                    "null"
                  ]
                }
              },
              "required": [
                "success",
                "data",
                "message",
                "errors"
              ]
            }
          }
        }
      }
    }
  },
  "paths": {
    "/v1/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログイン",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": {
                          "type": "string",
                          "description": "Bearer token (if token-based)"
                        },
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      }
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string"
                  },
                  "remember": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "email",
                  "password"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログアウト",
        "responses": {
          "204": {
            "description": "No Content"
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "自分自身の情報",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/forms": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム一覧取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "forms": {
                          "$ref": "#/components/schemas/PaginatedForms"
                        }
                      },
                      "required": [
                        "forms"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム作成",
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "フォーム識別子"
                  },
                  "title": {
                    "type": "string",
                    "description": "フォーム名"
                  }
                },
                "required": [
                  "code",
                  "title"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{id}": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "published",
                      "closed"
                    ]
                  },
                  "title": {
                    "type": "string"
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム削除（論理）",
        "responses": {
          "204": {
            "description": "No Content"
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{id}/fields": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一覧取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一括更新（定義JSON保存）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "fields": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormField"
                    }
                  }
                },
                "required": [
                  "fields"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/responses": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信一覧（Responses）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "responses": {
                          "$ref": "#/components/schemas/PaginatedResponses"
                        }
                      },
                      "required": [
                        "responses"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          },
          {
            "name": "form_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "received",
                "confirmed"
              ]
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信詳細（Responses）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "response": {
                          "$ref": "#/components/schemas/Submission"
                        },
                        "values": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionValue"
                          }
                        }
                      },
                      "required": [
                        "response",
                        "values"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{form_key}/submit": {
      "post": {
        "tags": [
          "Forms"
        ],
        "summary": "公開 submit",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "submission_id": {
                          "type": "integer",
                          "format": "int64"
                        },
                        "ack_url": {
                          "type": "string",
                          "description": "ACK URL（UI遷移用）"
                        },
                        "condition_state": {
                          "$ref": "#/components/schemas/ConditionState"
                        }
                      },
                      "required": [
                        "submission_id",
                        "ack_url"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "answers": {
                    "type": "object",
                    "additionalProperties": {}
                  },
                  "locale": {
                    "type": "string"
                  }
                },
                "required": [
                  "answers"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{form_key}/ack": {
      "get": {
        "tags": [
          "ACK"
        ],
        "summary": "ACK 表示データ取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "ack": {
                          "type": "object",
                          "description": "ACK 表示用（テンプレ/文言は仕様へ委譲）"
                        },
                        "pdf_url": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "PDFダウンロードURL（許可される場合）"
                        }
                      },
                      "required": [
                        "ack"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "name": "token",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false,
            "description": "confirm_url token（必要な場合）"
          },
          {
            "name": "submission_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}/pdf": {
      "get": {
        "tags": [
          "PDF"
        ],
        "summary": "PDF 取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "type",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "submission",
                "ack"
              ]
            },
            "required": false
          }
        ]
      }
    },
    "/v1/dashboard/summary": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード集計",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "summary": {
                          "type": "object",
                          "description": "件数など（詳細は正本へ委譲）"
                        }
                      },
                      "required": [
                        "summary"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/dashboard/errors": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード エラー一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "errors": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "kind": {
                                    "type": "string"
                                  },
                                  "message": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "kind",
                                  "message",
                                  "created_at"
                                ]
                              }
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            }
                          },
                          "required": [
                            "items",
                            "page",
                            "per_page",
                            "total"
                          ]
                        }
                      },
                      "required": [
                        "errors"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/admin-users": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "管理者ユーザ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64",
                                    "description": "ユーザID"
                                  },
                                  "name": {
                                    "type": "string",
                                    "description": "表示名"
                                  },
                                  "email": {
                                    "type": "string",
                                    "description": "メールアドレス"
                                  },
                                  "status": {
                                    "type": "string",
                                    "description": "active / suspended",
                                    "enum": [
                                      "active",
                                      "suspended"
                                    ]
                                  },
                                  "roles": {
                                    "type": "array",
                                    "items": {
                                      "type": "string",
                                      "enum": [
                                        "SYSTEM_ADMIN",
                                        "FORM_ADMIN",
                                        "LOG_ADMIN"
                                      ]
                                    },
                                    "description": "ロール（代表）"
                                  }
                                },
                                "required": [
                                  "id",
                                  "name",
                                  "email",
                                  "status"
                                ]
                              }
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            }
                          },
                          "required": [
                            "items",
                            "page",
                            "per_page",
                            "total"
                          ]
                        }
                      },
                      "required": [
                        "users"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "System"
        ],
        "summary": "管理者ユーザ作成（招待）",
        "responses": {
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer",
                              "format": "int64",
                              "description": "ユーザID"
                            },
                            "name": {
                              "type": "string",
                              "description": "表示名"
                            },
                            "email": {
                              "type": "string",
                              "description": "メールアドレス"
                            },
                            "status": {
                              "type": "string",
                              "description": "active / suspended",
                              "enum": [
                                "active",
                                "suspended"
                              ]
                            },
                            "roles": {
                              "type": "array",
                              "items": {
                                "type": "string",
                                "enum": [
                                  "SYSTEM_ADMIN",
                                  "FORM_ADMIN",
                                  "LOG_ADMIN"
                                ]
                              },
                              "description": "ロール（代表）"
                            }
                          },
                          "required": [
                            "id",
                            "name",
                            "email",
                            "status"
                          ]
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "付与ロール"
                  }
                },
                "required": [
                  "name",
                  "email",
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/{id}": {
      "put": {
        "tags": [
          "System"
        ],
        "summary": "管理者ユーザ更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "type": "object",
                          "properties": {
                            "id": {
                              "type": "integer",
                              "format": "int64",
                              "description": "ユーザID"
                            },
                            "name": {
                              "type": "string",
                              "description": "表示名"
                            },
                            "email": {
                              "type": "string",
                              "description": "メールアドレス"
                            },
                            "status": {
                              "type": "string",
                              "description": "active / suspended",
                              "enum": [
                                "active",
                                "suspended"
                              ]
                            },
                            "roles": {
                              "type": "array",
                              "items": {
                                "type": "string",
                                "enum": [
                                  "SYSTEM_ADMIN",
                                  "FORM_ADMIN",
                                  "LOG_ADMIN"
                                ]
                              },
                              "description": "ロール（代表）"
                            }
                          },
                          "required": [
                            "id",
                            "name",
                            "email",
                            "status"
                          ]
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "suspended"
                    ]
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/invites/resend": {
      "post": {
        "tags": [
          "System"
        ],
        "summary": "招待メール再送",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "sent": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "sent"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": {
                    "type": "integer",
                    "format": "int64"
                  }
                },
                "required": [
                  "user_id"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-audit-logs": {
      "get": {
        "tags": [
          "System"
        ],
        "summary": "監査ログ一覧（管理者）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logs": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "actor_user_id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "action": {
                                    "type": "string"
                                  },
                                  "target": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "actor_user_id",
                                  "action",
                                  "created_at"
                                ]
                              }
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            }
                          },
                          "required": [
                            "items",
                            "page",
                            "per_page",
                            "total"
                          ]
                        }
                      },
                      "required": [
                        "logs"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "action",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/roles/permissions": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義取得（root-only）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "roles": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "role": {
                                "type": "string"
                              },
                              "permissions": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            },
                            "required": [
                              "role",
                              "permissions"
                            ]
                          }
                        }
                      },
                      "required": [
                        "roles"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義更新（root-only）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "updated"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "role": {
                          "type": "string"
                        },
                        "permissions": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      },
                      "required": [
                        "role",
                        "permissions"
                      ]
                    }
                  }
                },
                "required": [
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/settings": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定取得（root-only）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定更新（root-only）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "null"
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "settings": {
                    "type": "object"
                  }
                },
                "required": [
                  "settings"
                ]
              }
            }
          }
        }
      }
    }
  }
}
```

## API-0015 reforma-api-spec-v1.1.0-openapi-draft.yaml

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-openapi-draft.yaml.yaml`

openapi: 3.0.3
info:
  title: ReForma API v1.1 (OpenAPI Draft) - Auth/Forms/Responses/ACK-PDF/Dashboard/SystemAdmin(SUP)
  version: 1.1-draft
  description: 03.ReForma API 仕様書 v1.1（統合版）を元に、実装フェーズ向けに OpenAPI を起草（不足パラメータは v1.1
    正本で追補予定）。
servers:
- url: /
tags:
- name: Auth
- name: Forms
- name: Responses
- name: ACK
- name: PDF
- name: Dashboard
- name: System
- name: SUP (root-only)
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: v1.0例は Bearer JWT。v1.1は Sanctum等のSPAセッションも許容（実装で統一）。
  schemas:
    EnvelopeSuccess:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        message:
          type:
          - string
          - 'null'
        errors:
          type:
          - object
          - 'null'
      required:
      - success
      - data
      - message
      - errors
    EnvelopeError: &id003
      type: object
      properties:
        success:
          type: boolean
        data:
          type: 'null'
        message:
          type:
          - string
          - 'null'
        errors:
          type:
          - object
          - 'null'
      required:
      - success
      - data
      - message
      - errors
    User: &id014
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: ユーザID
        name:
          type: string
          description: 表示名
        email:
          type: string
          description: メールアドレス
        status:
          type: string
          description: active / suspended
          enum:
          - active
          - suspended
        roles:
          type: array
          items:
            type: string
            enum:
            - SYSTEM_ADMIN
            - FORM_ADMIN
            - LOG_ADMIN
          description: ロール（代表）
      required:
      - id
      - name
      - email
      - status
    Form: &id001
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: フォームID
        code:
          type: string
          description: フォーム識別子（form_key/公開キー）
        status:
          type: string
          description: draft / published / closed
          enum:
          - draft
          - published
          - closed
        version:
          type: integer
          format: int64
          description: 定義バージョン（任意）
        title:
          type: string
          description: フォーム名（既定ロケール）
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - code
      - status
    FormField:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 項目ID
        field_key:
          type: string
          description: field_key
        type:
          type: string
          description: field type
        label:
          type: string
          description: 表示ラベル（既定ロケール）
        is_required:
          type: boolean
          description: 固定必須
        visibility_rule:
          type:
          - object
          - 'null'
          description: A-06 条件分岐 JSON (visibility_rule)
        required_rule:
          type:
          - object
          - 'null'
          description: A-06 条件分岐 JSON (required_rule)
      required:
      - id
      - field_key
      - type
      - label
      - is_required
    ConditionState:
      type: object
      properties:
        version:
          type: string
          enum:
          - '1'
        evaluated_at:
          type: string
          format: date-time
        fields:
          type: object
          additionalProperties:
            type: object
            properties:
              visible:
                type: boolean
              required:
                type: boolean
              store:
                type: string
                enum:
                - store
                - do_not_store
              eval:
                type: string
                enum:
                - ok
                - fallback
                - error
              reasons:
                type: array
                items:
                  type: object
                  properties:
                    kind:
                      type: string
                      enum:
                      - rule
                      - type
                      - missing_field
                      - unknown_operator
                    path:
                      type: string
                    message:
                      type: string
                description: 任意（デバッグ用途）
            required:
            - visible
            - required
            - store
            - eval
        step:
          type:
          - object
          - 'null'
          description: STEP遷移状態（将来/STEPモード）
      required:
      - version
      - evaluated_at
      - fields
      description: 条件分岐評価結果（API→UI I/F）
    Submission: &id002
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: 送信ID
        form_id:
          type: integer
          format: int64
          description: forms.id
        status:
          type: string
          description: received / confirmed
          enum:
          - received
          - confirmed
        created_at:
          type: string
          format: date-time
      required:
      - id
      - form_id
      - status
      - created_at
    SubmissionValue:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        field_key:
          type: string
        value:
          type:
          - string
          - number
          - boolean
          - array
          - object
          - 'null'
          description: value(JSON)
        label:
          type:
          - string
          - 'null'
          description: label snapshot (optional)
      required:
      - id
      - submission_id
      - field_key
      - value
    PaginatedForms:
      type: object
      properties:
        items:
          type: array
          items: *id001
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        total:
          type: integer
          format: int32
      required:
      - items
      - page
      - per_page
      - total
    PaginatedResponses:
      type: object
      properties:
        items:
          type: array
          items: *id002
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        total:
          type: integer
          format: int32
      required:
      - items
      - page
      - per_page
      - total
  responses:
    Unauthorized: &id005
      description: 401 Unauthorized
      content:
        application/json:
          schema: *id003
    Forbidden: &id006
      description: 403 Forbidden
      content:
        application/json:
          schema: *id003
    ValidationError: &id004
      description: 422 Validation Error
      content:
        application/json:
          schema: *id003
paths:
  /v1/auth/login:
    post:
      tags:
      - Auth
      summary: ログイン
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                        description: Bearer token (if token-based)
                      user:
                        $ref: '#/components/schemas/User'
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422': *id004
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                remember:
                  type: boolean
              required:
              - email
              - password
  /v1/auth/logout:
    post:
      tags:
      - Auth
      summary: ログアウト
      responses:
        '204':
          description: No Content
        '401': *id005
      security:
      - bearerAuth: []
  /v1/auth/me:
    get:
      tags:
      - Auth
      summary: 自分自身の情報
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
      security:
      - bearerAuth: []
  /v1/forms:
    get:
      tags:
      - Forms
      summary: フォーム一覧取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      forms:
                        $ref: '#/components/schemas/PaginatedForms'
                    required:
                    - forms
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters: &id013
      - &id008
        name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - &id009
        name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - &id010
        name: sort
        in: query
        schema:
          type: string
        required: false
    post:
      tags:
      - Forms
      summary: フォーム作成
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: フォーム識別子
                title:
                  type: string
                  description: フォーム名
              required:
              - code
              - title
  /v1/forms/{id}:
    get:
      tags:
      - Forms
      summary: フォーム取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters: &id007
      - &id012
        name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
    put:
      tags:
      - Forms
      summary: フォーム更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      parameters: *id007
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                  - draft
                  - published
                  - closed
                title:
                  type: string
    delete:
      tags:
      - Forms
      summary: フォーム削除（論理）
      responses:
        '204':
          description: No Content
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters: *id007
  /v1/forms/{id}/fields:
    get:
      tags:
      - Forms
      summary: フォーム項目一覧取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters: *id007
    put:
      tags:
      - Forms
      summary: フォーム項目一括更新（定義JSON保存）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      parameters: *id007
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fields:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormField'
              required:
              - fields
  /v1/responses:
    get:
      tags:
      - Responses
      summary: 送信一覧（Responses）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      responses:
                        $ref: '#/components/schemas/PaginatedResponses'
                    required:
                    - responses
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters:
      - *id008
      - *id009
      - *id010
      - name: form_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - received
          - confirmed
        required: false
  /v1/responses/{id}:
    get:
      tags:
      - Responses
      summary: 送信詳細（Responses）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      response:
                        $ref: '#/components/schemas/Submission'
                      values:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionValue'
                    required:
                    - response
                    - values
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters: *id007
  /v1/forms/{form_key}/submit:
    post:
      tags:
      - Forms
      summary: 公開 submit
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      submission_id:
                        type: integer
                        format: int64
                      ack_url:
                        type: string
                        description: ACK URL（UI遷移用）
                      condition_state:
                        $ref: '#/components/schemas/ConditionState'
                    required:
                    - submission_id
                    - ack_url
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422': *id004
      parameters:
      - &id011
        name: form_key
        in: path
        schema:
          type: string
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                answers:
                  type: object
                  additionalProperties: {}
                locale:
                  type: string
              required:
              - answers
  /v1/forms/{form_key}/ack:
    get:
      tags:
      - ACK
      summary: ACK 表示データ取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      ack:
                        type: object
                        description: ACK 表示用（テンプレ/文言は仕様へ委譲）
                      pdf_url:
                        type:
                        - string
                        - 'null'
                        description: PDFダウンロードURL（許可される場合）
                    required:
                    - ack
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
      parameters:
      - *id011
      - name: token
        in: query
        schema:
          type: string
        required: false
        description: confirm_url token（必要な場合）
      - name: submission_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
  /v1/responses/{id}/pdf:
    get:
      tags:
      - PDF
      summary: PDF 取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: string
                format: binary
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters:
      - *id012
      - name: type
        in: query
        schema:
          type: string
          enum:
          - submission
          - ack
        required: false
  /v1/dashboard/summary:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード集計
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      summary:
                        type: object
                        description: 件数など（詳細は正本へ委譲）
                    required:
                    - summary
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
  /v1/dashboard/errors:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード エラー一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      errors:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                kind:
                                  type: string
                                message:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - kind
                              - message
                              - created_at
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          total:
                            type: integer
                            format: int32
                        required:
                        - items
                        - page
                        - per_page
                        - total
                    required:
                    - errors
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters: *id013
  /v1/system/admin-users:
    get:
      tags:
      - System
      summary: 管理者ユーザ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      users:
                        type: object
                        properties:
                          items:
                            type: array
                            items: *id014
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          total:
                            type: integer
                            format: int32
                        required:
                        - items
                        - page
                        - per_page
                        - total
                    required:
                    - users
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters: *id013
    post:
      tags:
      - System
      summary: 管理者ユーザ作成（招待）
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user: *id014
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                roles:
                  type: array
                  items:
                    type: string
                  description: 付与ロール
              required:
              - name
              - email
              - roles
  /v1/system/admin-users/{id}:
    put:
      tags:
      - System
      summary: 管理者ユーザ更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user: *id014
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      parameters: *id007
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                status:
                  type: string
                  enum:
                  - active
                  - suspended
                roles:
                  type: array
                  items:
                    type: string
  /v1/system/admin-users/invites/resend:
    post:
      tags:
      - System
      summary: 招待メール再送
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sent:
                        type: boolean
                    required:
                    - sent
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  format: int64
              required:
              - user_id
  /v1/system/admin-audit-logs:
    get:
      tags:
      - System
      summary: 監査ログ一覧（管理者）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logs:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                actor_user_id:
                                  type: integer
                                  format: int64
                                action:
                                  type: string
                                target:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - actor_user_id
                              - action
                              - created_at
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          total:
                            type: integer
                            format: int32
                        required:
                        - items
                        - page
                        - per_page
                        - total
                    required:
                    - logs
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
      parameters:
      - *id008
      - *id009
      - *id010
      - name: user_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: action
        in: query
        schema:
          type: string
        required: false
  /v1/system/roles/permissions:
    get:
      tags:
      - SUP (root-only)
      summary: ロール権限定義取得（root-only）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      roles:
                        type: array
                        items:
                          type: object
                          properties:
                            role:
                              type: string
                            permissions:
                              type: array
                              items:
                                type: string
                          required:
                          - role
                          - permissions
                    required:
                    - roles
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: ロール権限定義更新（root-only）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      updated:
                        type: boolean
                    required:
                    - updated
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string
                    required:
                    - role
                    - permissions
              required:
              - roles
  /v1/system/settings:
    get:
      tags:
      - SUP (root-only)
      summary: システム設定取得（root-only）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: システム設定更新（root-only）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id005
        '403': *id006
        '422': *id004
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                settings:
                  type: object
              required:
              - settings


## API-0016 reforma-api-spec-v1.1.0-openapi-full+supplements.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-openapi-full+supplements.json.json`

```json
{
  "openapi": "3.0.3",
  "info": {
    "title": "ReForma API v1.1 OpenAPI（追補反映: theme/computed）",
    "version": "1.1-openapi-draft-full+supplements",
    "description": "API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI を“実装可能な粒度”まで増補した草案。"
  },
  "servers": [
    {
      "url": "/"
    }
  ],
  "tags": [
    {
      "name": "Auth"
    },
    {
      "name": "Forms"
    },
    {
      "name": "Responses"
    },
    {
      "name": "ACK/PDF"
    },
    {
      "name": "Dashboard"
    },
    {
      "name": "System Admin"
    },
    {
      "name": "SUP (root-only)"
    }
  ],
  "components": {
    "securitySchemes": {
      "sanctum": {
        "type": "apiKey",
        "in": "cookie",
        "name": "XSRF-TOKEN",
        "description": "Sanctum SPA session（例）。実装により Bearer 併用可"
      },
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "Token"
      }
    },
    "schemas": {
      "EnvelopeSuccess": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": [
              "object",
              "null"
            ]
          }
        },
        "required": [
          "success",
          "data",
          "message",
          "errors"
        ]
      },
      "EnvelopeError": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "null"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "description": "エラーコード"
              },
              "fields": {
                "type": "object",
                "additionalProperties": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "エラーメッセージ配列"
                }
              },
              "rule": {
                "type": [
                  "object",
                  "null"
                ]
              },
              "step": {
                "type": [
                  "object",
                  "null"
                ]
              }
            },
            "required": [
              "code"
            ],
            "description": "errors 本体（用途に応じて fields/rule/step を利用）"
          }
        },
        "required": [
          "success",
          "data",
          "message",
          "errors"
        ]
      },
      "ErrorObject": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "エラーコード"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "エラーメッセージ配列"
            }
          },
          "rule": {
            "type": [
              "object",
              "null"
            ]
          },
          "step": {
            "type": [
              "object",
              "null"
            ]
          }
        },
        "required": [
          "code"
        ],
        "description": "errors 本体（用途に応じて fields/rule/step を利用）"
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "users.id"
          },
          "name": {
            "type": "string",
            "description": "表示名"
          },
          "email": {
            "type": "string",
            "description": "メールアドレス",
            "format": "email"
          },
          "status": {
            "type": "string",
            "description": "active / suspended",
            "enum": [
              "active",
              "suspended"
            ]
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "description": "付与ロール"
          }
        },
        "required": [
          "id",
          "name",
          "email",
          "status",
          "roles"
        ]
      },
      "Form": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "forms.id"
          },
          "code": {
            "type": "string",
            "description": "forms.code（フォーム識別子）"
          },
          "status": {
            "type": "string",
            "description": "forms.status",
            "enum": [
              "draft",
              "published",
              "closed"
            ]
          },
          "is_public": {
            "type": "boolean",
            "description": "forms.is_public"
          },
          "created_by": {
            "type": "integer",
            "format": "int64",
            "description": "forms.created_by"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "theme_id": {
            "type": [
              "string",
              "null"
            ],
            "description": "フォームテーマID（公開フォーム専用）"
          },
          "theme_tokens": {
            "type": [
              "object",
              "null"
            ],
            "description": "テーマトークン（CSS変数）",
            "additionalProperties": {
              "oneOf": [
                {
                  "type": "string"
                },
                {
                  "type": "number"
                },
                {
                  "type": "boolean"
                },
                {
                  "type": "null"
                }
              ]
            }
          },
          "theme_scope": {
            "type": [
              "string",
              "null"
            ],
            "description": "(契約) テーマ適用スコープ。公開フォームは form_container_only（管理画面テーマと分離）",
            "enum": [
              "form_container_only",
              null
            ]
          }
        },
        "required": [
          "id",
          "code",
          "status",
          "is_public",
          "created_by",
          "created_at",
          "updated_at"
        ]
      },
      "FormTranslation": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "form_id": {
            "type": "integer",
            "format": "int64"
          },
          "locale": {
            "type": "string",
            "enum": [
              "ja",
              "en"
            ]
          },
          "title": {
            "type": "string",
            "description": "フォーム名"
          },
          "description": {
            "type": "string",
            "description": "説明",
            "example": ""
          }
        },
        "required": [
          "id",
          "form_id",
          "locale",
          "title"
        ]
      },
      "FormField": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.form_id"
          },
          "field_key": {
            "type": "string",
            "description": "form_fields.field_key"
          },
          "type": {
            "type": "string",
            "description": "form_fields.type（input種別）"
          },
          "sort_order": {
            "type": "integer",
            "format": "int32",
            "description": "form_fields.sort_order"
          },
          "is_required": {
            "type": "boolean",
            "description": "form_fields.is_required（固定必須）"
          },
          "options_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "選択肢など（JSON）"
          },
          "visibility_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 visibility_rule(JSON)"
          },
          "required_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 required_rule(JSON)"
          },
          "step_transition_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 step_transition_rule(JSON)"
          },
          "is_readonly": {
            "type": [
              "boolean",
              "null"
            ],
            "description": "readonly（computed等で利用）"
          },
          "computed_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "計算フィールド規則（v1.x: built_in_functions）",
            "properties": {
              "engine": {
                "type": "string",
                "enum": [
                  "built_in_functions"
                ]
              },
              "fn": {
                "type": "string",
                "enum": [
                  "sum",
                  "multiply",
                  "tax",
                  "round",
                  "min",
                  "max",
                  "if"
                ]
              },
              "args": {
                "type": "array",
                "items": {
                  "oneOf": [
                    {
                      "type": "string",
                      "description": "ref:FIELD_KEY 形式の参照"
                    },
                    {
                      "type": "number"
                    },
                    {
                      "type": "boolean"
                    },
                    {
                      "type": "null"
                    }
                  ]
                }
              },
              "result_type": {
                "type": "string",
                "enum": [
                  "number",
                  "string"
                ]
              },
              "format": {
                "type": [
                  "string",
                  "null"
                ],
                "enum": [
                  "integer",
                  "decimal",
                  "currency",
                  null
                ]
              },
              "fallback": {
                "type": "object",
                "properties": {
                  "on_error": {
                    "type": "string",
                    "enum": [
                      "blank",
                      "zero"
                    ]
                  },
                  "store": {
                    "type": "string",
                    "enum": [
                      "store",
                      "do_not_store"
                    ]
                  }
                }
              }
            },
            "required": [
              "engine",
              "fn",
              "args"
            ]
          }
        },
        "required": [
          "id",
          "form_id",
          "field_key",
          "type",
          "sort_order",
          "is_required"
        ]
      },
      "ConditionState": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "enum": [
              "1"
            ]
          },
          "evaluated_at": {
            "type": "string",
            "format": "date-time"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean"
                },
                "required": {
                  "type": "boolean"
                },
                "store": {
                  "type": "string",
                  "enum": [
                    "store",
                    "do_not_store"
                  ]
                },
                "eval": {
                  "type": "string",
                  "enum": [
                    "ok",
                    "fallback",
                    "error"
                  ]
                },
                "reasons": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "kind": {
                        "type": "string",
                        "enum": [
                          "rule",
                          "type",
                          "missing_field",
                          "unknown_operator"
                        ]
                      },
                      "path": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  },
                  "description": "任意（デバッグ用途）"
                }
              },
              "required": [
                "visible",
                "required",
                "store",
                "eval"
              ]
            }
          },
          "step": {
            "type": [
              "object",
              "null"
            ],
            "description": "STEP遷移状態（STEPモードで利用）"
          }
        },
        "required": [
          "version",
          "evaluated_at",
          "fields"
        ],
        "description": "条件分岐評価結果（API→UI I/F）"
      },
      "Submission": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.form_id"
          },
          "status": {
            "type": "string",
            "description": "submissions.status",
            "enum": [
              "received",
              "confirmed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "form_id",
          "status",
          "created_at",
          "updated_at"
        ]
      },
      "SubmissionValue": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.id"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.submission_id"
          },
          "field_key": {
            "type": "string",
            "description": "submission_values.field_key"
          },
          "field_label_snapshot": {
            "type": [
              "string",
              "null"
            ],
            "description": "ラベルスナップショット"
          },
          "value_json": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              },
              {
                "type": "boolean"
              },
              {
                "type": "object"
              },
              {
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "回答 value（JSON）"
          },
          "label_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "label スナップショット（JSON）"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "field_key",
          "value_json",
          "created_at"
        ]
      },
      "Notification": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "channel": {
            "type": "string",
            "enum": [
              "mail",
              "slack"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "queued",
              "sent",
              "failed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "channel",
          "status",
          "created_at"
        ]
      },
      "SubmissionPdf": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "pdf_type": {
            "type": "string",
            "enum": [
              "submission",
              "ack"
            ]
          },
          "storage_path": {
            "type": "string",
            "description": "S3等の保存先パス"
          },
          "is_latest": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "pdf_type",
          "storage_path",
          "is_latest",
          "created_at"
        ]
      },
      "PaginatedForms": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Form"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "PaginatedResponses": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Submission"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "SortEnum": {
        "type": "string",
        "description": "一覧系 sort。既定=created_at_desc",
        "enum": [
          "created_at_desc",
          "created_at_asc"
        ]
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "401 Unauthorized",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "Forbidden": {
        "description": "403 Forbidden",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "ValidationError": {
        "description": "422 Validation Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      }
    }
  },
  "paths": {
    "/v1/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログイン",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "token方式の場合に返却（Sanctum SPAの場合null）"
                        },
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string"
                  },
                  "remember": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "email",
                  "password"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログアウト",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logged_out": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "logged_out"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "自分自身の情報",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/forms": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "forms": {
                          "$ref": "#/components/schemas/PaginatedForms"
                        }
                      },
                      "required": [
                        "forms"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "draft",
                "published",
                "closed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（部分一致）"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム作成",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "フォーム識別子",
                    "example": "CONTACT_2026"
                  },
                  "is_public": {
                    "type": "boolean",
                    "example": false
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    },
                    "description": "多言語（初期）"
                  }
                },
                "required": [
                  "code"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{id}": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        },
                        "translations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormTranslation"
                          }
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "published",
                      "closed"
                    ]
                  },
                  "is_public": {
                    "type": "boolean"
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム削除（論理）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "deleted": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "deleted"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{id}/fields": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "include_rules",
            "in": "query",
            "schema": {
              "type": "boolean",
              "description": "visibility/required rules を含める"
            },
            "required": false
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一括更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "fields": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormField"
                    }
                  }
                },
                "required": [
                  "fields"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/responses": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信一覧（Responses）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "responses": {
                          "$ref": "#/components/schemas/PaginatedResponses"
                        }
                      },
                      "required": [
                        "responses"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "form_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "received",
                "confirmed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（メール/氏名など：A-02検索マトリクスに委譲）"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信詳細",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "response": {
                          "$ref": "#/components/schemas/Submission"
                        },
                        "values": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionValue"
                          }
                        },
                        "notifications": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Notification"
                          }
                        },
                        "pdfs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionPdf"
                          }
                        }
                      },
                      "required": [
                        "response",
                        "values"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{form_key}/submit": {
      "post": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "公開 submit",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "submission_id": {
                          "type": "integer",
                          "format": "int64"
                        },
                        "ack_url": {
                          "type": "string",
                          "description": "ACK URL（UI遷移用）"
                        },
                        "condition_state": {
                          "$ref": "#/components/schemas/ConditionState"
                        }
                      },
                      "required": [
                        "submission_id",
                        "ack_url"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "answers": {
                    "type": "object",
                    "additionalProperties": {
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "number"
                        },
                        {
                          "type": "boolean"
                        },
                        {
                          "type": "object"
                        },
                        {
                          "type": "array"
                        },
                        {
                          "type": "null"
                        }
                      ]
                    }
                  },
                  "locale": {
                    "type": "string",
                    "enum": [
                      "ja",
                      "en"
                    ]
                  },
                  "mode": {
                    "type": "string",
                    "description": "both/value/label (CSV等の表現に委譲)",
                    "enum": [
                      "both",
                      "value",
                      "label"
                    ]
                  }
                },
                "required": [
                  "answers"
                ],
                "description": "（追補）computed フィールドの値を answers に含めても無視され、API側で再計算して確定します。"
              }
            }
          }
        }
      }
    },
    "/v1/forms/{form_key}/ack": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "ACK 表示",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "ack": {
                          "type": "object",
                          "description": "ACK 表示データ（テンプレ/変数はA-04に委譲）"
                        },
                        "pdf_url": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "PDFダウンロードURL（許可される場合）"
                        }
                      },
                      "required": [
                        "ack"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "name": "token",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "confirm_url token"
            },
            "required": false
          },
          {
            "name": "submission_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}/pdf": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "PDF 取得（管理側）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/pdf": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "pdf_type",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "submission",
                "ack"
              ]
            },
            "required": false
          }
        ]
      }
    },
    "/v1/dashboard/summary": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード集計",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "summary": {
                          "type": "object",
                          "properties": {
                            "forms_count": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_today": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_total": {
                              "type": "integer",
                              "format": "int32"
                            }
                          },
                          "required": [
                            "forms_count",
                            "responses_today",
                            "responses_total"
                          ]
                        }
                      },
                      "required": [
                        "summary"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/dashboard/errors": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード（エラー/失敗一覧）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "errors": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "kind": {
                                    "type": "string",
                                    "enum": [
                                      "mail_failed",
                                      "slack_failed",
                                      "pdf_failed",
                                      "eval_error",
                                      "other"
                                    ]
                                  },
                                  "message": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "kind",
                                  "message",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "errors"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/admin-users": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/User"
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "users"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "suspended"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（email/name）"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ作成（招待）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "SYSTEM_ADMIN",
                        "FORM_ADMIN",
                        "LOG_ADMIN"
                      ]
                    }
                  }
                },
                "required": [
                  "name",
                  "email",
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/{id}": {
      "put": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "suspended"
                    ]
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "SYSTEM_ADMIN",
                        "FORM_ADMIN",
                        "LOG_ADMIN"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/invites/resend": {
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "招待再送",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "sent": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "sent"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": {
                    "type": "integer",
                    "format": "int64"
                  }
                },
                "required": [
                  "user_id"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-audit-logs": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "監査ログ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logs": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "actor_user_id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "action": {
                                    "type": "string"
                                  },
                                  "target_type": {
                                    "type": "string"
                                  },
                                  "target_id": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "actor_user_id",
                                  "action",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "logs"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "action",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/roles/permissions": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "roles": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "role": {
                                "type": "string"
                              },
                              "permissions": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            },
                            "required": [
                              "role",
                              "permissions"
                            ]
                          }
                        }
                      },
                      "required": [
                        "roles"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "updated"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "role": {
                          "type": "string"
                        },
                        "permissions": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      },
                      "required": [
                        "role",
                        "permissions"
                      ]
                    }
                  }
                },
                "required": [
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/settings": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "settings": {
                    "type": "object"
                  }
                },
                "required": [
                  "settings"
                ]
              }
            }
          }
        }
      }
    },
    "": {
      "v1": {
        "forms": {
          "post": {
            "requestBody": {
              "content": {
                "application/json": {
                  "schema": {
                    "properties": {
                      "theme_id": {
                        "type": [
                          "string",
                          "null"
                        ]
                      },
                      "theme_tokens": {
                        "type": [
                          "object",
                          "null"
                        ],
                        "additionalProperties": {
                          "oneOf": [
                            {
                              "type": "string"
                            },
                            {
                              "type": "number"
                            },
                            {
                              "type": "boolean"
                            },
                            {
                              "type": "null"
                            }
                          ]
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "{id}": {
            "put": {
              "requestBody": {
                "content": {
                  "application/json": {
                    "schema": {
                      "properties": {
                        "theme_id": {
                          "type": [
                            "string",
                            "null"
                          ]
                        },
                        "theme_tokens": {
                          "type": [
                            "object",
                            "null"
                          ],
                          "additionalProperties": {
                            "oneOf": [
                              {
                                "type": "string"
                              },
                              {
                                "type": "number"
                              },
                              {
                                "type": "boolean"
                              },
                              {
                                "type": "null"
                              }
                            ]
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

## API-0017 reforma-api-spec-v1.1.0-openapi-full+supplements.yaml

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-openapi-full+supplements.yaml.yaml`

openapi: 3.0.3
info:
  title: 'ReForma API v1.1 OpenAPI（追補反映: theme/computed）'
  version: 1.1-openapi-draft-full+supplements
  description: API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI
    を“実装可能な粒度”まで増補した草案。
servers:
- url: /
tags:
- name: Auth
- name: Forms
- name: Responses
- name: ACK/PDF
- name: Dashboard
- name: System Admin
- name: SUP (root-only)
components:
  securitySchemes:
    sanctum:
      type: apiKey
      in: cookie
      name: XSRF-TOKEN
      description: Sanctum SPA session（例）。実装により Bearer 併用可
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Token
  schemas:
    EnvelopeSuccess:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        message:
          type:
          - string
          - 'null'
        errors:
          type:
          - object
          - 'null'
      required:
      - success
      - data
      - message
      - errors
    EnvelopeError:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: 'null'
        message:
          type:
          - string
          - 'null'
        errors:
          type: object
          properties:
            code:
              type: string
              description: エラーコード
            fields:
              type: object
              additionalProperties:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列
            rule:
              type:
              - object
              - 'null'
            step:
              type:
              - object
              - 'null'
          required:
          - code
          description: errors 本体（用途に応じて fields/rule/step を利用）
      required:
      - success
      - data
      - message
      - errors
    ErrorObject:
      type: object
      properties:
        code:
          type: string
          description: エラーコード
        fields:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
            description: エラーメッセージ配列
        rule:
          type:
          - object
          - 'null'
        step:
          type:
          - object
          - 'null'
      required:
      - code
      description: errors 本体（用途に応じて fields/rule/step を利用）
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: users.id
        name:
          type: string
          description: 表示名
        email:
          type: string
          description: メールアドレス
          format: email
        status:
          type: string
          description: active / suspended
          enum:
          - active
          - suspended
        roles:
          type: array
          items:
            type: string
            enum:
            - SYSTEM_ADMIN
            - FORM_ADMIN
            - LOG_ADMIN
          description: 付与ロール
      required:
      - id
      - name
      - email
      - status
      - roles
    Form:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: forms.id
        code:
          type: string
          description: forms.code（フォーム識別子）
        status:
          type: string
          description: forms.status
          enum:
          - draft
          - published
          - closed
        is_public:
          type: boolean
          description: forms.is_public
        created_by:
          type: integer
          format: int64
          description: forms.created_by
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        theme_id:
          type:
          - string
          - 'null'
          description: フォームテーマID（公開フォーム専用）
        theme_tokens:
          type:
          - object
          - 'null'
          description: テーマトークン（CSS変数）
          additionalProperties:
            oneOf:
            - type: string
            - type: number
            - type: boolean
            - type: 'null'
        theme_scope:
          type:
          - string
          - 'null'
          description: (契約) テーマ適用スコープ。公開フォームは form_container_only（管理画面テーマと分離）
          enum:
          - form_container_only
          - null
      required:
      - id
      - code
      - status
      - is_public
      - created_by
      - created_at
      - updated_at
    FormTranslation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        form_id:
          type: integer
          format: int64
        locale:
          type: string
          enum:
          - ja
          - en
        title:
          type: string
          description: フォーム名
        description:
          type: string
          description: 説明
          example: ''
      required:
      - id
      - form_id
      - locale
      - title
    FormField:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: form_fields.id
        form_id:
          type: integer
          format: int64
          description: form_fields.form_id
        field_key:
          type: string
          description: form_fields.field_key
        type:
          type: string
          description: form_fields.type（input種別）
        sort_order:
          type: integer
          format: int32
          description: form_fields.sort_order
        is_required:
          type: boolean
          description: form_fields.is_required（固定必須）
        options_json:
          type:
          - object
          - 'null'
          description: 選択肢など（JSON）
        visibility_rule:
          type:
          - object
          - 'null'
          description: A-06 visibility_rule(JSON)
        required_rule:
          type:
          - object
          - 'null'
          description: A-06 required_rule(JSON)
        step_transition_rule:
          type:
          - object
          - 'null'
          description: A-06 step_transition_rule(JSON)
        is_readonly:
          type:
          - boolean
          - 'null'
          description: readonly（computed等で利用）
        computed_rule:
          type:
          - object
          - 'null'
          description: '計算フィールド規則（v1.x: built_in_functions）'
          properties:
            engine:
              type: string
              enum:
              - built_in_functions
            fn:
              type: string
              enum:
              - sum
              - multiply
              - tax
              - round
              - min
              - max
              - if
            args:
              type: array
              items:
                oneOf:
                - type: string
                  description: ref:FIELD_KEY 形式の参照
                - type: number
                - type: boolean
                - type: 'null'
            result_type:
              type: string
              enum:
              - number
              - string
            format:
              type:
              - string
              - 'null'
              enum:
              - integer
              - decimal
              - currency
              - null
            fallback:
              type: object
              properties:
                on_error:
                  type: string
                  enum:
                  - blank
                  - zero
                store:
                  type: string
                  enum:
                  - store
                  - do_not_store
          required:
          - engine
          - fn
          - args
      required:
      - id
      - form_id
      - field_key
      - type
      - sort_order
      - is_required
    ConditionState:
      type: object
      properties:
        version:
          type: string
          enum:
          - '1'
        evaluated_at:
          type: string
          format: date-time
        fields:
          type: object
          additionalProperties:
            type: object
            properties:
              visible:
                type: boolean
              required:
                type: boolean
              store:
                type: string
                enum:
                - store
                - do_not_store
              eval:
                type: string
                enum:
                - ok
                - fallback
                - error
              reasons:
                type: array
                items:
                  type: object
                  properties:
                    kind:
                      type: string
                      enum:
                      - rule
                      - type
                      - missing_field
                      - unknown_operator
                    path:
                      type: string
                    message:
                      type: string
                description: 任意（デバッグ用途）
            required:
            - visible
            - required
            - store
            - eval
        step:
          type:
          - object
          - 'null'
          description: STEP遷移状態（STEPモードで利用）
      required:
      - version
      - evaluated_at
      - fields
      description: 条件分岐評価結果（API→UI I/F）
    Submission:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submissions.id
        form_id:
          type: integer
          format: int64
          description: submissions.form_id
        status:
          type: string
          description: submissions.status
          enum:
          - received
          - confirmed
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - form_id
      - status
      - created_at
      - updated_at
    SubmissionValue:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submission_values.id
        submission_id:
          type: integer
          format: int64
          description: submission_values.submission_id
        field_key:
          type: string
          description: submission_values.field_key
        field_label_snapshot:
          type:
          - string
          - 'null'
          description: ラベルスナップショット
        value_json:
          oneOf:
          - type: string
          - type: number
          - type: boolean
          - type: object
          - type: array
          - type: 'null'
          description: 回答 value（JSON）
        label_json:
          type:
          - object
          - 'null'
          description: label スナップショット（JSON）
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - field_key
      - value_json
      - created_at
    Notification:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        channel:
          type: string
          enum:
          - mail
          - slack
        status:
          type: string
          enum:
          - queued
          - sent
          - failed
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - channel
      - status
      - created_at
    SubmissionPdf:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        pdf_type:
          type: string
          enum:
          - submission
          - ack
        storage_path:
          type: string
          description: S3等の保存先パス
        is_latest:
          type: boolean
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - pdf_type
      - storage_path
      - is_latest
      - created_at
    PaginatedForms:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Form'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum:
          - created_at_desc
          - created_at_asc
      required:
      - items
      - total
      - page
      - per_page
      - sort
    PaginatedResponses:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Submission'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum:
          - created_at_desc
          - created_at_asc
      required:
      - items
      - total
      - page
      - per_page
      - sort
    SortEnum:
      type: string
      description: 一覧系 sort。既定=created_at_desc
      enum:
      - created_at_desc
      - created_at_asc
  responses:
    Unauthorized:
      description: 401 Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    Forbidden:
      description: 403 Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    ValidationError:
      description: 422 Validation Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
paths:
  /v1/auth/login:
    post:
      tags:
      - Auth
      summary: ログイン
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type:
                        - string
                        - 'null'
                        description: token方式の場合に返却（Sanctum SPAの場合null）
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                remember:
                  type: boolean
              required:
              - email
              - password
  /v1/auth/logout:
    post:
      tags:
      - Auth
      summary: ログアウト
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logged_out:
                        type: boolean
                    required:
                    - logged_out
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/auth/me:
    get:
      tags:
      - Auth
      summary: 自分自身の情報
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/forms:
    get:
      tags:
      - Forms
      summary: フォーム一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      forms:
                        $ref: '#/components/schemas/PaginatedForms'
                    required:
                    - forms
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - draft
          - published
          - closed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（部分一致）
        required: false
    post:
      tags:
      - Forms
      summary: フォーム作成
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: フォーム識別子
                  example: CONTACT_2026
                is_public:
                  type: boolean
                  example: false
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
                  description: 多言語（初期）
              required:
              - code
  /v1/forms/{id}:
    get:
      tags:
      - Forms
      summary: フォーム取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                      translations:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormTranslation'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
    put:
      tags:
      - Forms
      summary: フォーム更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                  - draft
                  - published
                  - closed
                is_public:
                  type: boolean
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
    delete:
      tags:
      - Forms
      summary: フォーム削除（論理）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      deleted:
                        type: boolean
                    required:
                    - deleted
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
  /v1/forms/{id}/fields:
    get:
      tags:
      - Forms
      summary: フォーム項目一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      - name: include_rules
        in: query
        schema:
          type: boolean
          description: visibility/required rules を含める
        required: false
    put:
      tags:
      - Forms
      summary: フォーム項目一括更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fields:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormField'
              required:
              - fields
  /v1/responses:
    get:
      tags:
      - Responses
      summary: 送信一覧（Responses）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      responses:
                        $ref: '#/components/schemas/PaginatedResponses'
                    required:
                    - responses
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: form_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - received
          - confirmed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（メール/氏名など：A-02検索マトリクスに委譲）
        required: false
  /v1/responses/{id}:
    get:
      tags:
      - Responses
      summary: 送信詳細
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      response:
                        $ref: '#/components/schemas/Submission'
                      values:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionValue'
                      notifications:
                        type: array
                        items:
                          $ref: '#/components/schemas/Notification'
                      pdfs:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionPdf'
                    required:
                    - response
                    - values
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
  /v1/forms/{form_key}/submit:
    post:
      tags:
      - ACK/PDF
      summary: 公開 submit
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      submission_id:
                        type: integer
                        format: int64
                      ack_url:
                        type: string
                        description: ACK URL（UI遷移用）
                      condition_state:
                        $ref: '#/components/schemas/ConditionState'
                    required:
                    - submission_id
                    - ack_url
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      parameters:
      - name: form_key
        in: path
        schema:
          type: string
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                answers:
                  type: object
                  additionalProperties:
                    oneOf:
                    - type: string
                    - type: number
                    - type: boolean
                    - type: object
                    - type: array
                    - type: 'null'
                locale:
                  type: string
                  enum:
                  - ja
                  - en
                mode:
                  type: string
                  description: both/value/label (CSV等の表現に委譲)
                  enum:
                  - both
                  - value
                  - label
              required:
              - answers
              description: （追補）computed フィールドの値を answers に含めても無視され、API側で再計算して確定します。
  /v1/forms/{form_key}/ack:
    get:
      tags:
      - ACK/PDF
      summary: ACK 表示
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      ack:
                        type: object
                        description: ACK 表示データ（テンプレ/変数はA-04に委譲）
                      pdf_url:
                        type:
                        - string
                        - 'null'
                        description: PDFダウンロードURL（許可される場合）
                    required:
                    - ack
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
      parameters:
      - name: form_key
        in: path
        schema:
          type: string
        required: true
      - name: token
        in: query
        schema:
          type: string
          description: confirm_url token
        required: false
      - name: submission_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
  /v1/responses/{id}/pdf:
    get:
      tags:
      - ACK/PDF
      summary: PDF 取得（管理側）
      responses:
        '200':
          description: OK
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      - name: pdf_type
        in: query
        schema:
          type: string
          enum:
          - submission
          - ack
        required: false
  /v1/dashboard/summary:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード集計
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      summary:
                        type: object
                        properties:
                          forms_count:
                            type: integer
                            format: int32
                          responses_today:
                            type: integer
                            format: int32
                          responses_total:
                            type: integer
                            format: int32
                        required:
                        - forms_count
                        - responses_today
                        - responses_total
                    required:
                    - summary
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/dashboard/errors:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード（エラー/失敗一覧）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      errors:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                kind:
                                  type: string
                                  enum:
                                  - mail_failed
                                  - slack_failed
                                  - pdf_failed
                                  - eval_error
                                  - other
                                message:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - kind
                              - message
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - errors
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
  /v1/system/admin-users:
    get:
      tags:
      - System Admin
      summary: 管理者ユーザ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      users:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/User'
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - users
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: role
        in: query
        schema:
          type: string
          enum:
          - SYSTEM_ADMIN
          - FORM_ADMIN
          - LOG_ADMIN
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - active
          - suspended
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（email/name）
        required: false
    post:
      tags:
      - System Admin
      summary: 管理者ユーザ作成（招待）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                roles:
                  type: array
                  items:
                    type: string
                    enum:
                    - SYSTEM_ADMIN
                    - FORM_ADMIN
                    - LOG_ADMIN
              required:
              - name
              - email
              - roles
  /v1/system/admin-users/{id}:
    put:
      tags:
      - System Admin
      summary: 管理者ユーザ更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                status:
                  type: string
                  enum:
                  - active
                  - suspended
                roles:
                  type: array
                  items:
                    type: string
                    enum:
                    - SYSTEM_ADMIN
                    - FORM_ADMIN
                    - LOG_ADMIN
  /v1/system/admin-users/invites/resend:
    post:
      tags:
      - System Admin
      summary: 招待再送
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sent:
                        type: boolean
                    required:
                    - sent
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  format: int64
              required:
              - user_id
  /v1/system/admin-audit-logs:
    get:
      tags:
      - System Admin
      summary: 監査ログ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logs:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                actor_user_id:
                                  type: integer
                                  format: int64
                                action:
                                  type: string
                                target_type:
                                  type: string
                                target_id:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - actor_user_id
                              - action
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - logs
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: user_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: action
        in: query
        schema:
          type: string
        required: false
  /v1/system/roles/permissions:
    get:
      tags:
      - SUP (root-only)
      summary: ロール権限定義取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      roles:
                        type: array
                        items:
                          type: object
                          properties:
                            role:
                              type: string
                            permissions:
                              type: array
                              items:
                                type: string
                          required:
                          - role
                          - permissions
                    required:
                    - roles
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: ロール権限定義更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      updated:
                        type: boolean
                    required:
                    - updated
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string
                    required:
                    - role
                    - permissions
              required:
              - roles
  /v1/system/settings:
    get:
      tags:
      - SUP (root-only)
      summary: システム設定取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: システム設定更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                settings:
                  type: object
              required:
              - settings
  ? ''
  : v1:
      forms:
        post:
          requestBody:
            content:
              application/json:
                schema:
                  properties:
                    theme_id:
                      type:
                      - string
                      - 'null'
                    theme_tokens:
                      type:
                      - object
                      - 'null'
                      additionalProperties:
                        oneOf:
                        - type: string
                        - type: number
                        - type: boolean
                        - type: 'null'
        '{id}':
          put:
            requestBody:
              content:
                application/json:
                  schema:
                    properties:
                      theme_id:
                        type:
                        - string
                        - 'null'
                      theme_tokens:
                        type:
                        - object
                        - 'null'
                        additionalProperties:
                          oneOf:
                          - type: string
                          - type: number
                          - type: boolean
                          - type: 'null'


## API-0018 reforma-api-spec-v1.1.0-openapi-full.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-openapi-full.json.json`

```json
{
  "openapi": "3.0.3",
  "info": {
    "title": "ReForma API v1.1 OpenAPI（起草：7.1/7.2/7.3/7.4/7.7/7.8）",
    "version": "1.1-openapi-draft-full",
    "description": "API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI を“実装可能な粒度”まで増補した草案。"
  },
  "servers": [
    {
      "url": "/"
    }
  ],
  "tags": [
    {
      "name": "Auth"
    },
    {
      "name": "Forms"
    },
    {
      "name": "Responses"
    },
    {
      "name": "ACK/PDF"
    },
    {
      "name": "Dashboard"
    },
    {
      "name": "System Admin"
    },
    {
      "name": "SUP (root-only)"
    }
  ],
  "components": {
    "securitySchemes": {
      "sanctum": {
        "type": "apiKey",
        "in": "cookie",
        "name": "XSRF-TOKEN",
        "description": "Sanctum SPA session（例）。実装により Bearer 併用可"
      },
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "Token"
      }
    },
    "schemas": {
      "EnvelopeSuccess": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": [
              "object",
              "null"
            ]
          }
        },
        "required": [
          "success",
          "data",
          "message",
          "errors"
        ]
      },
      "EnvelopeError": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "null"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "description": "エラーコード"
              },
              "fields": {
                "type": "object",
                "additionalProperties": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "エラーメッセージ配列"
                }
              },
              "rule": {
                "type": [
                  "object",
                  "null"
                ]
              },
              "step": {
                "type": [
                  "object",
                  "null"
                ]
              }
            },
            "required": [
              "code"
            ],
            "description": "errors 本体（用途に応じて fields/rule/step を利用）"
          }
        },
        "required": [
          "success",
          "data",
          "message",
          "errors"
        ]
      },
      "ErrorObject": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "エラーコード"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "エラーメッセージ配列"
            }
          },
          "rule": {
            "type": [
              "object",
              "null"
            ]
          },
          "step": {
            "type": [
              "object",
              "null"
            ]
          }
        },
        "required": [
          "code"
        ],
        "description": "errors 本体（用途に応じて fields/rule/step を利用）"
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "users.id"
          },
          "name": {
            "type": "string",
            "description": "表示名"
          },
          "email": {
            "type": "string",
            "description": "メールアドレス",
            "format": "email"
          },
          "status": {
            "type": "string",
            "description": "active / suspended",
            "enum": [
              "active",
              "suspended"
            ]
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "description": "付与ロール"
          }
        },
        "required": [
          "id",
          "name",
          "email",
          "status",
          "roles"
        ]
      },
      "Form": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "forms.id"
          },
          "code": {
            "type": "string",
            "description": "forms.code（フォーム識別子）"
          },
          "status": {
            "type": "string",
            "description": "forms.status",
            "enum": [
              "draft",
              "published",
              "closed"
            ]
          },
          "is_public": {
            "type": "boolean",
            "description": "forms.is_public"
          },
          "created_by": {
            "type": "integer",
            "format": "int64",
            "description": "forms.created_by"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "code",
          "status",
          "is_public",
          "created_by",
          "created_at",
          "updated_at"
        ]
      },
      "FormTranslation": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "form_id": {
            "type": "integer",
            "format": "int64"
          },
          "locale": {
            "type": "string",
            "enum": [
              "ja",
              "en"
            ]
          },
          "title": {
            "type": "string",
            "description": "フォーム名"
          },
          "description": {
            "type": "string",
            "description": "説明",
            "example": ""
          }
        },
        "required": [
          "id",
          "form_id",
          "locale",
          "title"
        ]
      },
      "FormField": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.form_id"
          },
          "field_key": {
            "type": "string",
            "description": "form_fields.field_key"
          },
          "type": {
            "type": "string",
            "description": "form_fields.type（input種別）"
          },
          "sort_order": {
            "type": "integer",
            "format": "int32",
            "description": "form_fields.sort_order"
          },
          "is_required": {
            "type": "boolean",
            "description": "form_fields.is_required（固定必須）"
          },
          "options_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "選択肢など（JSON）"
          },
          "visibility_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 visibility_rule(JSON)"
          },
          "required_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 required_rule(JSON)"
          },
          "step_transition_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 step_transition_rule(JSON)"
          }
        },
        "required": [
          "id",
          "form_id",
          "field_key",
          "type",
          "sort_order",
          "is_required"
        ]
      },
      "ConditionState": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "enum": [
              "1"
            ]
          },
          "evaluated_at": {
            "type": "string",
            "format": "date-time"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean"
                },
                "required": {
                  "type": "boolean"
                },
                "store": {
                  "type": "string",
                  "enum": [
                    "store",
                    "do_not_store"
                  ]
                },
                "eval": {
                  "type": "string",
                  "enum": [
                    "ok",
                    "fallback",
                    "error"
                  ]
                },
                "reasons": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "kind": {
                        "type": "string",
                        "enum": [
                          "rule",
                          "type",
                          "missing_field",
                          "unknown_operator"
                        ]
                      },
                      "path": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  },
                  "description": "任意（デバッグ用途）"
                }
              },
              "required": [
                "visible",
                "required",
                "store",
                "eval"
              ]
            }
          },
          "step": {
            "type": [
              "object",
              "null"
            ],
            "description": "STEP遷移状態（STEPモードで利用）"
          }
        },
        "required": [
          "version",
          "evaluated_at",
          "fields"
        ],
        "description": "条件分岐評価結果（API→UI I/F）"
      },
      "Submission": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.form_id"
          },
          "status": {
            "type": "string",
            "description": "submissions.status",
            "enum": [
              "received",
              "confirmed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "form_id",
          "status",
          "created_at",
          "updated_at"
        ]
      },
      "SubmissionValue": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.id"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.submission_id"
          },
          "field_key": {
            "type": "string",
            "description": "submission_values.field_key"
          },
          "field_label_snapshot": {
            "type": [
              "string",
              "null"
            ],
            "description": "ラベルスナップショット"
          },
          "value_json": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              },
              {
                "type": "boolean"
              },
              {
                "type": "object"
              },
              {
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "回答 value（JSON）"
          },
          "label_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "label スナップショット（JSON）"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "field_key",
          "value_json",
          "created_at"
        ]
      },
      "Notification": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "channel": {
            "type": "string",
            "enum": [
              "mail",
              "slack"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "queued",
              "sent",
              "failed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "channel",
          "status",
          "created_at"
        ]
      },
      "SubmissionPdf": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "pdf_type": {
            "type": "string",
            "enum": [
              "submission",
              "ack"
            ]
          },
          "storage_path": {
            "type": "string",
            "description": "S3等の保存先パス"
          },
          "is_latest": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "pdf_type",
          "storage_path",
          "is_latest",
          "created_at"
        ]
      },
      "PaginatedForms": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Form"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "PaginatedResponses": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Submission"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "SortEnum": {
        "type": "string",
        "description": "一覧系 sort。既定=created_at_desc",
        "enum": [
          "created_at_desc",
          "created_at_asc"
        ]
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "401 Unauthorized",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "Forbidden": {
        "description": "403 Forbidden",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "ValidationError": {
        "description": "422 Validation Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      }
    }
  },
  "paths": {
    "/v1/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログイン",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "token方式の場合に返却（Sanctum SPAの場合null）"
                        },
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string"
                  },
                  "remember": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "email",
                  "password"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログアウト",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logged_out": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "logged_out"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "自分自身の情報",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/forms": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "forms": {
                          "$ref": "#/components/schemas/PaginatedForms"
                        }
                      },
                      "required": [
                        "forms"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "draft",
                "published",
                "closed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（部分一致）"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム作成",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "フォーム識別子",
                    "example": "CONTACT_2026"
                  },
                  "is_public": {
                    "type": "boolean",
                    "example": false
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    },
                    "description": "多言語（初期）"
                  }
                },
                "required": [
                  "code"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{id}": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        },
                        "translations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormTranslation"
                          }
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "published",
                      "closed"
                    ]
                  },
                  "is_public": {
                    "type": "boolean"
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム削除（論理）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "deleted": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "deleted"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{id}/fields": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "include_rules",
            "in": "query",
            "schema": {
              "type": "boolean",
              "description": "visibility/required rules を含める"
            },
            "required": false
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一括更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "fields": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormField"
                    }
                  }
                },
                "required": [
                  "fields"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/responses": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信一覧（Responses）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "responses": {
                          "$ref": "#/components/schemas/PaginatedResponses"
                        }
                      },
                      "required": [
                        "responses"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "form_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "received",
                "confirmed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（メール/氏名など：A-02検索マトリクスに委譲）"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信詳細",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "response": {
                          "$ref": "#/components/schemas/Submission"
                        },
                        "values": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionValue"
                          }
                        },
                        "notifications": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Notification"
                          }
                        },
                        "pdfs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionPdf"
                          }
                        }
                      },
                      "required": [
                        "response",
                        "values"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{form_key}/submit": {
      "post": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "公開 submit",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "submission_id": {
                          "type": "integer",
                          "format": "int64"
                        },
                        "ack_url": {
                          "type": "string",
                          "description": "ACK URL（UI遷移用）"
                        },
                        "condition_state": {
                          "$ref": "#/components/schemas/ConditionState"
                        }
                      },
                      "required": [
                        "submission_id",
                        "ack_url"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "answers": {
                    "type": "object",
                    "additionalProperties": {
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "number"
                        },
                        {
                          "type": "boolean"
                        },
                        {
                          "type": "object"
                        },
                        {
                          "type": "array"
                        },
                        {
                          "type": "null"
                        }
                      ]
                    }
                  },
                  "locale": {
                    "type": "string",
                    "enum": [
                      "ja",
                      "en"
                    ]
                  },
                  "mode": {
                    "type": "string",
                    "description": "both/value/label (CSV等の表現に委譲)",
                    "enum": [
                      "both",
                      "value",
                      "label"
                    ]
                  }
                },
                "required": [
                  "answers"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{form_key}/ack": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "ACK 表示",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "ack": {
                          "type": "object",
                          "description": "ACK 表示データ（テンプレ/変数はA-04に委譲）"
                        },
                        "pdf_url": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "PDFダウンロードURL（許可される場合）"
                        }
                      },
                      "required": [
                        "ack"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "name": "token",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "confirm_url token"
            },
            "required": false
          },
          {
            "name": "submission_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}/pdf": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "PDF 取得（管理側）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/pdf": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "pdf_type",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "submission",
                "ack"
              ]
            },
            "required": false
          }
        ]
      }
    },
    "/v1/dashboard/summary": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード集計",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "summary": {
                          "type": "object",
                          "properties": {
                            "forms_count": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_today": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_total": {
                              "type": "integer",
                              "format": "int32"
                            }
                          },
                          "required": [
                            "forms_count",
                            "responses_today",
                            "responses_total"
                          ]
                        }
                      },
                      "required": [
                        "summary"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/dashboard/errors": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード（エラー/失敗一覧）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "errors": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "kind": {
                                    "type": "string",
                                    "enum": [
                                      "mail_failed",
                                      "slack_failed",
                                      "pdf_failed",
                                      "eval_error",
                                      "other"
                                    ]
                                  },
                                  "message": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "kind",
                                  "message",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "errors"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/admin-users": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/User"
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "users"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "suspended"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（email/name）"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ作成（招待）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "SYSTEM_ADMIN",
                        "FORM_ADMIN",
                        "LOG_ADMIN"
                      ]
                    }
                  }
                },
                "required": [
                  "name",
                  "email",
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/{id}": {
      "put": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "suspended"
                    ]
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "SYSTEM_ADMIN",
                        "FORM_ADMIN",
                        "LOG_ADMIN"
                      ]
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/invites/resend": {
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "招待再送",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "sent": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "sent"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": {
                    "type": "integer",
                    "format": "int64"
                  }
                },
                "required": [
                  "user_id"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-audit-logs": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "監査ログ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logs": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "actor_user_id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "action": {
                                    "type": "string"
                                  },
                                  "target_type": {
                                    "type": "string"
                                  },
                                  "target_id": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "actor_user_id",
                                  "action",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "logs"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "action",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/roles/permissions": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "roles": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "role": {
                                "type": "string"
                              },
                              "permissions": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            },
                            "required": [
                              "role",
                              "permissions"
                            ]
                          }
                        }
                      },
                      "required": [
                        "roles"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "updated"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "role": {
                          "type": "string"
                        },
                        "permissions": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      },
                      "required": [
                        "role",
                        "permissions"
                      ]
                    }
                  }
                },
                "required": [
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/settings": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "settings": {
                    "type": "object"
                  }
                },
                "required": [
                  "settings"
                ]
              }
            }
          }
        }
      }
    }
  }
}
```

## API-0019 reforma-api-spec-v1.1.0-openapi-full.updated.json

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-openapi-full.updated.json.json`

```json
{
  "openapi": "3.0.3",
  "info": {
    "title": "ReForma API v1.1 OpenAPI（起草：7.1/7.2/7.3/7.4/7.7/7.8）",
    "version": "1.1-openapi-draft-full",
    "description": "API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI を“実装可能な粒度”まで増補した草案。"
  },
  "servers": [
    {
      "url": "/"
    }
  ],
  "tags": [
    {
      "name": "Auth"
    },
    {
      "name": "Forms"
    },
    {
      "name": "Responses"
    },
    {
      "name": "ACK/PDF"
    },
    {
      "name": "Dashboard"
    },
    {
      "name": "System Admin"
    },
    {
      "name": "SUP (root-only)"
    }
  ],
  "components": {
    "securitySchemes": {
      "sanctum": {
        "type": "apiKey",
        "in": "cookie",
        "name": "XSRF-TOKEN",
        "description": "Sanctum SPA session（例）。実装により Bearer 併用可"
      },
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "Token"
      }
    },
    "schemas": {
      "EnvelopeSuccess": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": [
              "object",
              "null"
            ]
          },
          "code": {
            "type": "string",
            "description": "API共通コード（成功時はOK等）",
            "example": "OK"
          },
          "request_id": {
            "type": "string",
            "description": "リクエストID（追跡用）",
            "example": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
          }
        },
        "required": [
          "success",
          "code",
          "request_id",
          "message",
          "data",
          "errors"
        ]
      },
      "EnvelopeError": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "null"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": "object",
            "properties": {
              "code": {
                "type": "string",
                "description": "エラーコード"
              },
              "fields": {
                "type": "object",
                "additionalProperties": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "エラーメッセージ配列"
                }
              },
              "rule": {
                "type": [
                  "object",
                  "null"
                ]
              },
              "step": {
                "type": [
                  "object",
                  "null"
                ]
              },
              "reason": {
                "type": "string",
                "description": "失敗理由（機械判定用）。例: ROOT_ONLY / SYSTEM_ADMIN_REQUIRED / TOKEN_EXPIRED など",
                "example": "ROOT_ONLY"
              }
            },
            "required": [
              "code"
            ],
            "description": "errors 本体（用途に応じて fields/rule/step を利用）"
          },
          "code": {
            "type": "string",
            "description": "API共通コード（例: FORBIDDEN / CONSTRAINT_VIOLATION / VALIDATION_ERROR 等）",
            "example": "FORBIDDEN"
          },
          "request_id": {
            "type": "string",
            "description": "リクエストID（追跡用）",
            "example": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
          }
        },
        "required": [
          "success",
          "code",
          "request_id",
          "message",
          "data",
          "errors"
        ]
      },
      "ErrorObject": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "エラーコード"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "エラーメッセージ配列"
            }
          },
          "rule": {
            "type": [
              "object",
              "null"
            ]
          },
          "step": {
            "type": [
              "object",
              "null"
            ]
          },
          "reason": {
            "type": "string",
            "description": "失敗理由（機械判定用）",
            "example": "ROOT_ONLY"
          }
        },
        "required": [
          "code"
        ],
        "description": "errors 本体（用途に応じて fields/rule/step を利用）"
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "users.id"
          },
          "name": {
            "type": "string",
            "description": "表示名"
          },
          "email": {
            "type": "string",
            "description": "メールアドレス",
            "format": "email"
          },
          "status": {
            "type": "string",
            "description": "active / suspended",
            "enum": [
              "active",
              "suspended"
            ]
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "description": "付与ロール"
          }
        },
        "required": [
          "id",
          "name",
          "email",
          "status",
          "roles"
        ]
      },
      "Form": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "forms.id"
          },
          "code": {
            "type": "string",
            "description": "forms.code（フォーム識別子）"
          },
          "status": {
            "type": "string",
            "description": "forms.status",
            "enum": [
              "draft",
              "published",
              "closed"
            ]
          },
          "is_public": {
            "type": "boolean",
            "description": "forms.is_public"
          },
          "created_by": {
            "type": "integer",
            "format": "int64",
            "description": "forms.created_by"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "code",
          "status",
          "is_public",
          "created_by",
          "created_at",
          "updated_at"
        ]
      },
      "FormTranslation": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "form_id": {
            "type": "integer",
            "format": "int64"
          },
          "locale": {
            "type": "string",
            "enum": [
              "ja",
              "en"
            ]
          },
          "title": {
            "type": "string",
            "description": "フォーム名"
          },
          "description": {
            "type": "string",
            "description": "説明",
            "example": ""
          }
        },
        "required": [
          "id",
          "form_id",
          "locale",
          "title"
        ]
      },
      "FormField": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.form_id"
          },
          "field_key": {
            "type": "string",
            "description": "form_fields.field_key"
          },
          "type": {
            "type": "string",
            "description": "form_fields.type（input種別）"
          },
          "sort_order": {
            "type": "integer",
            "format": "int32",
            "description": "form_fields.sort_order"
          },
          "is_required": {
            "type": "boolean",
            "description": "form_fields.is_required（固定必須）"
          },
          "options_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "選択肢など（JSON）"
          },
          "visibility_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 visibility_rule(JSON)"
          },
          "required_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 required_rule(JSON)"
          },
          "step_transition_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 step_transition_rule(JSON)"
          }
        },
        "required": [
          "id",
          "form_id",
          "field_key",
          "type",
          "sort_order",
          "is_required"
        ]
      },
      "ConditionState": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "enum": [
              "1"
            ]
          },
          "evaluated_at": {
            "type": "string",
            "format": "date-time"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean"
                },
                "required": {
                  "type": "boolean"
                },
                "store": {
                  "type": "string",
                  "enum": [
                    "store",
                    "do_not_store"
                  ]
                },
                "eval": {
                  "type": "string",
                  "enum": [
                    "ok",
                    "fallback",
                    "error"
                  ]
                },
                "reasons": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "kind": {
                        "type": "string",
                        "enum": [
                          "rule",
                          "type",
                          "missing_field",
                          "unknown_operator"
                        ]
                      },
                      "path": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  },
                  "description": "任意（デバッグ用途）"
                }
              },
              "required": [
                "visible",
                "required",
                "store",
                "eval"
              ]
            }
          },
          "step": {
            "type": [
              "object",
              "null"
            ],
            "description": "STEP遷移状態（STEPモードで利用）"
          }
        },
        "required": [
          "version",
          "evaluated_at",
          "fields"
        ],
        "description": "条件分岐評価結果（API→UI I/F）"
      },
      "Submission": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.form_id"
          },
          "status": {
            "type": "string",
            "description": "submissions.status",
            "enum": [
              "received",
              "confirmed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "form_id",
          "status",
          "created_at",
          "updated_at"
        ]
      },
      "SubmissionValue": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.id"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.submission_id"
          },
          "field_key": {
            "type": "string",
            "description": "submission_values.field_key"
          },
          "field_label_snapshot": {
            "type": [
              "string",
              "null"
            ],
            "description": "ラベルスナップショット"
          },
          "value_json": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              },
              {
                "type": "boolean"
              },
              {
                "type": "object"
              },
              {
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "回答 value（JSON）"
          },
          "label_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "label スナップショット（JSON）"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "field_key",
          "value_json",
          "created_at"
        ]
      },
      "Notification": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "channel": {
            "type": "string",
            "enum": [
              "mail",
              "slack"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "queued",
              "sent",
              "failed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "channel",
          "status",
          "created_at"
        ]
      },
      "SubmissionPdf": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "pdf_type": {
            "type": "string",
            "enum": [
              "submission",
              "ack"
            ]
          },
          "storage_path": {
            "type": "string",
            "description": "S3等の保存先パス"
          },
          "is_latest": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "pdf_type",
          "storage_path",
          "is_latest",
          "created_at"
        ]
      },
      "PaginatedForms": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Form"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "PaginatedResponses": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Submission"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "SortEnum": {
        "type": "string",
        "description": "一覧系 sort。既定=created_at_desc",
        "enum": [
          "created_at_desc",
          "created_at_asc"
        ]
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "401 Unauthorized",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "Forbidden": {
        "description": "403 Forbidden",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "ValidationError": {
        "description": "422 Validation Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      }
    },
    "examples": {
      "ForbiddenRootOnly": {
        "summary": "root-only により拒否",
        "value": {
          "success": false,
          "data": null,
          "message": "Forbidden.",
          "errors": {
            "reason": "ROOT_ONLY"
          },
          "code": "FORBIDDEN",
          "request_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        }
      },
      "ForbiddenSystemAdminRequired": {
        "summary": "system_admin 必須により拒否",
        "value": {
          "success": false,
          "data": null,
          "message": "Forbidden.",
          "errors": {
            "reason": "SYSTEM_ADMIN_REQUIRED"
          },
          "code": "FORBIDDEN",
          "request_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        }
      }
    }
  },
  "paths": {
    "/v1/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログイン",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "token方式の場合に返却（Sanctum SPAの場合null）"
                        },
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string"
                  },
                  "remember": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "email",
                  "password"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログアウト",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logged_out": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "logged_out"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "自分自身の情報",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/forms": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "forms": {
                          "$ref": "#/components/schemas/PaginatedForms"
                        }
                      },
                      "required": [
                        "forms"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "draft",
                "published",
                "closed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（部分一致）"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム作成",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "フォーム識別子",
                    "example": "CONTACT_2026"
                  },
                  "is_public": {
                    "type": "boolean",
                    "example": false
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    },
                    "description": "多言語（初期）"
                  }
                },
                "required": [
                  "code"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{id}": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        },
                        "translations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormTranslation"
                          }
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "published",
                      "closed"
                    ]
                  },
                  "is_public": {
                    "type": "boolean"
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム削除（論理）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "deleted": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "deleted"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{id}/fields": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "include_rules",
            "in": "query",
            "schema": {
              "type": "boolean",
              "description": "visibility/required rules を含める"
            },
            "required": false
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一括更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "fields": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormField"
                    }
                  }
                },
                "required": [
                  "fields"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/responses": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信一覧（Responses）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "responses": {
                          "$ref": "#/components/schemas/PaginatedResponses"
                        }
                      },
                      "required": [
                        "responses"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "form_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "received",
                "confirmed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（メール/氏名など：A-02検索マトリクスに委譲）"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信詳細",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "response": {
                          "$ref": "#/components/schemas/Submission"
                        },
                        "values": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionValue"
                          }
                        },
                        "notifications": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Notification"
                          }
                        },
                        "pdfs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionPdf"
                          }
                        }
                      },
                      "required": [
                        "response",
                        "values"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{form_key}/submit": {
      "post": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "公開 submit",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "submission_id": {
                          "type": "integer",
                          "format": "int64"
                        },
                        "ack_url": {
                          "type": "string",
                          "description": "ACK URL（UI遷移用）"
                        },
                        "condition_state": {
                          "$ref": "#/components/schemas/ConditionState"
                        }
                      },
                      "required": [
                        "submission_id",
                        "ack_url"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "answers": {
                    "type": "object",
                    "additionalProperties": {
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "number"
                        },
                        {
                          "type": "boolean"
                        },
                        {
                          "type": "object"
                        },
                        {
                          "type": "array"
                        },
                        {
                          "type": "null"
                        }
                      ]
                    }
                  },
                  "locale": {
                    "type": "string",
                    "enum": [
                      "ja",
                      "en"
                    ]
                  },
                  "mode": {
                    "type": "string",
                    "description": "both/value/label (CSV等の表現に委譲)",
                    "enum": [
                      "both",
                      "value",
                      "label"
                    ]
                  }
                },
                "required": [
                  "answers"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{form_key}/ack": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "ACK 表示",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "ack": {
                          "type": "object",
                          "description": "ACK 表示データ（テンプレ/変数はA-04に委譲）"
                        },
                        "pdf_url": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "PDFダウンロードURL（許可される場合）"
                        }
                      },
                      "required": [
                        "ack"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "name": "token",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "confirm_url token"
            },
            "required": false
          },
          {
            "name": "submission_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}/pdf": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "PDF 取得（管理側）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/pdf": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "pdf_type",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "submission",
                "ack"
              ]
            },
            "required": false
          }
        ]
      }
    },
    "/v1/dashboard/summary": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード集計",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "summary": {
                          "type": "object",
                          "properties": {
                            "forms_count": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_today": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_total": {
                              "type": "integer",
                              "format": "int32"
                            }
                          },
                          "required": [
                            "forms_count",
                            "responses_today",
                            "responses_total"
                          ]
                        }
                      },
                      "required": [
                        "summary"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/dashboard/errors": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード（エラー/失敗一覧）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "errors": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "kind": {
                                    "type": "string",
                                    "enum": [
                                      "mail_failed",
                                      "slack_failed",
                                      "pdf_failed",
                                      "eval_error",
                                      "other"
                                    ]
                                  },
                                  "message": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "kind",
                                  "message",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "errors"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/admin-users": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/User"
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "users"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "suspended"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（email/name）"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ作成（招待）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "SYSTEM_ADMIN",
                        "FORM_ADMIN",
                        "LOG_ADMIN"
                      ]
                    }
                  }
                },
                "required": [
                  "name",
                  "email",
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/{id}": {
      "put": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                },
                "examples": {
                  "ROOT_ONLY": {
                    "$ref": "#/components/examples/ForbiddenRootOnly"
                  },
                  "SYSTEM_ADMIN_REQUIRED": {
                    "$ref": "#/components/examples/ForbiddenSystemAdminRequired"
                  }
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "active",
                      "suspended"
                    ]
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "SYSTEM_ADMIN",
                        "FORM_ADMIN",
                        "LOG_ADMIN"
                      ]
                    }
                  }
                }
              }
            }
          }
        },
        "description": "### RBAC\n- 必須: system_admin\n- **system_admin 付与（昇格）**は root-only（is_root=true 必須）\n- system_admin 剥奪（降格）は system_admin で可（ただし自己降格禁止・最後の system_admin 禁止）"
      }
    },
    "/v1/system/admin-users/invites/resend": {
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "招待再送",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "sent": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "sent"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": {
                    "type": "integer",
                    "format": "int64"
                  }
                },
                "required": [
                  "user_id"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-audit-logs": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "監査ログ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logs": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "actor_user_id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "action": {
                                    "type": "string"
                                  },
                                  "target_type": {
                                    "type": "string"
                                  },
                                  "target_id": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "actor_user_id",
                                  "action",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "logs"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "action",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/roles/permissions": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "roles": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "role": {
                                "type": "string"
                              },
                              "permissions": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            },
                            "required": [
                              "role",
                              "permissions"
                            ]
                          }
                        }
                      },
                      "required": [
                        "roles"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "updated"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "role": {
                          "type": "string"
                        },
                        "permissions": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      },
                      "required": [
                        "role",
                        "permissions"
                      ]
                    }
                  }
                },
                "required": [
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/settings": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "settings": {
                    "type": "object"
                  }
                },
                "required": [
                  "settings"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/root-only/ping": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "root-only 動作確認（ping）",
        "description": "root-only ミドルウェア動作確認用。system_admin を満たした上で is_root=true の場合のみ成功。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "pong": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "pong"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    },
                    "code": {
                      "type": "string",
                      "example": "OK"
                    },
                    "request_id": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "code",
                    "request_id"
                  ]
                },
                "examples": {
                  "OK": {
                    "summary": "成功",
                    "value": {
                      "success": true,
                      "data": {
                        "pong": true
                      },
                      "message": null,
                      "errors": null,
                      "code": "OK",
                      "request_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                },
                "examples": {
                  "ROOT_ONLY": {
                    "$ref": "#/components/examples/ForbiddenRootOnly"
                  },
                  "SYSTEM_ADMIN_REQUIRED": {
                    "$ref": "#/components/examples/ForbiddenSystemAdminRequired"
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
```

## API-0020 reforma-api-spec-v1.1.0-openapi-full.yaml

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0-openapi-full.yaml.yaml`

openapi: 3.0.3
info:
  title: ReForma API v1.1 OpenAPI（起草：7.1/7.2/7.3/7.4/7.7/7.8）
  version: 1.1-openapi-draft-full
  description: API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI
    を“実装可能な粒度”まで増補した草案。
servers:
- url: /
tags:
- name: Auth
- name: Forms
- name: Responses
- name: ACK/PDF
- name: Dashboard
- name: System Admin
- name: SUP (root-only)
components:
  securitySchemes:
    sanctum:
      type: apiKey
      in: cookie
      name: XSRF-TOKEN
      description: Sanctum SPA session（例）。実装により Bearer 併用可
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Token
  schemas:
    EnvelopeSuccess:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        message:
          type:
          - string
          - 'null'
        errors:
          type:
          - object
          - 'null'
      required:
      - success
      - data
      - message
      - errors
    EnvelopeError:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: 'null'
        message:
          type:
          - string
          - 'null'
        errors: &id001
          type: object
          properties:
            code:
              type: string
              description: エラーコード
            fields:
              type: object
              additionalProperties:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列
            rule:
              type:
              - object
              - 'null'
            step:
              type:
              - object
              - 'null'
          required:
          - code
          description: errors 本体（用途に応じて fields/rule/step を利用）
      required:
      - success
      - data
      - message
      - errors
    ErrorObject: *id001
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: users.id
        name:
          type: string
          description: 表示名
        email:
          type: string
          description: メールアドレス
          format: email
        status:
          type: string
          description: active / suspended
          enum:
          - active
          - suspended
        roles:
          type: array
          items:
            type: string
            enum:
            - SYSTEM_ADMIN
            - FORM_ADMIN
            - LOG_ADMIN
          description: 付与ロール
      required:
      - id
      - name
      - email
      - status
      - roles
    Form:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: forms.id
        code:
          type: string
          description: forms.code（フォーム識別子）
        status:
          type: string
          description: forms.status
          enum:
          - draft
          - published
          - closed
        is_public:
          type: boolean
          description: forms.is_public
        created_by:
          type: integer
          format: int64
          description: forms.created_by
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - code
      - status
      - is_public
      - created_by
      - created_at
      - updated_at
    FormTranslation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        form_id:
          type: integer
          format: int64
        locale:
          type: string
          enum:
          - ja
          - en
        title:
          type: string
          description: フォーム名
        description:
          type: string
          description: 説明
          example: ''
      required:
      - id
      - form_id
      - locale
      - title
    FormField:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: form_fields.id
        form_id:
          type: integer
          format: int64
          description: form_fields.form_id
        field_key:
          type: string
          description: form_fields.field_key
        type:
          type: string
          description: form_fields.type（input種別）
        sort_order:
          type: integer
          format: int32
          description: form_fields.sort_order
        is_required:
          type: boolean
          description: form_fields.is_required（固定必須）
        options_json:
          type:
          - object
          - 'null'
          description: 選択肢など（JSON）
        visibility_rule:
          type:
          - object
          - 'null'
          description: A-06 visibility_rule(JSON)
        required_rule:
          type:
          - object
          - 'null'
          description: A-06 required_rule(JSON)
        step_transition_rule:
          type:
          - object
          - 'null'
          description: A-06 step_transition_rule(JSON)
      required:
      - id
      - form_id
      - field_key
      - type
      - sort_order
      - is_required
    ConditionState:
      type: object
      properties:
        version:
          type: string
          enum:
          - '1'
        evaluated_at:
          type: string
          format: date-time
        fields:
          type: object
          additionalProperties:
            type: object
            properties:
              visible:
                type: boolean
              required:
                type: boolean
              store:
                type: string
                enum:
                - store
                - do_not_store
              eval:
                type: string
                enum:
                - ok
                - fallback
                - error
              reasons:
                type: array
                items:
                  type: object
                  properties:
                    kind:
                      type: string
                      enum:
                      - rule
                      - type
                      - missing_field
                      - unknown_operator
                    path:
                      type: string
                    message:
                      type: string
                description: 任意（デバッグ用途）
            required:
            - visible
            - required
            - store
            - eval
        step:
          type:
          - object
          - 'null'
          description: STEP遷移状態（STEPモードで利用）
      required:
      - version
      - evaluated_at
      - fields
      description: 条件分岐評価結果（API→UI I/F）
    Submission:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submissions.id
        form_id:
          type: integer
          format: int64
          description: submissions.form_id
        status:
          type: string
          description: submissions.status
          enum:
          - received
          - confirmed
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - form_id
      - status
      - created_at
      - updated_at
    SubmissionValue:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submission_values.id
        submission_id:
          type: integer
          format: int64
          description: submission_values.submission_id
        field_key:
          type: string
          description: submission_values.field_key
        field_label_snapshot:
          type:
          - string
          - 'null'
          description: ラベルスナップショット
        value_json:
          oneOf:
          - type: string
          - type: number
          - type: boolean
          - type: object
          - type: array
          - type: 'null'
          description: 回答 value（JSON）
        label_json:
          type:
          - object
          - 'null'
          description: label スナップショット（JSON）
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - field_key
      - value_json
      - created_at
    Notification:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        channel:
          type: string
          enum:
          - mail
          - slack
        status:
          type: string
          enum:
          - queued
          - sent
          - failed
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - channel
      - status
      - created_at
    SubmissionPdf:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        pdf_type:
          type: string
          enum:
          - submission
          - ack
        storage_path:
          type: string
          description: S3等の保存先パス
        is_latest:
          type: boolean
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - pdf_type
      - storage_path
      - is_latest
      - created_at
    PaginatedForms:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Form'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum: &id002
          - created_at_desc
          - created_at_asc
      required:
      - items
      - total
      - page
      - per_page
      - sort
    PaginatedResponses:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Submission'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum: *id002
      required:
      - items
      - total
      - page
      - per_page
      - sort
    SortEnum:
      type: string
      description: 一覧系 sort。既定=created_at_desc
      enum: *id002
  responses:
    Unauthorized: &id004
      description: 401 Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    Forbidden: &id005
      description: 403 Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    ValidationError: &id003
      description: 422 Validation Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
paths:
  /v1/auth/login:
    post:
      tags:
      - Auth
      summary: ログイン
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type:
                        - string
                        - 'null'
                        description: token方式の場合に返却（Sanctum SPAの場合null）
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422': *id003
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                remember:
                  type: boolean
              required:
              - email
              - password
  /v1/auth/logout:
    post:
      tags:
      - Auth
      summary: ログアウト
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logged_out:
                        type: boolean
                    required:
                    - logged_out
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
      security:
      - bearerAuth: []
  /v1/auth/me:
    get:
      tags:
      - Auth
      summary: 自分自身の情報
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
      security:
      - bearerAuth: []
  /v1/forms:
    get:
      tags:
      - Forms
      summary: フォーム一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      forms:
                        $ref: '#/components/schemas/PaginatedForms'
                    required:
                    - forms
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters:
      - &id009
        name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - &id010
        name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - &id011
        name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - draft
          - published
          - closed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（部分一致）
        required: false
    post:
      tags:
      - Forms
      summary: フォーム作成
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: &id006
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema: *id006
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: フォーム識別子
                  example: CONTACT_2026
                is_public:
                  type: boolean
                  example: false
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
                  description: 多言語（初期）
              required:
              - code
  /v1/forms/{id}:
    get:
      tags:
      - Forms
      summary: フォーム取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                      translations:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormTranslation'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters: &id007
      - &id008
        name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
    put:
      tags:
      - Forms
      summary: フォーム更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      parameters: *id007
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                  - draft
                  - published
                  - closed
                is_public:
                  type: boolean
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
    delete:
      tags:
      - Forms
      summary: フォーム削除（論理）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      deleted:
                        type: boolean
                    required:
                    - deleted
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters: *id007
  /v1/forms/{id}/fields:
    get:
      tags:
      - Forms
      summary: フォーム項目一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters:
      - *id008
      - name: include_rules
        in: query
        schema:
          type: boolean
          description: visibility/required rules を含める
        required: false
    put:
      tags:
      - Forms
      summary: フォーム項目一括更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      parameters: *id007
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fields:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormField'
              required:
              - fields
  /v1/responses:
    get:
      tags:
      - Responses
      summary: 送信一覧（Responses）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      responses:
                        $ref: '#/components/schemas/PaginatedResponses'
                    required:
                    - responses
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters:
      - *id009
      - *id010
      - *id011
      - name: form_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - received
          - confirmed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（メール/氏名など：A-02検索マトリクスに委譲）
        required: false
  /v1/responses/{id}:
    get:
      tags:
      - Responses
      summary: 送信詳細
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      response:
                        $ref: '#/components/schemas/Submission'
                      values:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionValue'
                      notifications:
                        type: array
                        items:
                          $ref: '#/components/schemas/Notification'
                      pdfs:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionPdf'
                    required:
                    - response
                    - values
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters: *id007
  /v1/forms/{form_key}/submit:
    post:
      tags:
      - ACK/PDF
      summary: 公開 submit
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      submission_id:
                        type: integer
                        format: int64
                      ack_url:
                        type: string
                        description: ACK URL（UI遷移用）
                      condition_state:
                        $ref: '#/components/schemas/ConditionState'
                    required:
                    - submission_id
                    - ack_url
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422': *id003
      parameters:
      - &id012
        name: form_key
        in: path
        schema:
          type: string
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                answers:
                  type: object
                  additionalProperties:
                    oneOf:
                    - type: string
                    - type: number
                    - type: boolean
                    - type: object
                    - type: array
                    - type: 'null'
                locale:
                  type: string
                  enum:
                  - ja
                  - en
                mode:
                  type: string
                  description: both/value/label (CSV等の表現に委譲)
                  enum:
                  - both
                  - value
                  - label
              required:
              - answers
  /v1/forms/{form_key}/ack:
    get:
      tags:
      - ACK/PDF
      summary: ACK 表示
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      ack:
                        type: object
                        description: ACK 表示データ（テンプレ/変数はA-04に委譲）
                      pdf_url:
                        type:
                        - string
                        - 'null'
                        description: PDFダウンロードURL（許可される場合）
                    required:
                    - ack
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
      parameters:
      - *id012
      - name: token
        in: query
        schema:
          type: string
          description: confirm_url token
        required: false
      - name: submission_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
  /v1/responses/{id}/pdf:
    get:
      tags:
      - ACK/PDF
      summary: PDF 取得（管理側）
      responses:
        '200':
          description: OK
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters:
      - *id008
      - name: pdf_type
        in: query
        schema:
          type: string
          enum:
          - submission
          - ack
        required: false
  /v1/dashboard/summary:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード集計
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      summary:
                        type: object
                        properties:
                          forms_count:
                            type: integer
                            format: int32
                          responses_today:
                            type: integer
                            format: int32
                          responses_total:
                            type: integer
                            format: int32
                        required:
                        - forms_count
                        - responses_today
                        - responses_total
                    required:
                    - summary
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
  /v1/dashboard/errors:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード（エラー/失敗一覧）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      errors:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                kind:
                                  type: string
                                  enum:
                                  - mail_failed
                                  - slack_failed
                                  - pdf_failed
                                  - eval_error
                                  - other
                                message:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - kind
                              - message
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum: *id002
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - errors
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters:
      - *id009
      - *id010
      - *id011
  /v1/system/admin-users:
    get:
      tags:
      - System Admin
      summary: 管理者ユーザ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      users:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/User'
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum: *id002
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - users
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters:
      - *id009
      - *id010
      - *id011
      - name: role
        in: query
        schema:
          type: string
          enum:
          - SYSTEM_ADMIN
          - FORM_ADMIN
          - LOG_ADMIN
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - active
          - suspended
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（email/name）
        required: false
    post:
      tags:
      - System Admin
      summary: 管理者ユーザ作成（招待）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema: &id013
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema: *id013
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                roles:
                  type: array
                  items:
                    type: string
                    enum:
                    - SYSTEM_ADMIN
                    - FORM_ADMIN
                    - LOG_ADMIN
              required:
              - name
              - email
              - roles
  /v1/system/admin-users/{id}:
    put:
      tags:
      - System Admin
      summary: 管理者ユーザ更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      parameters: *id007
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                status:
                  type: string
                  enum:
                  - active
                  - suspended
                roles:
                  type: array
                  items:
                    type: string
                    enum:
                    - SYSTEM_ADMIN
                    - FORM_ADMIN
                    - LOG_ADMIN
  /v1/system/admin-users/invites/resend:
    post:
      tags:
      - System Admin
      summary: 招待再送
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sent:
                        type: boolean
                    required:
                    - sent
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  format: int64
              required:
              - user_id
  /v1/system/admin-audit-logs:
    get:
      tags:
      - System Admin
      summary: 監査ログ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logs:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                actor_user_id:
                                  type: integer
                                  format: int64
                                action:
                                  type: string
                                target_type:
                                  type: string
                                target_id:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - actor_user_id
                              - action
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum: *id002
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - logs
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
      parameters:
      - *id009
      - *id010
      - *id011
      - name: user_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: action
        in: query
        schema:
          type: string
        required: false
  /v1/system/roles/permissions:
    get:
      tags:
      - SUP (root-only)
      summary: ロール権限定義取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      roles:
                        type: array
                        items:
                          type: object
                          properties:
                            role:
                              type: string
                            permissions:
                              type: array
                              items:
                                type: string
                          required:
                          - role
                          - permissions
                    required:
                    - roles
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: ロール権限定義更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      updated:
                        type: boolean
                    required:
                    - updated
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string
                    required:
                    - role
                    - permissions
              required:
              - roles
  /v1/system/settings:
    get:
      tags:
      - SUP (root-only)
      summary: システム設定取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: システム設定更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401': *id004
        '403': *id005
        '422': *id003
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                settings:
                  type: object
              required:
              - settings


## API-0021 reforma-api-spec-v1.1.0

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0.json`

```json
{
  "meta": {
    "title": "03.ReForma API 仕様書 v1.1（統合版）",
    "version": "1.1",
    "type": "consolidated",
    "generated_at": "2026-01-12T13:08:16.120363"
  },
  "mount": {
    "spa_base": "/reforma/",
    "api_base": "/reforma/api/",
    "version_prefix": "/v1",
    "example": "/reforma/api/v1/auth/me",
    "no_api_double_prefix": true
  },
  "auth": {
    "v1_0_example": "Bearer JWT",
    "v1_1_official": "SPA session auth (Sanctum or equivalent)",
    "public_token": "confirm_url token (when required)"
  },
  "envelope": {
    "success": "boolean",
    "data": "any",
    "message": "string|null",
    "errors": "object|null",
    "error_extras": {
      "code": "string|null",
      "request_id": "string"
    }
  },
  "list_policy": {
    "page_required": true,
    "per_page_required": true,
    "sort_optional": true,
    "sort_enum": [
      "created_at_desc",
      "created_at_asc"
    ],
    "default_sort": "created_at_desc",
    "response_required_fields": [
      "items",
      "total",
      "page",
      "per_page"
    ]
  },
  "async_policy": {
    "queue_required": true,
    "targets": [
      "mail",
      "slack",
      "pdf"
    ],
    "accepted_status": 202
  },
  "root_only": {
    "user_attribute": "is_root",
    "required_role": "system_admin",
    "screen_flag": "allow_root_only",
    "api_middleware": "RootOnly (system_admin && is_root)",
    "double_defense_required": true,
    "planned": true
  },
  "endpoints": [
    {
      "method": "POST",
      "path": "/v1/auth/login",
      "category": "auth",
      "auth_required": false,
      "allow_roles": []
    },
    {
      "method": "POST",
      "path": "/v1/auth/logout",
      "category": "auth",
      "auth_required": true,
      "allow_roles": [
        "viewer",
        "operator",
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "GET",
      "path": "/v1/auth/me",
      "category": "auth",
      "auth_required": true,
      "allow_roles": [
        "viewer",
        "operator",
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "GET",
      "path": "/v1/forms",
      "category": "forms",
      "auth_required": true,
      "allow_roles": [
        "form_admin",
        "system_admin"
      ],
      "list": true
    },
    {
      "method": "POST",
      "path": "/v1/forms",
      "category": "forms",
      "auth_required": true,
      "allow_roles": [
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "GET",
      "path": "/v1/forms/{id}",
      "category": "forms",
      "auth_required": true,
      "allow_roles": [
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "PUT",
      "path": "/v1/forms/{id}",
      "category": "forms",
      "auth_required": true,
      "allow_roles": [
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "DELETE",
      "path": "/v1/forms/{id}",
      "category": "forms",
      "auth_required": true,
      "allow_roles": [
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "GET",
      "path": "/v1/forms/{id}/fields",
      "category": "fields",
      "auth_required": true,
      "allow_roles": [
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "PUT",
      "path": "/v1/forms/{id}/fields",
      "category": "fields",
      "auth_required": true,
      "allow_roles": [
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "GET",
      "path": "/v1/responses",
      "category": "responses",
      "auth_required": true,
      "allow_roles": [
        "operator",
        "form_admin",
        "system_admin"
      ],
      "list": true
    },
    {
      "method": "GET",
      "path": "/v1/responses/{id}",
      "category": "responses",
      "auth_required": true,
      "allow_roles": [
        "operator",
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "POST",
      "path": "/v1/forms/{form_key}/submit",
      "category": "public",
      "auth_required": false,
      "allow_roles": [
        "public"
      ],
      "public": true
    },
    {
      "method": "GET",
      "path": "/v1/forms/{form_key}/ack",
      "category": "public",
      "auth_required": false,
      "allow_roles": [
        "public"
      ],
      "public": true
    },
    {
      "method": "GET",
      "path": "/v1/responses/{id}/pdf",
      "category": "pdf",
      "auth_required": true,
      "allow_roles": [
        "operator",
        "form_admin",
        "system_admin"
      ],
      "async": true
    },
    {
      "method": "GET",
      "path": "/v1/search",
      "category": "search",
      "auth_required": true,
      "allow_roles": [
        "operator",
        "form_admin",
        "system_admin"
      ],
      "list": true
    },
    {
      "method": "GET",
      "path": "/v1/logs",
      "category": "logs",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "list": true
    },
    {
      "method": "GET",
      "path": "/v1/logs/{id}",
      "category": "logs",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ]
    },
    {
      "method": "GET",
      "path": "/v1/dashboard/summary",
      "category": "dashboard",
      "auth_required": true,
      "allow_roles": [
        "viewer",
        "operator",
        "form_admin",
        "system_admin"
      ]
    },
    {
      "method": "GET",
      "path": "/v1/dashboard/errors",
      "category": "dashboard",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "note": "additional restriction beyond screen allow_roles"
    },
    {
      "method": "GET",
      "path": "/v1/system/admin-users",
      "category": "system",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "list": true,
      "source": "SUP"
    },
    {
      "method": "POST",
      "path": "/v1/system/admin-users",
      "category": "system",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "source": "SUP"
    },
    {
      "method": "PUT",
      "path": "/v1/system/admin-users/{id}",
      "category": "system",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "source": "SUP"
    },
    {
      "method": "POST",
      "path": "/v1/system/admin-users/invites/resend",
      "category": "system",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "source": "SUP"
    },
    {
      "method": "GET",
      "path": "/v1/system/admin-audit-logs",
      "category": "system",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "list": true,
      "source": "SUP"
    },
    {
      "method": "GET",
      "path": "/v1/system/settings",
      "category": "root_only",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "root_only": true,
      "status": "planned"
    },
    {
      "method": "PUT",
      "path": "/v1/system/settings",
      "category": "root_only",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "root_only": true,
      "status": "planned"
    },
    {
      "method": "GET",
      "path": "/v1/system/roles/permissions",
      "category": "root_only",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "root_only": true,
      "status": "planned"
    },
    {
      "method": "PUT",
      "path": "/v1/system/roles/permissions",
      "category": "root_only",
      "auth_required": true,
      "allow_roles": [
        "system_admin"
      ],
      "root_only": true,
      "status": "planned"
    }
  ],
  "delegation": {
    "basic_spec": "01.ReForma 基本仕様書 v1.1（統合版）",
    "screen_spec": "02.ReForma 画面仕様書 v1.1（統合版）",
    "db_spec": "04.ReForma DB 仕様書 v1.1",
    "extension_spec": "05.ReForma 拡張仕様書 v1.1"
  }
}
```

## API-0022 reforma-api-spec-v1.1.0

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.1.0.yaml`

openapi: 3.0.3
info:
  title: ReForma API v1.1 OpenAPI（起草：7.1/7.2/7.3/7.4/7.7/7.8）
  version: 1.1-openapi-draft-full
  description: API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI を“実装可能な粒度”まで増補した草案。
servers:
- url: /
tags:
- name: Auth
- name: Forms
- name: Responses
- name: ACK/PDF
- name: Dashboard
- name: System Admin
- name: SUP (root-only)
components:
  securitySchemes:
    sanctum:
      type: apiKey
      in: cookie
      name: XSRF-TOKEN
      description: Sanctum SPA session（例）。実装により Bearer 併用可
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Token
  schemas:
    EnvelopeSuccess:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        message:
          type:
          - string
          - 'null'
        errors:
          type:
          - object
          - 'null'
        code:
          type: string
          description: API共通コード（成功時はOK等）
          example: OK
        request_id:
          type: string
          description: リクエストID（追跡用）
          example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
      required:
      - success
      - code
      - request_id
      - message
      - data
      - errors
    EnvelopeError:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: 'null'
        message:
          type:
          - string
          - 'null'
        errors:
          type: object
          properties:
            code:
              type: string
              description: エラーコード
            fields:
              type: object
              additionalProperties:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列
            rule:
              type:
              - object
              - 'null'
            step:
              type:
              - object
              - 'null'
            reason:
              type: string
              description: '失敗理由（機械判定用）。例: ROOT_ONLY / SYSTEM_ADMIN_REQUIRED / TOKEN_EXPIRED など'
              example: ROOT_ONLY
          required:
          - code
          description: errors 本体（用途に応じて fields/rule/step を利用）
        code:
          type: string
          description: 'API共通コード（例: FORBIDDEN / CONSTRAINT_VIOLATION / VALIDATION_ERROR 等）'
          example: FORBIDDEN
        request_id:
          type: string
          description: リクエストID（追跡用）
          example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
      required:
      - success
      - code
      - request_id
      - message
      - data
      - errors
    ErrorObject:
      type: object
      properties:
        code:
          type: string
          description: エラーコード
        fields:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
            description: エラーメッセージ配列
        rule:
          type:
          - object
          - 'null'
        step:
          type:
          - object
          - 'null'
        reason:
          type: string
          description: 失敗理由（機械判定用）
          example: ROOT_ONLY
      required:
      - code
      description: errors 本体（用途に応じて fields/rule/step を利用）
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: users.id
        name:
          type: string
          description: 表示名
        email:
          type: string
          description: メールアドレス
          format: email
        status:
          type: string
          description: active / suspended
          enum:
          - active
          - suspended
        roles:
          type: array
          items:
            type: string
            enum:
            - SYSTEM_ADMIN
            - FORM_ADMIN
            - LOG_ADMIN
          description: 付与ロール
      required:
      - id
      - name
      - email
      - status
      - roles
    Form:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: forms.id
        code:
          type: string
          description: forms.code（フォーム識別子）
        status:
          type: string
          description: forms.status
          enum:
          - draft
          - published
          - closed
        is_public:
          type: boolean
          description: forms.is_public
        created_by:
          type: integer
          format: int64
          description: forms.created_by
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - code
      - status
      - is_public
      - created_by
      - created_at
      - updated_at
    FormTranslation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        form_id:
          type: integer
          format: int64
        locale:
          type: string
          enum:
          - ja
          - en
        title:
          type: string
          description: フォーム名
        description:
          type: string
          description: 説明
          example: ''
      required:
      - id
      - form_id
      - locale
      - title
    FormField:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: form_fields.id
        form_id:
          type: integer
          format: int64
          description: form_fields.form_id
        field_key:
          type: string
          description: form_fields.field_key
        type:
          type: string
          description: form_fields.type（input種別）
        sort_order:
          type: integer
          format: int32
          description: form_fields.sort_order
        is_required:
          type: boolean
          description: form_fields.is_required（固定必須）
        options_json:
          type:
          - object
          - 'null'
          description: 選択肢など（JSON）
        visibility_rule:
          type:
          - object
          - 'null'
          description: A-06 visibility_rule(JSON)
        required_rule:
          type:
          - object
          - 'null'
          description: A-06 required_rule(JSON)
        step_transition_rule:
          type:
          - object
          - 'null'
          description: A-06 step_transition_rule(JSON)
      required:
      - id
      - form_id
      - field_key
      - type
      - sort_order
      - is_required
    ConditionState:
      type: object
      properties:
        version:
          type: string
          enum:
          - '1'
        evaluated_at:
          type: string
          format: date-time
        fields:
          type: object
          additionalProperties:
            type: object
            properties:
              visible:
                type: boolean
              required:
                type: boolean
              store:
                type: string
                enum:
                - store
                - do_not_store
              eval:
                type: string
                enum:
                - ok
                - fallback
                - error
              reasons:
                type: array
                items:
                  type: object
                  properties:
                    kind:
                      type: string
                      enum:
                      - rule
                      - type
                      - missing_field
                      - unknown_operator
                    path:
                      type: string
                    message:
                      type: string
                description: 任意（デバッグ用途）
            required:
            - visible
            - required
            - store
            - eval
        step:
          type:
          - object
          - 'null'
          description: STEP遷移状態（STEPモードで利用）
      required:
      - version
      - evaluated_at
      - fields
      description: 条件分岐評価結果（API→UI I/F）
    Submission:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submissions.id
        form_id:
          type: integer
          format: int64
          description: submissions.form_id
        status:
          type: string
          description: submissions.status
          enum:
          - received
          - confirmed
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - form_id
      - status
      - created_at
      - updated_at
    SubmissionValue:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submission_values.id
        submission_id:
          type: integer
          format: int64
          description: submission_values.submission_id
        field_key:
          type: string
          description: submission_values.field_key
        field_label_snapshot:
          type:
          - string
          - 'null'
          description: ラベルスナップショット
        value_json:
          oneOf:
          - type: string
          - type: number
          - type: boolean
          - type: object
          - type: array
          - type: 'null'
          description: 回答 value（JSON）
        label_json:
          type:
          - object
          - 'null'
          description: label スナップショット（JSON）
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - field_key
      - value_json
      - created_at
    Notification:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        channel:
          type: string
          enum:
          - mail
          - slack
        status:
          type: string
          enum:
          - queued
          - sent
          - failed
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - channel
      - status
      - created_at
    SubmissionPdf:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        pdf_type:
          type: string
          enum:
          - submission
          - ack
        storage_path:
          type: string
          description: S3等の保存先パス
        is_latest:
          type: boolean
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - pdf_type
      - storage_path
      - is_latest
      - created_at
    PaginatedForms:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Form'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum:
          - created_at_desc
          - created_at_asc
      required:
      - items
      - total
      - page
      - per_page
      - sort
    PaginatedResponses:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Submission'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum:
          - created_at_desc
          - created_at_asc
      required:
      - items
      - total
      - page
      - per_page
      - sort
    SortEnum:
      type: string
      description: 一覧系 sort。既定=created_at_desc
      enum:
      - created_at_desc
      - created_at_asc
  responses:
    Unauthorized:
      description: 401 Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    Forbidden:
      description: 403 Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    ValidationError:
      description: 422 Validation Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
  examples:
    ForbiddenRootOnly:
      summary: root-only により拒否
      value:
        success: false
        data: null
        message: Forbidden.
        errors:
          reason: ROOT_ONLY
        code: FORBIDDEN
        request_id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
    ForbiddenSystemAdminRequired:
      summary: system_admin 必須により拒否
      value:
        success: false
        data: null
        message: Forbidden.
        errors:
          reason: SYSTEM_ADMIN_REQUIRED
        code: FORBIDDEN
        request_id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
paths:
  /v1/auth/login:
    post:
      tags:
      - Auth
      summary: ログイン
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type:
                        - string
                        - 'null'
                        description: token方式の場合に返却（Sanctum SPAの場合null）
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                remember:
                  type: boolean
              required:
              - email
              - password
  /v1/auth/logout:
    post:
      tags:
      - Auth
      summary: ログアウト
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logged_out:
                        type: boolean
                    required:
                    - logged_out
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/auth/me:
    get:
      tags:
      - Auth
      summary: 自分自身の情報
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/forms:
    get:
      tags:
      - Forms
      summary: フォーム一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      forms:
                        $ref: '#/components/schemas/PaginatedForms'
                    required:
                    - forms
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - draft
          - published
          - closed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（部分一致）
        required: false
    post:
      tags:
      - Forms
      summary: フォーム作成
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: フォーム識別子
                  example: CONTACT_2026
                is_public:
                  type: boolean
                  example: false
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
                  description: 多言語（初期）
              required:
              - code
  /v1/forms/{id}:
    get:
      tags:
      - Forms
      summary: フォーム取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                      translations:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormTranslation'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
    put:
      tags:
      - Forms
      summary: フォーム更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                  - draft
                  - published
                  - closed
                is_public:
                  type: boolean
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
    delete:
      tags:
      - Forms
      summary: フォーム削除（論理）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      deleted:
                        type: boolean
                    required:
                    - deleted
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
  /v1/forms/{id}/fields:
    get:
      tags:
      - Forms
      summary: フォーム項目一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      - name: include_rules
        in: query
        schema:
          type: boolean
          description: visibility/required rules を含める
        required: false
    put:
      tags:
      - Forms
      summary: フォーム項目一括更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fields:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormField'
              required:
              - fields
  /v1/responses:
    get:
      tags:
      - Responses
      summary: 送信一覧（Responses）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      responses:
                        $ref: '#/components/schemas/PaginatedResponses'
                    required:
                    - responses
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: form_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - received
          - confirmed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（メール/氏名など：A-02検索マトリクスに委譲）
        required: false
  /v1/responses/{id}:
    get:
      tags:
      - Responses
      summary: 送信詳細
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      response:
                        $ref: '#/components/schemas/Submission'
                      values:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionValue'
                      notifications:
                        type: array
                        items:
                          $ref: '#/components/schemas/Notification'
                      pdfs:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionPdf'
                    required:
                    - response
                    - values
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
  /v1/forms/{form_key}/submit:
    post:
      tags:
      - ACK/PDF
      summary: 公開 submit
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      submission_id:
                        type: integer
                        format: int64
                      ack_url:
                        type: string
                        description: ACK URL（UI遷移用）
                      condition_state:
                        $ref: '#/components/schemas/ConditionState'
                    required:
                    - submission_id
                    - ack_url
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      parameters:
      - name: form_key
        in: path
        schema:
          type: string
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                answers:
                  type: object
                  additionalProperties:
                    oneOf:
                    - type: string
                    - type: number
                    - type: boolean
                    - type: object
                    - type: array
                    - type: 'null'
                locale:
                  type: string
                  enum:
                  - ja
                  - en
                mode:
                  type: string
                  description: both/value/label (CSV等の表現に委譲)
                  enum:
                  - both
                  - value
                  - label
              required:
              - answers
  /v1/forms/{form_key}/ack:
    get:
      tags:
      - ACK/PDF
      summary: ACK 表示
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      ack:
                        type: object
                        description: ACK 表示データ（テンプレ/変数はA-04に委譲）
                      pdf_url:
                        type:
                        - string
                        - 'null'
                        description: PDFダウンロードURL（許可される場合）
                    required:
                    - ack
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
      parameters:
      - name: form_key
        in: path
        schema:
          type: string
        required: true
      - name: token
        in: query
        schema:
          type: string
          description: confirm_url token
        required: false
      - name: submission_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
  /v1/responses/{id}/pdf:
    get:
      tags:
      - ACK/PDF
      summary: PDF 取得（管理側）
      responses:
        '200':
          description: OK
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      - name: pdf_type
        in: query
        schema:
          type: string
          enum:
          - submission
          - ack
        required: false
  /v1/dashboard/summary:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード集計
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      summary:
                        type: object
                        properties:
                          forms_count:
                            type: integer
                            format: int32
                          responses_today:
                            type: integer
                            format: int32
                          responses_total:
                            type: integer
                            format: int32
                        required:
                        - forms_count
                        - responses_today
                        - responses_total
                    required:
                    - summary
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/dashboard/errors:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード（エラー/失敗一覧）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      errors:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                kind:
                                  type: string
                                  enum:
                                  - mail_failed
                                  - slack_failed
                                  - pdf_failed
                                  - eval_error
                                  - other
                                message:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - kind
                              - message
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - errors
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
  /v1/system/admin-users:
    get:
      tags:
      - System Admin
      summary: 管理者ユーザ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      users:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/User'
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - users
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: role
        in: query
        schema:
          type: string
          enum:
          - SYSTEM_ADMIN
          - FORM_ADMIN
          - LOG_ADMIN
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - active
          - suspended
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（email/name）
        required: false
    post:
      tags:
      - System Admin
      summary: 管理者ユーザ作成（招待）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                roles:
                  type: array
                  items:
                    type: string
                    enum:
                    - SYSTEM_ADMIN
                    - FORM_ADMIN
                    - LOG_ADMIN
              required:
              - name
              - email
              - roles
  /v1/system/admin-users/{id}:
    put:
      tags:
      - System Admin
      summary: 管理者ユーザ更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
              examples:
                ROOT_ONLY:
                  $ref: '#/components/examples/ForbiddenRootOnly'
                SYSTEM_ADMIN_REQUIRED:
                  $ref: '#/components/examples/ForbiddenSystemAdminRequired'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                status:
                  type: string
                  enum:
                  - active
                  - suspended
                roles:
                  type: array
                  items:
                    type: string
                    enum:
                    - SYSTEM_ADMIN
                    - FORM_ADMIN
                    - LOG_ADMIN
      description: '### RBAC

        - 必須: system_admin

        - **system_admin 付与（昇格）**は root-only（is_root=true 必須）

        - system_admin 剥奪（降格）は system_admin で可（ただし自己降格禁止・最後の system_admin 禁止）'
  /v1/system/admin-users/invites/resend:
    post:
      tags:
      - System Admin
      summary: 招待再送
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sent:
                        type: boolean
                    required:
                    - sent
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  format: int64
              required:
              - user_id
  /v1/system/admin-audit-logs:
    get:
      tags:
      - System Admin
      summary: 監査ログ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logs:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                actor_user_id:
                                  type: integer
                                  format: int64
                                action:
                                  type: string
                                target_type:
                                  type: string
                                target_id:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - actor_user_id
                              - action
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - logs
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: user_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: action
        in: query
        schema:
          type: string
        required: false
  /v1/system/roles/permissions:
    get:
      tags:
      - SUP (root-only)
      summary: ロール権限定義取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      roles:
                        type: array
                        items:
                          type: object
                          properties:
                            role:
                              type: string
                            permissions:
                              type: array
                              items:
                                type: string
                          required:
                          - role
                          - permissions
                    required:
                    - roles
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: ロール権限定義更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      updated:
                        type: boolean
                    required:
                    - updated
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string
                    required:
                    - role
                    - permissions
              required:
              - roles
  /v1/system/settings:
    get:
      tags:
      - SUP (root-only)
      summary: システム設定取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: システム設定更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                settings:
                  type: object
              required:
              - settings
  /v1/system/root-only/ping:
    get:
      tags:
      - SUP (root-only)
      summary: root-only 動作確認（ping）
      description: root-only ミドルウェア動作確認用。system_admin を満たした上で is_root=true の場合のみ成功。
      security:
      - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      pong:
                        type: boolean
                    required:
                    - pong
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                  code:
                    type: string
                    example: OK
                  request_id:
                    type: string
                required:
                - success
                - data
                - code
                - request_id
              examples:
                OK:
                  summary: 成功
                  value:
                    success: true
                    data:
                      pong: true
                    message: null
                    errors: null
                    code: OK
                    request_id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
              examples:
                ROOT_ONLY:
                  $ref: '#/components/examples/ForbiddenRootOnly'
                SYSTEM_ADMIN_REQUIRED:
                  $ref: '#/components/examples/ForbiddenSystemAdminRequired'


## API-0023 reforma-api-spec-v1.3.0

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.3.0.json`

```json
{
  "openapi": "3.0.3",
  "info": {
    "title": "ReForma API v1.1 OpenAPI（起草：7.1/7.2/7.3/7.4/7.7/7.8） (v1.3.0)",
    "version": "1.3.0",
    "description": "API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI を“実装可能な粒度”まで増補した草案。"
  },
  "servers": [
    {
      "url": "/reforma/api"
    }
  ],
  "tags": [
    {
      "name": "Auth"
    },
    {
      "name": "Forms"
    },
    {
      "name": "Responses"
    },
    {
      "name": "ACK/PDF"
    },
    {
      "name": "Dashboard"
    },
    {
      "name": "System Admin"
    },
    {
      "name": "SUP (root-only)"
    },
    {
      "name": "progress",
      "description": "進捗取得"
    },
    {
      "name": "search",
      "description": "横断検索"
    },
    {
      "name": "logs",
      "description": "ログ"
    },
    {
      "name": "public-forms",
      "description": "公開フォーム"
    },
    {
      "name": "system-admin-users",
      "description": "管理者ユーザ"
    },
    {
      "name": "exports",
      "description": "成果物"
    },
    {
      "name": "responses",
      "description": "回答"
    }
  ],
  "components": {
    "securitySchemes": {
      "sanctum": {
        "type": "apiKey",
        "in": "cookie",
        "name": "XSRF-TOKEN",
        "description": "Sanctum SPA session（例）。実装により Bearer 併用可"
      },
      "bearerAuth": {
        "type": "http",
        "scheme": "bearer",
        "bearerFormat": "Token"
      }
    },
    "schemas": {
      "EnvelopeSuccess": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "object"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": [
              "object",
              "null"
            ]
          },
          "code": {
            "type": "string",
            "description": "API共通コード（成功時はOK等）",
            "example": "OK"
          },
          "request_id": {
            "type": "string",
            "description": "リクエストID（追跡用）",
            "example": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
          }
        },
        "required": [
          "success",
          "code",
          "request_id",
          "message",
          "data",
          "errors"
        ]
      },
      "EnvelopeError": {
        "type": "object",
        "properties": {
          "success": {
            "type": "boolean"
          },
          "data": {
            "type": "null"
          },
          "message": {
            "type": [
              "string",
              "null"
            ]
          },
          "errors": {
            "type": "object",
            "properties": {
              "fields": {
                "type": "object",
                "additionalProperties": {
                  "type": "array",
                  "items": {
                    "type": "string"
                  },
                  "description": "エラーメッセージ配列"
                }
              },
              "rule": {
                "type": [
                  "object",
                  "null"
                ]
              },
              "step": {
                "type": [
                  "object",
                  "null"
                ]
              },
              "reason": {
                "type": "string",
                "description": "失敗理由（機械判定用）。例: ROOT_ONLY / EXPIRED / URL_EXPIRED / SYSTEM_ADMIN_REQUIRED / TOKEN_EXPIRED",
                "example": "ROOT_ONLY"
              }
            },
            "required": [],
            "description": "errors 本体（用途に応じて fields/rule/step を利用）"
          },
          "code": {
            "type": "string",
            "description": "API共通コード（例: FORBIDDEN / CONSTRAINT_VIOLATION / VALIDATION_ERROR 等）",
            "example": "FORBIDDEN"
          },
          "request_id": {
            "type": "string",
            "description": "リクエストID（追跡用）",
            "example": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
          }
        },
        "required": [
          "success",
          "code",
          "request_id",
          "message",
          "data",
          "errors"
        ]
      },
      "ErrorObject": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "description": "エラーコード"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "エラーメッセージ配列"
            }
          },
          "rule": {
            "type": [
              "object",
              "null"
            ]
          },
          "step": {
            "type": [
              "object",
              "null"
            ]
          },
          "reason": {
            "type": "string",
            "description": "失敗理由（機械判定用）",
            "example": "ROOT_ONLY"
          }
        },
        "required": [
          "code"
        ],
        "description": "errors 本体（用途に応じて fields/rule/step を利用）"
      },
      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "users.id"
          },
          "name": {
            "type": "string",
            "description": "表示名"
          },
          "email": {
            "type": "string",
            "description": "メールアドレス",
            "format": "email"
          },
          "status": {
            "type": "string",
            "description": "active / suspended",
            "enum": [
              "active",
              "suspended"
            ]
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "description": "付与ロール"
          },
          "is_root": {
            "type": "boolean",
            "description": "root-only 判定フラグ（/auth/me 正本）"
          },
          "form_create_limit_enabled": {
            "type": "boolean",
            "description": "フォーム作成数制限を適用するか"
          },
          "form_create_limit": {
            "type": [
              "integer",
              "null"
            ],
            "description": "フォーム作成可能数（enabled=true の場合のみ有効。min=1）",
            "minimum": 1
          },
          "role": {
            "type": [
              "string",
              "null"
            ],
            "deprecated": true,
            "description": "(deprecated) 互換のため残置。正本は roles[]。将来削除予定。",
            "enum": [
              "SYSTEM_ADMIN",
              "FORM_ADMIN",
              "LOG_ADMIN",
              "system_admin",
              "form_admin",
              "log_admin"
            ]
          }
        },
        "required": [
          "id",
          "name",
          "email",
          "status",
          "roles",
          "is_root",
          "form_create_limit_enabled",
          "form_create_limit"
        ]
      },
      "Form": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "forms.id"
          },
          "code": {
            "type": "string",
            "description": "forms.code（フォーム識別子）"
          },
          "status": {
            "type": "string",
            "description": "forms.status",
            "enum": [
              "draft",
              "published",
              "closed"
            ]
          },
          "is_public": {
            "type": "boolean",
            "description": "forms.is_public"
          },
          "created_by": {
            "type": "integer",
            "format": "int64",
            "description": "forms.created_by"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "code",
          "status",
          "is_public",
          "created_by",
          "created_at",
          "updated_at"
        ]
      },
      "FormTranslation": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "form_id": {
            "type": "integer",
            "format": "int64"
          },
          "locale": {
            "type": "string",
            "enum": [
              "ja",
              "en"
            ]
          },
          "title": {
            "type": "string",
            "description": "フォーム名"
          },
          "description": {
            "type": "string",
            "description": "説明",
            "example": ""
          }
        },
        "required": [
          "id",
          "form_id",
          "locale",
          "title"
        ]
      },
      "FormField": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "form_fields.form_id"
          },
          "field_key": {
            "type": "string",
            "description": "form_fields.field_key"
          },
          "type": {
            "type": "string",
            "description": "form_fields.type（input種別）"
          },
          "sort_order": {
            "type": "integer",
            "format": "int32",
            "description": "form_fields.sort_order"
          },
          "is_required": {
            "type": "boolean",
            "description": "form_fields.is_required（固定必須）"
          },
          "options_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "選択肢など（JSON）"
          },
          "visibility_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 visibility_rule(JSON)"
          },
          "required_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 required_rule(JSON)"
          },
          "step_transition_rule": {
            "type": [
              "object",
              "null"
            ],
            "description": "A-06 step_transition_rule(JSON)"
          }
        },
        "required": [
          "id",
          "form_id",
          "field_key",
          "type",
          "sort_order",
          "is_required"
        ]
      },
      "ConditionState": {
        "type": "object",
        "properties": {
          "version": {
            "type": "string",
            "enum": [
              "1"
            ]
          },
          "evaluated_at": {
            "type": "string",
            "format": "date-time"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "type": "object",
              "properties": {
                "visible": {
                  "type": "boolean"
                },
                "required": {
                  "type": "boolean"
                },
                "store": {
                  "type": "string",
                  "enum": [
                    "store",
                    "do_not_store"
                  ]
                },
                "eval": {
                  "type": "string",
                  "enum": [
                    "ok",
                    "fallback",
                    "error"
                  ]
                },
                "reasons": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "kind": {
                        "type": "string",
                        "enum": [
                          "rule",
                          "type",
                          "missing_field",
                          "unknown_operator"
                        ]
                      },
                      "path": {
                        "type": "string"
                      },
                      "message": {
                        "type": "string"
                      }
                    }
                  },
                  "description": "任意（デバッグ用途）"
                }
              },
              "required": [
                "visible",
                "required",
                "store",
                "eval"
              ]
            }
          },
          "step": {
            "type": [
              "object",
              "null"
            ],
            "description": "STEP遷移状態（STEPモードで利用）"
          }
        },
        "required": [
          "version",
          "evaluated_at",
          "fields"
        ],
        "description": "条件分岐評価結果（API→UI I/F）"
      },
      "Submission": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.id"
          },
          "form_id": {
            "type": "integer",
            "format": "int64",
            "description": "submissions.form_id"
          },
          "status": {
            "type": "string",
            "description": "submissions.status",
            "enum": [
              "received",
              "confirmed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "form_id",
          "status",
          "created_at",
          "updated_at"
        ]
      },
      "SubmissionValue": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.id"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64",
            "description": "submission_values.submission_id"
          },
          "field_key": {
            "type": "string",
            "description": "submission_values.field_key"
          },
          "field_label_snapshot": {
            "type": [
              "string",
              "null"
            ],
            "description": "ラベルスナップショット"
          },
          "value_json": {
            "oneOf": [
              {
                "type": "string"
              },
              {
                "type": "number"
              },
              {
                "type": "boolean"
              },
              {
                "type": "object"
              },
              {
                "type": "array"
              },
              {
                "type": "null"
              }
            ],
            "description": "回答 value（JSON）"
          },
          "label_json": {
            "type": [
              "object",
              "null"
            ],
            "description": "label スナップショット（JSON）"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "field_key",
          "value_json",
          "created_at"
        ]
      },
      "Notification": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "channel": {
            "type": "string",
            "enum": [
              "mail",
              "slack"
            ]
          },
          "status": {
            "type": "string",
            "enum": [
              "queued",
              "sent",
              "failed"
            ]
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "channel",
          "status",
          "created_at"
        ]
      },
      "SubmissionPdf": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "submission_id": {
            "type": "integer",
            "format": "int64"
          },
          "pdf_type": {
            "type": "string",
            "enum": [
              "submission",
              "ack"
            ]
          },
          "storage_path": {
            "type": "string",
            "description": "S3等の保存先パス"
          },
          "is_latest": {
            "type": "boolean"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "submission_id",
          "pdf_type",
          "storage_path",
          "is_latest",
          "created_at"
        ]
      },
      "PaginatedForms": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Form"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "PaginatedResponses": {
        "type": "object",
        "properties": {
          "items": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Submission"
            }
          },
          "total": {
            "type": "integer",
            "format": "int32"
          },
          "page": {
            "type": "integer",
            "format": "int32"
          },
          "per_page": {
            "type": "integer",
            "format": "int32"
          },
          "sort": {
            "type": "string",
            "enum": [
              "created_at_desc",
              "created_at_asc"
            ]
          }
        },
        "required": [
          "items",
          "total",
          "page",
          "per_page",
          "sort"
        ]
      },
      "SortEnum": {
        "type": "string",
        "description": "一覧系 sort。既定=created_at_desc",
        "enum": [
          "created_at_desc",
          "created_at_asc"
        ]
      },
      "ProgressJob": {
        "type": "object",
        "properties": {
          "id": {
            "type": "string",
            "description": "ジョブID"
          },
          "type": {
            "type": "string",
            "description": "ジョブ種別（CSV_EXPORT/PDF_GENERATE 等）"
          },
          "status": {
            "type": "string",
            "enum": [
              "queued",
              "running",
              "succeeded",
              "failed",
              "canceled"
            ]
          },
          "percent": {
            "type": [
              "integer",
              "null"
            ],
            "minimum": 0,
            "maximum": 100,
            "description": "進捗率（不明な場合 null 可）"
          },
          "message": {
            "type": [
              "string",
              "null"
            ],
            "description": "進捗メッセージ（任意）"
          },
          "result": {
            "type": [
              "object",
              "null"
            ],
            "properties": {
              "download_url": {
                "type": [
                  "string",
                  "null"
                ],
                "description": "完了時の成果物DL URL（署名URLなど）"
              }
            }
          },
          "updated_at": {
            "type": "string",
            "format": "date-time"
          },
          "expires_at": {
            "type": [
              "string",
              "null"
            ],
            "format": "date-time",
            "description": "進捗参照期限（TTL）"
          }
        },
        "required": [
          "id",
          "type",
          "status",
          "percent",
          "message",
          "result",
          "updated_at",
          "expires_at"
        ]
      },
      "EnvelopeProgress": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeSuccess"
          },
          {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "job": {
                    "$ref": "#/components/schemas/ProgressJob"
                  }
                },
                "required": [
                  "job"
                ]
              }
            }
          }
        ]
      },
      "AdminUserUpdateRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "description": "表示名（任意）"
          },
          "status": {
            "type": "string",
            "enum": [
              "active",
              "suspended"
            ],
            "description": "ステータス（任意）"
          },
          "roles": {
            "type": "array",
            "items": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "minItems": 1,
            "maxItems": 1,
            "description": "付与ロール（現状は単一ロール運用のため要素数1固定）"
          },
          "is_root": {
            "type": "boolean",
            "description": "root-only フラグ（変更には root 権限が必要）"
          },
          "form_create_limit_enabled": {
            "type": "boolean",
            "description": "フォーム作成数制限を適用するか"
          },
          "form_create_limit": {
            "type": [
              "integer",
              "null"
            ],
            "minimum": 1,
            "description": "フォーム作成可能数（enabled=true の場合のみ有効。min=1）"
          }
        },
        "required": [
          "roles"
        ],
        "additionalProperties": false
      },
      "SearchHit": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "description": "検索対象種別",
            "enum": [
              "form",
              "response",
              "audit_log",
              "admin_user",
              "log"
            ]
          },
          "id": {
            "type": "string",
            "description": "対象ID"
          },
          "title": {
            "type": "string",
            "description": "表示タイトル"
          },
          "snippet": {
            "type": [
              "string",
              "null"
            ],
            "description": "抜粋"
          },
          "url": {
            "type": [
              "string",
              "null"
            ],
            "description": "遷移先（UI側で組み立てる場合はnull）"
          }
        },
        "required": [
          "type",
          "id",
          "title",
          "snippet",
          "url"
        ]
      },
      "EnvelopeSearch": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeSuccess"
          },
          {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "hits": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/SearchHit"
                    }
                  },
                  "total": {
                    "type": "integer",
                    "minimum": 0
                  }
                },
                "required": [
                  "hits",
                  "total"
                ]
              }
            }
          }
        ]
      },
      "AdminLogItem": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer"
          },
          "level": {
            "type": "string",
            "enum": [
              "info",
              "warn",
              "error"
            ]
          },
          "category": {
            "type": "string",
            "description": "分類（auth/audit/system/api 等）"
          },
          "message": {
            "type": "string"
          },
          "request_id": {
            "type": [
              "string",
              "null"
            ]
          },
          "endpoint": {
            "type": [
              "string",
              "null"
            ]
          },
          "reason": {
            "type": [
              "string",
              "null"
            ],
            "description": "errors.reason 等"
          },
          "created_at": {
            "type": "string",
            "format": "date-time"
          }
        },
        "required": [
          "id",
          "level",
          "category",
          "message",
          "request_id",
          "endpoint",
          "reason",
          "created_at"
        ]
      },
      "EnvelopeLogsList": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeSuccess"
          },
          {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "logs": {
                    "type": "object",
                    "properties": {
                      "items": {
                        "type": "array",
                        "items": {
                          "$ref": "#/components/schemas/AdminLogItem"
                        }
                      },
                      "total": {
                        "type": "integer",
                        "minimum": 0
                      },
                      "page": {
                        "type": "integer",
                        "minimum": 1
                      },
                      "per_page": {
                        "type": "integer",
                        "minimum": 1
                      }
                    },
                    "required": [
                      "items",
                      "total",
                      "page",
                      "per_page"
                    ]
                  }
                },
                "required": [
                  "logs"
                ]
              }
            }
          }
        ]
      },
      "EnvelopeLogDetail": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeSuccess"
          },
          {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "log": {
                    "$ref": "#/components/schemas/AdminLogItem"
                  }
                },
                "required": [
                  "log"
                ]
              }
            }
          }
        ]
      },
      "PublicFormView": {
        "type": "object",
        "properties": {
          "form_key": {
            "type": "string"
          },
          "title": {
            "type": "string"
          },
          "description": {
            "type": [
              "string",
              "null"
            ]
          },
          "fields": {
            "type": "array",
            "items": {
              "type": "object"
            }
          },
          "condition_state": {
            "$ref": "#/components/schemas/ConditionState"
          }
        },
        "required": [
          "form_key",
          "title",
          "description",
          "fields",
          "condition_state"
        ]
      },
      "EnvelopePublicFormView": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeSuccess"
          },
          {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "form": {
                    "$ref": "#/components/schemas/PublicFormView"
                  }
                },
                "required": [
                  "form"
                ]
              }
            }
          }
        ]
      },
      "ResponsesCsvExportRequest": {
        "type": "object",
        "properties": {
          "q": {
            "type": [
              "string",
              "null"
            ],
            "description": "検索キーワード（任意）"
          },
          "status": {
            "type": [
              "string",
              "null"
            ],
            "enum": [
              "active",
              "suspended"
            ],
            "description": "（任意）"
          },
          "date_from": {
            "type": [
              "string",
              "null"
            ],
            "format": "date",
            "description": "開始日（任意）"
          },
          "date_to": {
            "type": [
              "string",
              "null"
            ],
            "format": "date",
            "description": "終了日（任意）"
          }
        },
        "additionalProperties": false
      },
      "EnvelopeJobAccepted": {
        "allOf": [
          {
            "$ref": "#/components/schemas/EnvelopeSuccess"
          },
          {
            "type": "object",
            "properties": {
              "data": {
                "type": "object",
                "properties": {
                  "job_id": {
                    "type": "string"
                  },
                  "progress_url": {
                    "type": "string",
                    "description": "GET /v1/progress/{job_id}"
                  },
                  "download_url": {
                    "type": [
                      "string",
                      "null"
                    ],
                    "description": "完了後に利用できるDL URL（必要なら）"
                  }
                },
                "required": [
                  "job_id",
                  "progress_url",
                  "download_url"
                ]
              }
            }
          }
        ]
      }
    },
    "responses": {
      "Unauthorized": {
        "description": "401 Unauthorized",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "Forbidden": {
        "description": "403 Forbidden",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      },
      "ValidationError": {
        "description": "422 Validation Error",
        "content": {
          "application/json": {
            "schema": {
              "$ref": "#/components/schemas/EnvelopeError"
            }
          }
        }
      }
    },
    "examples": {
      "ForbiddenRootOnly": {
        "summary": "root-only により拒否",
        "value": {
          "success": false,
          "data": null,
          "message": "Forbidden.",
          "errors": {
            "reason": "ROOT_ONLY"
          },
          "code": "FORBIDDEN",
          "request_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        }
      },
      "ForbiddenSystemAdminRequired": {
        "summary": "system_admin 必須により拒否",
        "value": {
          "success": false,
          "data": null,
          "message": "Forbidden.",
          "errors": {
            "reason": "SYSTEM_ADMIN_REQUIRED"
          },
          "code": "FORBIDDEN",
          "request_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        }
      }
    }
  },
  "paths": {
    "/v1/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログイン",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "token": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "token方式の場合に返却（Sanctum SPAの場合null）"
                        },
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "password": {
                    "type": "string"
                  },
                  "remember": {
                    "type": "boolean"
                  }
                },
                "required": [
                  "email",
                  "password"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/auth/logout": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "ログアウト",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logged_out": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "logged_out"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/auth/me": {
      "get": {
        "tags": [
          "Auth"
        ],
        "summary": "自分自身の情報",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/forms": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "forms": {
                          "$ref": "#/components/schemas/PaginatedForms"
                        }
                      },
                      "required": [
                        "forms"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "draft",
                "published",
                "closed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（部分一致）"
            },
            "required": false
          }
        ]
      },
      "post": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム作成",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "code": {
                    "type": "string",
                    "description": "フォーム識別子",
                    "example": "CONTACT_2026"
                  },
                  "is_public": {
                    "type": "boolean",
                    "example": false
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    },
                    "description": "多言語（初期）"
                  }
                },
                "required": [
                  "code"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{id}": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        },
                        "translations": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormTranslation"
                          }
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "form": {
                          "$ref": "#/components/schemas/Form"
                        }
                      },
                      "required": [
                        "form"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "status": {
                    "type": "string",
                    "enum": [
                      "draft",
                      "published",
                      "closed"
                    ]
                  },
                  "is_public": {
                    "type": "boolean"
                  },
                  "translations": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormTranslation"
                    }
                  }
                }
              }
            }
          }
        }
      },
      "delete": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム削除（論理）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "deleted": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "deleted"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{id}/fields": {
      "get": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "include_rules",
            "in": "query",
            "schema": {
              "type": "boolean",
              "description": "visibility/required rules を含める"
            },
            "required": false
          }
        ]
      },
      "put": {
        "tags": [
          "Forms"
        ],
        "summary": "フォーム項目一括更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "fields": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/FormField"
                          }
                        }
                      },
                      "required": [
                        "fields"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "fields": {
                    "type": "array",
                    "items": {
                      "$ref": "#/components/schemas/FormField"
                    }
                  }
                },
                "required": [
                  "fields"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/responses": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信一覧（Responses）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "responses": {
                          "$ref": "#/components/schemas/PaginatedResponses"
                        }
                      },
                      "required": [
                        "responses"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "form_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "received",
                "confirmed"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（メール/氏名など：A-02検索マトリクスに委譲）"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}": {
      "get": {
        "tags": [
          "Responses"
        ],
        "summary": "送信詳細",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "response": {
                          "$ref": "#/components/schemas/Submission"
                        },
                        "values": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionValue"
                          }
                        },
                        "notifications": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/Notification"
                          }
                        },
                        "pdfs": {
                          "type": "array",
                          "items": {
                            "$ref": "#/components/schemas/SubmissionPdf"
                          }
                        }
                      },
                      "required": [
                        "response",
                        "values"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ]
      }
    },
    "/v1/forms/{form_key}/submit": {
      "post": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "公開 submit",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "submission_id": {
                          "type": "integer",
                          "format": "int64"
                        },
                        "ack_url": {
                          "type": "string",
                          "description": "ACK URL（UI遷移用）"
                        },
                        "condition_state": {
                          "$ref": "#/components/schemas/ConditionState"
                        }
                      },
                      "required": [
                        "submission_id",
                        "ack_url"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "answers": {
                    "type": "object",
                    "additionalProperties": {
                      "oneOf": [
                        {
                          "type": "string"
                        },
                        {
                          "type": "number"
                        },
                        {
                          "type": "boolean"
                        },
                        {
                          "type": "object"
                        },
                        {
                          "type": "array"
                        },
                        {
                          "type": "null"
                        }
                      ]
                    }
                  },
                  "locale": {
                    "type": "string",
                    "enum": [
                      "ja",
                      "en"
                    ]
                  },
                  "mode": {
                    "type": "string",
                    "description": "both/value/label (CSV等の表現に委譲)",
                    "enum": [
                      "both",
                      "value",
                      "label"
                    ]
                  }
                },
                "required": [
                  "answers"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/forms/{form_key}/ack": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "ACK 表示",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "ack": {
                          "type": "object",
                          "description": "ACK 表示データ（テンプレ/変数はA-04に委譲）"
                        },
                        "pdf_url": {
                          "type": [
                            "string",
                            "null"
                          ],
                          "description": "PDFダウンロードURL（許可される場合）"
                        }
                      },
                      "required": [
                        "ack"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          }
        },
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "schema": {
              "type": "string"
            },
            "required": true
          },
          {
            "name": "token",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "confirm_url token"
            },
            "required": false
          },
          {
            "name": "submission_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/responses/{id}/pdf": {
      "get": {
        "tags": [
          "ACK/PDF"
        ],
        "summary": "PDF 取得（管理側）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/pdf": {
                "schema": {
                  "type": "string",
                  "format": "binary"
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          },
          {
            "name": "pdf_type",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "submission",
                "ack"
              ]
            },
            "required": false
          }
        ]
      }
    },
    "/v1/dashboard/summary": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード集計",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "summary": {
                          "type": "object",
                          "properties": {
                            "forms_count": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_today": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "responses_total": {
                              "type": "integer",
                              "format": "int32"
                            }
                          },
                          "required": [
                            "forms_count",
                            "responses_today",
                            "responses_total"
                          ]
                        }
                      },
                      "required": [
                        "summary"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/dashboard/errors": {
      "get": {
        "tags": [
          "Dashboard"
        ],
        "summary": "ダッシュボード（エラー/失敗一覧）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "errors": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "kind": {
                                    "type": "string",
                                    "enum": [
                                      "mail_failed",
                                      "slack_failed",
                                      "pdf_failed",
                                      "eval_error",
                                      "other"
                                    ]
                                  },
                                  "message": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "kind",
                                  "message",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "errors"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/admin-users": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "users": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "$ref": "#/components/schemas/User"
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "users"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "role",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "SYSTEM_ADMIN",
                "FORM_ADMIN",
                "LOG_ADMIN"
              ]
            },
            "required": false
          },
          {
            "name": "status",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "active",
                "suspended"
              ]
            },
            "required": false
          },
          {
            "name": "q",
            "in": "query",
            "schema": {
              "type": "string",
              "description": "検索（email/name）"
            },
            "required": false
          }
        ],
        "description": "- 返却の正本ロールは `roles[]`。\n- `role` は互換のための deprecated フィールド（将来削除予定）。"
      },
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ作成（招待）",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "201": {
            "description": "Created",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "email": {
                    "type": "string",
                    "format": "email"
                  },
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "string",
                      "enum": [
                        "SYSTEM_ADMIN",
                        "FORM_ADMIN",
                        "LOG_ADMIN"
                      ]
                    }
                  }
                },
                "required": [
                  "name",
                  "email",
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-users/{id}": {
      "put": {
        "tags": [
          "System Admin"
        ],
        "summary": "管理者ユーザ更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "user": {
                          "$ref": "#/components/schemas/User"
                        }
                      },
                      "required": [
                        "user"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                },
                "examples": {
                  "ROOT_ONLY": {
                    "$ref": "#/components/examples/ForbiddenRootOnly"
                  },
                  "SYSTEM_ADMIN_REQUIRED": {
                    "$ref": "#/components/examples/ForbiddenSystemAdminRequired"
                  }
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": true
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/AdminUserUpdateRequest"
              }
            }
          }
        },
        "description": "### RBAC\n- 必須: system_admin\n- **system_admin 付与（昇格）**は root-only（is_root=true 必須）\n- system_admin 剥奪（降格）は system_admin で可（ただし自己降格禁止・最後の system_admin 禁止）\n\n- `roles` は現状単一ロール運用（要素数1）\n- `is_root` 変更は root 権限が必要"
      },
      "get": {
        "tags": [
          "system-admin-users"
        ],
        "summary": "管理者アカウント詳細取得",
        "description": "S-03 アカウント詳細/編集用。返却ロールは roles[] が正本。role は返さない。",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "allOf": [
                    {
                      "$ref": "#/components/schemas/EnvelopeSuccess"
                    },
                    {
                      "type": "object",
                      "properties": {
                        "data": {
                          "type": "object",
                          "properties": {
                            "user": {
                              "$ref": "#/components/schemas/User"
                            }
                          },
                          "required": [
                            "user"
                          ]
                        }
                      }
                    }
                  ]
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/system/admin-users/invites/resend": {
      "post": {
        "tags": [
          "System Admin"
        ],
        "summary": "招待再送",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "sent": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "sent"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "user_id": {
                    "type": "integer",
                    "format": "int64"
                  }
                },
                "required": [
                  "user_id"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/admin-audit-logs": {
      "get": {
        "tags": [
          "System Admin"
        ],
        "summary": "監査ログ一覧",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "logs": {
                          "type": "object",
                          "properties": {
                            "items": {
                              "type": "array",
                              "items": {
                                "type": "object",
                                "properties": {
                                  "id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "actor_user_id": {
                                    "type": "integer",
                                    "format": "int64"
                                  },
                                  "action": {
                                    "type": "string"
                                  },
                                  "target_type": {
                                    "type": "string"
                                  },
                                  "target_id": {
                                    "type": "string"
                                  },
                                  "created_at": {
                                    "type": "string",
                                    "format": "date-time"
                                  }
                                },
                                "required": [
                                  "id",
                                  "actor_user_id",
                                  "action",
                                  "created_at"
                                ]
                              }
                            },
                            "total": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "per_page": {
                              "type": "integer",
                              "format": "int32"
                            },
                            "sort": {
                              "type": "string",
                              "enum": [
                                "created_at_desc",
                                "created_at_asc"
                              ]
                            }
                          },
                          "required": [
                            "items",
                            "total",
                            "page",
                            "per_page",
                            "sort"
                          ]
                        }
                      },
                      "required": [
                        "logs"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1
            },
            "required": true
          },
          {
            "name": "per_page",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int32",
              "minimum": 1,
              "maximum": 200
            },
            "required": true
          },
          {
            "name": "sort",
            "in": "query",
            "schema": {
              "$ref": "#/components/schemas/SortEnum"
            },
            "required": false
          },
          {
            "name": "user_id",
            "in": "query",
            "schema": {
              "type": "integer",
              "format": "int64"
            },
            "required": false
          },
          {
            "name": "action",
            "in": "query",
            "schema": {
              "type": "string"
            },
            "required": false
          }
        ]
      }
    },
    "/v1/system/roles/permissions": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "roles": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "role": {
                                "type": "string"
                              },
                              "permissions": {
                                "type": "array",
                                "items": {
                                  "type": "string"
                                }
                              }
                            },
                            "required": [
                              "role",
                              "permissions"
                            ]
                          }
                        }
                      },
                      "required": [
                        "roles"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "ロール権限定義更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "updated": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "updated"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "roles": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "role": {
                          "type": "string"
                        },
                        "permissions": {
                          "type": "array",
                          "items": {
                            "type": "string"
                          }
                        }
                      },
                      "required": [
                        "role",
                        "permissions"
                      ]
                    }
                  }
                },
                "required": [
                  "roles"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/settings": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定取得",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      },
      "put": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "システム設定更新",
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "settings": {
                          "type": "object"
                        }
                      },
                      "required": [
                        "settings"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "message",
                    "errors"
                  ]
                }
              }
            }
          },
          "401": {
            "description": "401 Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "422 Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "settings": {
                    "type": "object"
                  }
                },
                "required": [
                  "settings"
                ]
              }
            }
          }
        }
      }
    },
    "/v1/system/root-only/ping": {
      "get": {
        "tags": [
          "SUP (root-only)"
        ],
        "summary": "root-only 動作確認（ping）",
        "description": "root-only ミドルウェア動作確認用。system_admin を満たした上で is_root=true の場合のみ成功。",
        "security": [
          {
            "bearerAuth": []
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "pong": {
                          "type": "boolean"
                        }
                      },
                      "required": [
                        "pong"
                      ]
                    },
                    "message": {
                      "type": [
                        "string",
                        "null"
                      ]
                    },
                    "errors": {
                      "type": [
                        "object",
                        "null"
                      ]
                    },
                    "code": {
                      "type": "string",
                      "example": "OK"
                    },
                    "request_id": {
                      "type": "string"
                    }
                  },
                  "required": [
                    "success",
                    "data",
                    "code",
                    "request_id"
                  ]
                },
                "examples": {
                  "OK": {
                    "summary": "成功",
                    "value": {
                      "success": true,
                      "data": {
                        "pong": true
                      },
                      "message": null,
                      "errors": null,
                      "code": "OK",
                      "request_id": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
                    }
                  }
                }
              }
            }
          },
          "401": {
            "$ref": "#/components/responses/Unauthorized"
          },
          "403": {
            "description": "403 Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                },
                "examples": {
                  "ROOT_ONLY": {
                    "$ref": "#/components/examples/ForbiddenRootOnly"
                  },
                  "SYSTEM_ADMIN_REQUIRED": {
                    "$ref": "#/components/examples/ForbiddenSystemAdminRequired"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/v1/progress/{job_id}": {
      "get": {
        "tags": [
          "progress"
        ],
        "summary": "進捗取得",
        "description": "CSV/PDF/ファイル操作等の進捗を取得する。",
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeProgress"
                }
              }
            }
          },
          "404": {
            "description": "Not Found / expired",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/search": {
      "get": {
        "tags": [
          "search"
        ],
        "summary": "横断検索",
        "description": "フォーム/回答/監査ログ/アカウント等を横断検索する（S-06）。",
        "parameters": [
          {
            "name": "q",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "minLength": 1
            }
          },
          {
            "name": "types",
            "in": "query",
            "required": false,
            "schema": {
              "type": "array",
              "items": {
                "type": "string",
                "enum": [
                  "form",
                  "response",
                  "audit_log",
                  "admin_user",
                  "log"
                ]
              }
            }
          },
          {
            "name": "page",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 200
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeSearch"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/logs": {
      "get": {
        "tags": [
          "logs"
        ],
        "summary": "ログ一覧",
        "description": "L-01 ログ一覧。",
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          },
          {
            "name": "per_page",
            "in": "query",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 200
            }
          },
          {
            "name": "level",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "info",
                "warn",
                "error"
              ]
            }
          },
          {
            "name": "q",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "date_from",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          },
          {
            "name": "date_to",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "format": "date"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeLogsList"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/logs/{id}": {
      "get": {
        "tags": [
          "logs"
        ],
        "summary": "ログ詳細",
        "description": "L-02 ログ詳細。",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "minimum": 1
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeLogDetail"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/public/forms/{form_key}": {
      "get": {
        "tags": [
          "public-forms"
        ],
        "summary": "公開フォーム表示取得",
        "description": "Respondent 用フォーム表示（/f/{form_key}）。条件分岐がある場合は condition_state を返す。",
        "parameters": [
          {
            "name": "form_key",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopePublicFormView"
                }
              }
            }
          },
          "404": {
            "description": "Not Found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        }
      }
    },
    "/v1/responses/export/csv": {
      "post": {
        "tags": [
          "responses"
        ],
        "summary": "回答CSVエクスポート（ジョブ開始）",
        "description": "回答一覧のCSVエクスポートを非同期ジョブとして開始し、job_id を返す。",
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ResponsesCsvExportRequest"
              }
            }
          }
        },
        "responses": {
          "202": {
            "description": "Accepted",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeJobAccepted"
                }
              }
            }
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "422": {
            "description": "Validation Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "500": {
            "description": "Server Error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    },
    "/v1/exports/{job_id}/download": {
      "get": {
        "tags": [
          "exports"
        ],
        "summary": "成果物ダウンロード",
        "description": "エクスポート成果物のダウンロード。URL期限切れ時は再署名（settings に依存）。",
        "parameters": [
          {
            "name": "job_id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "302": {
            "description": "Redirect to signed download URL"
          },
          "401": {
            "description": "Unauthorized",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          },
          "404": {
            "description": "Not Found / expired",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/EnvelopeError"
                }
              }
            }
          }
        },
        "security": [
          {
            "bearerAuth": []
          }
        ]
      }
    }
  },
  "x-generated-at": "2026-01-14T10:29:08Z"
}
```

## API-0024 reforma-api-spec-v1.3.0

- component_version: `v1.3.0`
- component_file: `classified/api/reforma-api-spec-v1.3.0.json`
- source_files: `latest/api/reforma-api-spec-v1.3.0.yaml`

openapi: 3.0.3
info:
  title: ReForma API v1.1 OpenAPI（起草：7.1/7.2/7.3/7.4/7.7/7.8） (v1.3.0)
  version: 1.3.0
  description: API仕様書のカテゴリ一覧（v1.1統合版）＋DB仕様（v1.1統合版）＋条件分岐I/F（ConditionState）を用いて OpenAPI
    を“実装可能な粒度”まで増補した草案。
servers:
- url: /reforma/api
tags:
- name: Auth
- name: Forms
- name: Responses
- name: ACK/PDF
- name: Dashboard
- name: System Admin
- name: SUP (root-only)
- name: progress
  description: 進捗取得
- name: search
  description: 横断検索
- name: logs
  description: ログ
- name: public-forms
  description: 公開フォーム
- name: system-admin-users
  description: 管理者ユーザ
- name: exports
  description: 成果物
- name: responses
  description: 回答
components:
  securitySchemes:
    sanctum:
      type: apiKey
      in: cookie
      name: XSRF-TOKEN
      description: Sanctum SPA session（例）。実装により Bearer 併用可
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: Token
  schemas:
    EnvelopeSuccess:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: object
        message:
          type:
          - string
          - 'null'
        errors:
          type:
          - object
          - 'null'
        code:
          type: string
          description: API共通コード（成功時はOK等）
          example: OK
        request_id:
          type: string
          description: リクエストID（追跡用）
          example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
      required:
      - success
      - code
      - request_id
      - message
      - data
      - errors
    EnvelopeError:
      type: object
      properties:
        success:
          type: boolean
        data:
          type: 'null'
        message:
          type:
          - string
          - 'null'
        errors:
          type: object
          properties:
            fields:
              type: object
              additionalProperties:
                type: array
                items:
                  type: string
                description: エラーメッセージ配列
            rule:
              type:
              - object
              - 'null'
            step:
              type:
              - object
              - 'null'
            reason:
              type: string
              description: '失敗理由（機械判定用）。例: ROOT_ONLY / EXPIRED / URL_EXPIRED / SYSTEM_ADMIN_REQUIRED
                / TOKEN_EXPIRED'
              example: ROOT_ONLY
          required: []
          description: errors 本体（用途に応じて fields/rule/step を利用）
        code:
          type: string
          description: 'API共通コード（例: FORBIDDEN / CONSTRAINT_VIOLATION / VALIDATION_ERROR
            等）'
          example: FORBIDDEN
        request_id:
          type: string
          description: リクエストID（追跡用）
          example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
      required:
      - success
      - code
      - request_id
      - message
      - data
      - errors
    ErrorObject:
      type: object
      properties:
        code:
          type: string
          description: エラーコード
        fields:
          type: object
          additionalProperties:
            type: array
            items:
              type: string
            description: エラーメッセージ配列
        rule:
          type:
          - object
          - 'null'
        step:
          type:
          - object
          - 'null'
        reason:
          type: string
          description: 失敗理由（機械判定用）
          example: ROOT_ONLY
      required:
      - code
      description: errors 本体（用途に応じて fields/rule/step を利用）
    User:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: users.id
        name:
          type: string
          description: 表示名
        email:
          type: string
          description: メールアドレス
          format: email
        status:
          type: string
          description: active / suspended
          enum:
          - active
          - suspended
        roles:
          type: array
          items:
            type: string
            enum:
            - SYSTEM_ADMIN
            - FORM_ADMIN
            - LOG_ADMIN
          description: 付与ロール
        is_root:
          type: boolean
          description: root-only 判定フラグ（/auth/me 正本）
        form_create_limit_enabled:
          type: boolean
          description: フォーム作成数制限を適用するか
        form_create_limit:
          type:
          - integer
          - 'null'
          description: フォーム作成可能数（enabled=true の場合のみ有効。min=1）
          minimum: 1
        role:
          type:
          - string
          - 'null'
          deprecated: true
          description: (deprecated) 互換のため残置。正本は roles[]。将来削除予定。
          enum:
          - SYSTEM_ADMIN
          - FORM_ADMIN
          - LOG_ADMIN
          - system_admin
          - form_admin
          - log_admin
      required:
      - id
      - name
      - email
      - status
      - roles
      - is_root
      - form_create_limit_enabled
      - form_create_limit
    Form:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: forms.id
        code:
          type: string
          description: forms.code（フォーム識別子）
        status:
          type: string
          description: forms.status
          enum:
          - draft
          - published
          - closed
        is_public:
          type: boolean
          description: forms.is_public
        created_by:
          type: integer
          format: int64
          description: forms.created_by
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - code
      - status
      - is_public
      - created_by
      - created_at
      - updated_at
    FormTranslation:
      type: object
      properties:
        id:
          type: integer
          format: int64
        form_id:
          type: integer
          format: int64
        locale:
          type: string
          enum:
          - ja
          - en
        title:
          type: string
          description: フォーム名
        description:
          type: string
          description: 説明
          example: ''
      required:
      - id
      - form_id
      - locale
      - title
    FormField:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: form_fields.id
        form_id:
          type: integer
          format: int64
          description: form_fields.form_id
        field_key:
          type: string
          description: form_fields.field_key
        type:
          type: string
          description: form_fields.type（input種別）
        sort_order:
          type: integer
          format: int32
          description: form_fields.sort_order
        is_required:
          type: boolean
          description: form_fields.is_required（固定必須）
        options_json:
          type:
          - object
          - 'null'
          description: 選択肢など（JSON）
        visibility_rule:
          type:
          - object
          - 'null'
          description: A-06 visibility_rule(JSON)
        required_rule:
          type:
          - object
          - 'null'
          description: A-06 required_rule(JSON)
        step_transition_rule:
          type:
          - object
          - 'null'
          description: A-06 step_transition_rule(JSON)
      required:
      - id
      - form_id
      - field_key
      - type
      - sort_order
      - is_required
    ConditionState:
      type: object
      properties:
        version:
          type: string
          enum:
          - '1'
        evaluated_at:
          type: string
          format: date-time
        fields:
          type: object
          additionalProperties:
            type: object
            properties:
              visible:
                type: boolean
              required:
                type: boolean
              store:
                type: string
                enum:
                - store
                - do_not_store
              eval:
                type: string
                enum:
                - ok
                - fallback
                - error
              reasons:
                type: array
                items:
                  type: object
                  properties:
                    kind:
                      type: string
                      enum:
                      - rule
                      - type
                      - missing_field
                      - unknown_operator
                    path:
                      type: string
                    message:
                      type: string
                description: 任意（デバッグ用途）
            required:
            - visible
            - required
            - store
            - eval
        step:
          type:
          - object
          - 'null'
          description: STEP遷移状態（STEPモードで利用）
      required:
      - version
      - evaluated_at
      - fields
      description: 条件分岐評価結果（API→UI I/F）
    Submission:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submissions.id
        form_id:
          type: integer
          format: int64
          description: submissions.form_id
        status:
          type: string
          description: submissions.status
          enum:
          - received
          - confirmed
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
      required:
      - id
      - form_id
      - status
      - created_at
      - updated_at
    SubmissionValue:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: submission_values.id
        submission_id:
          type: integer
          format: int64
          description: submission_values.submission_id
        field_key:
          type: string
          description: submission_values.field_key
        field_label_snapshot:
          type:
          - string
          - 'null'
          description: ラベルスナップショット
        value_json:
          oneOf:
          - type: string
          - type: number
          - type: boolean
          - type: object
          - type: array
          - type: 'null'
          description: 回答 value（JSON）
        label_json:
          type:
          - object
          - 'null'
          description: label スナップショット（JSON）
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - field_key
      - value_json
      - created_at
    Notification:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        channel:
          type: string
          enum:
          - mail
          - slack
        status:
          type: string
          enum:
          - queued
          - sent
          - failed
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - channel
      - status
      - created_at
    SubmissionPdf:
      type: object
      properties:
        id:
          type: integer
          format: int64
        submission_id:
          type: integer
          format: int64
        pdf_type:
          type: string
          enum:
          - submission
          - ack
        storage_path:
          type: string
          description: S3等の保存先パス
        is_latest:
          type: boolean
        created_at:
          type: string
          format: date-time
      required:
      - id
      - submission_id
      - pdf_type
      - storage_path
      - is_latest
      - created_at
    PaginatedForms:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Form'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum:
          - created_at_desc
          - created_at_asc
      required:
      - items
      - total
      - page
      - per_page
      - sort
    PaginatedResponses:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/Submission'
        total:
          type: integer
          format: int32
        page:
          type: integer
          format: int32
        per_page:
          type: integer
          format: int32
        sort:
          type: string
          enum:
          - created_at_desc
          - created_at_asc
      required:
      - items
      - total
      - page
      - per_page
      - sort
    SortEnum:
      type: string
      description: 一覧系 sort。既定=created_at_desc
      enum:
      - created_at_desc
      - created_at_asc
    ProgressJob:
      type: object
      properties:
        id:
          type: string
          description: ジョブID
        type:
          type: string
          description: ジョブ種別（CSV_EXPORT/PDF_GENERATE 等）
        status:
          type: string
          enum:
          - queued
          - running
          - succeeded
          - failed
          - canceled
        percent:
          type:
          - integer
          - 'null'
          minimum: 0
          maximum: 100
          description: 進捗率（不明な場合 null 可）
        message:
          type:
          - string
          - 'null'
          description: 進捗メッセージ（任意）
        result:
          type:
          - object
          - 'null'
          properties:
            download_url:
              type:
              - string
              - 'null'
              description: 完了時の成果物DL URL（署名URLなど）
        updated_at:
          type: string
          format: date-time
        expires_at:
          type:
          - string
          - 'null'
          format: date-time
          description: 進捗参照期限（TTL）
      required:
      - id
      - type
      - status
      - percent
      - message
      - result
      - updated_at
      - expires_at
    EnvelopeProgress:
      allOf:
      - $ref: '#/components/schemas/EnvelopeSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              job:
                $ref: '#/components/schemas/ProgressJob'
            required:
            - job
    AdminUserUpdateRequest:
      type: object
      properties:
        name:
          type: string
          description: 表示名（任意）
        status:
          type: string
          enum:
          - active
          - suspended
          description: ステータス（任意）
        roles:
          type: array
          items:
            type: string
            enum:
            - SYSTEM_ADMIN
            - FORM_ADMIN
            - LOG_ADMIN
          minItems: 1
          maxItems: 1
          description: 付与ロール（現状は単一ロール運用のため要素数1固定）
        is_root:
          type: boolean
          description: root-only フラグ（変更には root 権限が必要）
        form_create_limit_enabled:
          type: boolean
          description: フォーム作成数制限を適用するか
        form_create_limit:
          type:
          - integer
          - 'null'
          minimum: 1
          description: フォーム作成可能数（enabled=true の場合のみ有効。min=1）
      required:
      - roles
      additionalProperties: false
    SearchHit:
      type: object
      properties:
        type:
          type: string
          description: 検索対象種別
          enum:
          - form
          - response
          - audit_log
          - admin_user
          - log
        id:
          type: string
          description: 対象ID
        title:
          type: string
          description: 表示タイトル
        snippet:
          type:
          - string
          - 'null'
          description: 抜粋
        url:
          type:
          - string
          - 'null'
          description: 遷移先（UI側で組み立てる場合はnull）
      required:
      - type
      - id
      - title
      - snippet
      - url
    EnvelopeSearch:
      allOf:
      - $ref: '#/components/schemas/EnvelopeSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              hits:
                type: array
                items:
                  $ref: '#/components/schemas/SearchHit'
              total:
                type: integer
                minimum: 0
            required:
            - hits
            - total
    AdminLogItem:
      type: object
      properties:
        id:
          type: integer
        level:
          type: string
          enum:
          - info
          - warn
          - error
        category:
          type: string
          description: 分類（auth/audit/system/api 等）
        message:
          type: string
        request_id:
          type:
          - string
          - 'null'
        endpoint:
          type:
          - string
          - 'null'
        reason:
          type:
          - string
          - 'null'
          description: errors.reason 等
        created_at:
          type: string
          format: date-time
      required:
      - id
      - level
      - category
      - message
      - request_id
      - endpoint
      - reason
      - created_at
    EnvelopeLogsList:
      allOf:
      - $ref: '#/components/schemas/EnvelopeSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              logs:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/AdminLogItem'
                  total:
                    type: integer
                    minimum: 0
                  page:
                    type: integer
                    minimum: 1
                  per_page:
                    type: integer
                    minimum: 1
                required:
                - items
                - total
                - page
                - per_page
            required:
            - logs
    EnvelopeLogDetail:
      allOf:
      - $ref: '#/components/schemas/EnvelopeSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              log:
                $ref: '#/components/schemas/AdminLogItem'
            required:
            - log
    PublicFormView:
      type: object
      properties:
        form_key:
          type: string
        title:
          type: string
        description:
          type:
          - string
          - 'null'
        fields:
          type: array
          items:
            type: object
        condition_state:
          $ref: '#/components/schemas/ConditionState'
      required:
      - form_key
      - title
      - description
      - fields
      - condition_state
    EnvelopePublicFormView:
      allOf:
      - $ref: '#/components/schemas/EnvelopeSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              form:
                $ref: '#/components/schemas/PublicFormView'
            required:
            - form
    ResponsesCsvExportRequest:
      type: object
      properties:
        q:
          type:
          - string
          - 'null'
          description: 検索キーワード（任意）
        status:
          type:
          - string
          - 'null'
          enum:
          - active
          - suspended
          description: （任意）
        date_from:
          type:
          - string
          - 'null'
          format: date
          description: 開始日（任意）
        date_to:
          type:
          - string
          - 'null'
          format: date
          description: 終了日（任意）
      additionalProperties: false
    EnvelopeJobAccepted:
      allOf:
      - $ref: '#/components/schemas/EnvelopeSuccess'
      - type: object
        properties:
          data:
            type: object
            properties:
              job_id:
                type: string
              progress_url:
                type: string
                description: GET /v1/progress/{job_id}
              download_url:
                type:
                - string
                - 'null'
                description: 完了後に利用できるDL URL（必要なら）
            required:
            - job_id
            - progress_url
            - download_url
  responses:
    Unauthorized:
      description: 401 Unauthorized
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    Forbidden:
      description: 403 Forbidden
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
    ValidationError:
      description: 422 Validation Error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/EnvelopeError'
  examples:
    ForbiddenRootOnly:
      summary: root-only により拒否
      value:
        success: false
        data: null
        message: Forbidden.
        errors:
          reason: ROOT_ONLY
        code: FORBIDDEN
        request_id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
    ForbiddenSystemAdminRequired:
      summary: system_admin 必須により拒否
      value:
        success: false
        data: null
        message: Forbidden.
        errors:
          reason: SYSTEM_ADMIN_REQUIRED
        code: FORBIDDEN
        request_id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
paths:
  /v1/auth/login:
    post:
      tags:
      - Auth
      summary: ログイン
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type:
                        - string
                        - 'null'
                        description: token方式の場合に返却（Sanctum SPAの場合null）
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
                remember:
                  type: boolean
              required:
              - email
              - password
  /v1/auth/logout:
    post:
      tags:
      - Auth
      summary: ログアウト
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logged_out:
                        type: boolean
                    required:
                    - logged_out
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/auth/me:
    get:
      tags:
      - Auth
      summary: 自分自身の情報
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/forms:
    get:
      tags:
      - Forms
      summary: フォーム一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      forms:
                        $ref: '#/components/schemas/PaginatedForms'
                    required:
                    - forms
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - draft
          - published
          - closed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（部分一致）
        required: false
    post:
      tags:
      - Forms
      summary: フォーム作成
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  description: フォーム識別子
                  example: CONTACT_2026
                is_public:
                  type: boolean
                  example: false
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
                  description: 多言語（初期）
              required:
              - code
  /v1/forms/{id}:
    get:
      tags:
      - Forms
      summary: フォーム取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                      translations:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormTranslation'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
    put:
      tags:
      - Forms
      summary: フォーム更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      form:
                        $ref: '#/components/schemas/Form'
                    required:
                    - form
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum:
                  - draft
                  - published
                  - closed
                is_public:
                  type: boolean
                translations:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormTranslation'
    delete:
      tags:
      - Forms
      summary: フォーム削除（論理）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      deleted:
                        type: boolean
                    required:
                    - deleted
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
  /v1/forms/{id}/fields:
    get:
      tags:
      - Forms
      summary: フォーム項目一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      - name: include_rules
        in: query
        schema:
          type: boolean
          description: visibility/required rules を含める
        required: false
    put:
      tags:
      - Forms
      summary: フォーム項目一括更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      fields:
                        type: array
                        items:
                          $ref: '#/components/schemas/FormField'
                    required:
                    - fields
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                fields:
                  type: array
                  items:
                    $ref: '#/components/schemas/FormField'
              required:
              - fields
  /v1/responses:
    get:
      tags:
      - Responses
      summary: 送信一覧（Responses）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      responses:
                        $ref: '#/components/schemas/PaginatedResponses'
                    required:
                    - responses
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: form_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - received
          - confirmed
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（メール/氏名など：A-02検索マトリクスに委譲）
        required: false
  /v1/responses/{id}:
    get:
      tags:
      - Responses
      summary: 送信詳細
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      response:
                        $ref: '#/components/schemas/Submission'
                      values:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionValue'
                      notifications:
                        type: array
                        items:
                          $ref: '#/components/schemas/Notification'
                      pdfs:
                        type: array
                        items:
                          $ref: '#/components/schemas/SubmissionPdf'
                    required:
                    - response
                    - values
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
  /v1/forms/{form_key}/submit:
    post:
      tags:
      - ACK/PDF
      summary: 公開 submit
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      submission_id:
                        type: integer
                        format: int64
                      ack_url:
                        type: string
                        description: ACK URL（UI遷移用）
                      condition_state:
                        $ref: '#/components/schemas/ConditionState'
                    required:
                    - submission_id
                    - ack_url
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      parameters:
      - name: form_key
        in: path
        schema:
          type: string
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                answers:
                  type: object
                  additionalProperties:
                    oneOf:
                    - type: string
                    - type: number
                    - type: boolean
                    - type: object
                    - type: array
                    - type: 'null'
                locale:
                  type: string
                  enum:
                  - ja
                  - en
                mode:
                  type: string
                  description: both/value/label (CSV等の表現に委譲)
                  enum:
                  - both
                  - value
                  - label
              required:
              - answers
  /v1/forms/{form_key}/ack:
    get:
      tags:
      - ACK/PDF
      summary: ACK 表示
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      ack:
                        type: object
                        description: ACK 表示データ（テンプレ/変数はA-04に委譲）
                      pdf_url:
                        type:
                        - string
                        - 'null'
                        description: PDFダウンロードURL（許可される場合）
                    required:
                    - ack
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
      parameters:
      - name: form_key
        in: path
        schema:
          type: string
        required: true
      - name: token
        in: query
        schema:
          type: string
          description: confirm_url token
        required: false
      - name: submission_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
  /v1/responses/{id}/pdf:
    get:
      tags:
      - ACK/PDF
      summary: PDF 取得（管理側）
      responses:
        '200':
          description: OK
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      - name: pdf_type
        in: query
        schema:
          type: string
          enum:
          - submission
          - ack
        required: false
  /v1/dashboard/summary:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード集計
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      summary:
                        type: object
                        properties:
                          forms_count:
                            type: integer
                            format: int32
                          responses_today:
                            type: integer
                            format: int32
                          responses_total:
                            type: integer
                            format: int32
                        required:
                        - forms_count
                        - responses_today
                        - responses_total
                    required:
                    - summary
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/dashboard/errors:
    get:
      tags:
      - Dashboard
      summary: ダッシュボード（エラー/失敗一覧）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      errors:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                kind:
                                  type: string
                                  enum:
                                  - mail_failed
                                  - slack_failed
                                  - pdf_failed
                                  - eval_error
                                  - other
                                message:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - kind
                              - message
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - errors
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
  /v1/system/admin-users:
    get:
      tags:
      - System Admin
      summary: 管理者ユーザ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      users:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              $ref: '#/components/schemas/User'
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - users
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: role
        in: query
        schema:
          type: string
          enum:
          - SYSTEM_ADMIN
          - FORM_ADMIN
          - LOG_ADMIN
        required: false
      - name: status
        in: query
        schema:
          type: string
          enum:
          - active
          - suspended
        required: false
      - name: q
        in: query
        schema:
          type: string
          description: 検索（email/name）
        required: false
      description: '- 返却の正本ロールは `roles[]`。

        - `role` は互換のための deprecated フィールド（将来削除予定）。'
    post:
      tags:
      - System Admin
      summary: 管理者ユーザ作成（招待）
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                  format: email
                roles:
                  type: array
                  items:
                    type: string
                    enum:
                    - SYSTEM_ADMIN
                    - FORM_ADMIN
                    - LOG_ADMIN
              required:
              - name
              - email
              - roles
  /v1/system/admin-users/{id}:
    put:
      tags:
      - System Admin
      summary: 管理者ユーザ更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                    required:
                    - user
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
              examples:
                ROOT_ONLY:
                  $ref: '#/components/examples/ForbiddenRootOnly'
                SYSTEM_ADMIN_REQUIRED:
                  $ref: '#/components/examples/ForbiddenSystemAdminRequired'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: id
        in: path
        schema:
          type: integer
          format: int64
        required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUserUpdateRequest'
      description: '### RBAC

        - 必須: system_admin

        - **system_admin 付与（昇格）**は root-only（is_root=true 必須）

        - system_admin 剥奪（降格）は system_admin で可（ただし自己降格禁止・最後の system_admin 禁止）


        - `roles` は現状単一ロール運用（要素数1）

        - `is_root` 変更は root 権限が必要'
    get:
      tags:
      - system-admin-users
      summary: 管理者アカウント詳細取得
      description: S-03 アカウント詳細/編集用。返却ロールは roles[] が正本。role は返さない。
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                allOf:
                - $ref: '#/components/schemas/EnvelopeSuccess'
                - type: object
                  properties:
                    data:
                      type: object
                      properties:
                        user:
                          $ref: '#/components/schemas/User'
                      required:
                      - user
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/system/admin-users/invites/resend:
    post:
      tags:
      - System Admin
      summary: 招待再送
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      sent:
                        type: boolean
                    required:
                    - sent
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id:
                  type: integer
                  format: int64
              required:
              - user_id
  /v1/system/admin-audit-logs:
    get:
      tags:
      - System Admin
      summary: 監査ログ一覧
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      logs:
                        type: object
                        properties:
                          items:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                  format: int64
                                actor_user_id:
                                  type: integer
                                  format: int64
                                action:
                                  type: string
                                target_type:
                                  type: string
                                target_id:
                                  type: string
                                created_at:
                                  type: string
                                  format: date-time
                              required:
                              - id
                              - actor_user_id
                              - action
                              - created_at
                          total:
                            type: integer
                            format: int32
                          page:
                            type: integer
                            format: int32
                          per_page:
                            type: integer
                            format: int32
                          sort:
                            type: string
                            enum:
                            - created_at_desc
                            - created_at_asc
                        required:
                        - items
                        - total
                        - page
                        - per_page
                        - sort
                    required:
                    - logs
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      parameters:
      - name: page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
        required: true
      - name: per_page
        in: query
        schema:
          type: integer
          format: int32
          minimum: 1
          maximum: 200
        required: true
      - name: sort
        in: query
        schema:
          $ref: '#/components/schemas/SortEnum'
        required: false
      - name: user_id
        in: query
        schema:
          type: integer
          format: int64
        required: false
      - name: action
        in: query
        schema:
          type: string
        required: false
  /v1/system/roles/permissions:
    get:
      tags:
      - SUP (root-only)
      summary: ロール権限定義取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      roles:
                        type: array
                        items:
                          type: object
                          properties:
                            role:
                              type: string
                            permissions:
                              type: array
                              items:
                                type: string
                          required:
                          - role
                          - permissions
                    required:
                    - roles
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: ロール権限定義更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      updated:
                        type: boolean
                    required:
                    - updated
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                roles:
                  type: array
                  items:
                    type: object
                    properties:
                      role:
                        type: string
                      permissions:
                        type: array
                        items:
                          type: string
                    required:
                    - role
                    - permissions
              required:
              - roles
  /v1/system/settings:
    get:
      tags:
      - SUP (root-only)
      summary: システム設定取得
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
    put:
      tags:
      - SUP (root-only)
      summary: システム設定更新
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      settings:
                        type: object
                    required:
                    - settings
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                required:
                - success
                - data
                - message
                - errors
        '401':
          description: 401 Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: 422 Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                settings:
                  type: object
              required:
              - settings
  /v1/system/root-only/ping:
    get:
      tags:
      - SUP (root-only)
      summary: root-only 動作確認（ping）
      description: root-only ミドルウェア動作確認用。system_admin を満たした上で is_root=true の場合のみ成功。
      security:
      - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      pong:
                        type: boolean
                    required:
                    - pong
                  message:
                    type:
                    - string
                    - 'null'
                  errors:
                    type:
                    - object
                    - 'null'
                  code:
                    type: string
                    example: OK
                  request_id:
                    type: string
                required:
                - success
                - data
                - code
                - request_id
              examples:
                OK:
                  summary: 成功
                  value:
                    success: true
                    data:
                      pong: true
                    message: null
                    errors: null
                    code: OK
                    request_id: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: 403 Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
              examples:
                ROOT_ONLY:
                  $ref: '#/components/examples/ForbiddenRootOnly'
                SYSTEM_ADMIN_REQUIRED:
                  $ref: '#/components/examples/ForbiddenSystemAdminRequired'
  /v1/progress/{job_id}:
    get:
      tags:
      - progress
      summary: 進捗取得
      description: CSV/PDF/ファイル操作等の進捗を取得する。
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeProgress'
        '404':
          description: Not Found / expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '500':
          description: Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/search:
    get:
      tags:
      - search
      summary: 横断検索
      description: フォーム/回答/監査ログ/アカウント等を横断検索する（S-06）。
      parameters:
      - name: q
        in: query
        required: true
        schema:
          type: string
          minLength: 1
      - name: types
        in: query
        required: false
        schema:
          type: array
          items:
            type: string
            enum:
            - form
            - response
            - audit_log
            - admin_user
            - log
      - name: page
        in: query
        required: true
        schema:
          type: integer
          minimum: 1
      - name: per_page
        in: query
        required: true
        schema:
          type: integer
          minimum: 1
          maximum: 200
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeSearch'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/logs:
    get:
      tags:
      - logs
      summary: ログ一覧
      description: L-01 ログ一覧。
      parameters:
      - name: page
        in: query
        required: true
        schema:
          type: integer
          minimum: 1
      - name: per_page
        in: query
        required: true
        schema:
          type: integer
          minimum: 1
          maximum: 200
      - name: level
        in: query
        required: false
        schema:
          type: string
          enum:
          - info
          - warn
          - error
      - name: q
        in: query
        required: false
        schema:
          type: string
      - name: date_from
        in: query
        required: false
        schema:
          type: string
          format: date
      - name: date_to
        in: query
        required: false
        schema:
          type: string
          format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeLogsList'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/logs/{id}:
    get:
      tags:
      - logs
      summary: ログ詳細
      description: L-02 ログ詳細。
      parameters:
      - name: id
        in: path
        required: true
        schema:
          type: integer
          minimum: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeLogDetail'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/public/forms/{form_key}:
    get:
      tags:
      - public-forms
      summary: 公開フォーム表示取得
      description: Respondent 用フォーム表示（/f/{form_key}）。条件分岐がある場合は condition_state を返す。
      parameters:
      - name: form_key
        in: path
        required: true
        schema:
          type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopePublicFormView'
        '404':
          description: Not Found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
  /v1/responses/export/csv:
    post:
      tags:
      - responses
      summary: 回答CSVエクスポート（ジョブ開始）
      description: 回答一覧のCSVエクスポートを非同期ジョブとして開始し、job_id を返す。
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResponsesCsvExportRequest'
      responses:
        '202':
          description: Accepted
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeJobAccepted'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '422':
          description: Validation Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '500':
          description: Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
  /v1/exports/{job_id}/download:
    get:
      tags:
      - exports
      summary: 成果物ダウンロード
      description: エクスポート成果物のダウンロード。URL期限切れ時は再署名（settings に依存）。
      parameters:
      - name: job_id
        in: path
        required: true
        schema:
          type: string
      responses:
        '302':
          description: Redirect to signed download URL
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
        '404':
          description: Not Found / expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeError'
      security:
      - bearerAuth: []
x-generated-at: '2026-01-14T10:29:08Z'


# DB仕様

## DB-0001 reforma-db-spec-v1.0.0

- component_version: `v1.0.0`
- component_file: `classified/db/reforma-db-spec-v1.0.0.json`
- source_files: `latest/db/reforma-db-spec-v1.0.0.json`

<FULL_JSON_REPLACED_IN_RUNTIME>

# Notes/その他

## OTHER-0001 reforma-notes-v1.0.0-form-feature-attachments-.with-A06.json

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-form-feature-attachments-.with-A06.json.json`

```json
{
  "meta": {
    "title": "フォーム機能別表（Attachments） v1.0",
    "version": "1.0",
    "generated_at": "2026-01-12T14:46:31.478591",
    "links": {
      "parent_spec": "フォーム機能詳細仕様書 v1.0"
    },
    "updated_at": "2026-01-12T14:59:41.882277"
  },
  "A-01_csv_column_definition": {
    "modes": [
      "value",
      "label",
      "both"
    ],
    "common_columns": [
      {
        "col_key": "submission_id",
        "label_ja": "受付ID",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.id"
      },
      {
        "col_key": "submitted_at",
        "label_ja": "受付日時",
        "type": "datetime",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.created_at"
      },
      {
        "col_key": "form_code",
        "label_ja": "フォーム識別子",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "forms.code"
      },
      {
        "col_key": "status",
        "label_ja": "ステータス",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.status"
      }
    ],
    "field_column_naming": {
      "value_or_label_mode": "f:{field_key}",
      "both_mode": {
        "value": "f:{field_key}",
        "label": "f:{field_key}__label"
      }
    },
    "type_rules": {
      "text": {
        "value": "string",
        "label": "string"
      },
      "textarea": {
        "value": "string",
        "label": "string"
      },
      "email": {
        "value": "string",
        "label": "string"
      },
      "tel": {
        "value": "string",
        "label": "string"
      },
      "number": {
        "value": "number",
        "label": "number"
      },
      "select": {
        "value": "value",
        "label": "option_label_snapshot_or_translate"
      },
      "radio": {
        "value": "value",
        "label": "option_label_snapshot_or_translate"
      },
      "checkbox": {
        "value": "join(values, delimiter)",
        "label": "join(labels, delimiter)",
        "delimiter_configurable": true
      },
      "date": {
        "value": "iso",
        "label": "iso"
      },
      "time": {
        "value": "iso",
        "label": "iso"
      },
      "datetime": {
        "value": "iso",
        "label": "iso"
      },
      "terms": {
        "value": "boolean",
        "label": "agree_or_disagree_label",
        "label_configurable": true
      },
      "file": {
        "value": "filename_or_url",
        "label": "filename_or_url",
        "depends_on_setting": true
      }
    },
    "csv_rules": {
      "delimiter_default": ",",
      "escape": "rfc4180_like",
      "utf8_bom": "configurable"
    },
    "sample_headers": {
      "form": "CONTACT_2026",
      "mode": "both",
      "csv_header": [
        "submission_id",
        "submitted_at",
        "form_code",
        "status",
        "f:name",
        "f:name__label",
        "f:email",
        "f:category",
        "f:category__label",
        "f:message"
      ],
      "sample_row": [
        "12345",
        "2026-01-12 20:15",
        "CONTACT_2026",
        "received",
        "ishida",
        "石田",
        "email@example.com",
        "inq",
        "お問い合わせ",
        "テストです"
      ]
    }
  },
  "A-02_search_rule_matrix": {
    "default_combine": "AND",
    "type_operators": [
      {
        "field_type": "text/textarea/email/tel",
        "operators": [
          "contains"
        ],
        "value_source": "submission_values.value",
        "index_hint": [
          "LIKE_now",
          "FULLTEXT_future"
        ]
      },
      {
        "field_type": "number",
        "operators": [
          "eq",
          "min",
          "max",
          "between"
        ],
        "value_source": "submission_values.value(normalized)",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "date/datetime",
        "operators": [
          "from",
          "to",
          "between"
        ],
        "value_source": "submission_values.value(iso)",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "select/radio",
        "operators": [
          "eq",
          "in"
        ],
        "value_source": "submission_values.value",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "checkbox",
        "operators": [
          "any_in(default)",
          "all_in(optional)"
        ],
        "value_source": "submission_values.value(array_or_joined)",
        "index_hint": [
          "consider_json_storage_future"
        ]
      },
      {
        "field_type": "terms",
        "operators": [
          "eq"
        ],
        "value_source": "submission_values.value(boolean)",
        "index_hint": [
          "(field_id,value)"
        ]
      }
    ],
    "checkbox_defaults": {
      "operator": "any_in",
      "all_in": "future_extension"
    }
  },
  "A-03_pdf_block_mapping": {
    "block_key_naming": {
      "field": "f:{field_key}",
      "system": [
        "sys:submitted_at",
        "sys:submission_id",
        "sys:form_code"
      ]
    },
    "mapping": [
      {
        "block_key": "sys:submitted_at",
        "source": "submissions.created_at",
        "fallback": null,
        "notes": "受付日時"
      },
      {
        "block_key": "sys:submission_id",
        "source": "submissions.id",
        "fallback": null,
        "notes": "受付ID"
      },
      {
        "block_key": "sys:form_code",
        "source": "forms.code",
        "fallback": null,
        "notes": "フォーム識別子"
      },
      {
        "block_key": "f:{field_key}",
        "source": "submission_values.value",
        "fallback": "empty",
        "notes": "型により整形"
      },
      {
        "block_key": "f:{field_key}__label",
        "source": "option_label_snapshot",
        "fallback": "translate",
        "notes": "選択系のみ"
      }
    ],
    "note": "Coordinates/fonts/layout are managed in template assets; this table defines data mapping only.",
    "sample_template_mapping": {
      "template": "contact_default_v1",
      "blocks": [
        {
          "block_key": "sys:submitted_at",
          "label": "受付日時",
          "note": "header"
        },
        {
          "block_key": "f:name__label",
          "label": "氏名",
          "note": "prefer label"
        },
        {
          "block_key": "f:email",
          "label": "メールアドレス"
        },
        {
          "block_key": "f:category__label",
          "label": "お問い合わせ種別"
        },
        {
          "block_key": "f:message",
          "label": "内容",
          "note": "multiline"
        }
      ]
    }
  },
  "A-04_notification_template_variables": {
    "rules": {
      "allowed_variables_only": true,
      "undefined_variable_behavior": "fail_and_audit_log"
    },
    "variables": [
      {
        "var": "{{form.code}}",
        "meaning": "フォーム識別子",
        "example": "CONTACT_2026"
      },
      {
        "var": "{{form.title}}",
        "meaning": "フォーム名（送信時表示言語）",
        "example": "お問い合わせ",
        "notes": "snapshot preferred"
      },
      {
        "var": "{{submission.id}}",
        "meaning": "受付ID",
        "example": "12345"
      },
      {
        "var": "{{submission.submitted_at}}",
        "meaning": "受付日時",
        "example": "2026-01-12 20:15",
        "notes": "server time"
      },
      {
        "var": "{{confirm_url.ack}}",
        "meaning": "ACK 再表示URL",
        "example": "https://..."
      },
      {
        "var": "{{confirm_url.pdf}}",
        "meaning": "PDF 閲覧URL",
        "example": "https://..."
      },
      {
        "var": "{{fields.summary}}",
        "meaning": "主要項目の抜粋",
        "example": "氏名:...",
        "notes": "form setting (future extension)"
      }
    ],
    "field_access": {
      "value": "{{field.<field_key>}}",
      "label": "{{field_label.<field_key>}}"
    },
    "sample_templates": {
      "user_ja": {
        "body": "{{form.title}} を受け付けました。\\n受付ID：{{submission.id}}\\n受付日時：{{submission.submitted_at}}\\n\\n{{fields.summary}}\\n\\n{{confirm_url.ack}}"
      }
    }
  },
  "A-05_examples": {
    "hidden_field_retention_example": {
      "scenario": "department was entered then hidden; still need to keep value",
      "approach": "configure retention exception rule for field_key=department"
    },
    "notification_resend_example": {
      "scenario": "user did not receive email; resend",
      "approach": "system_admin triggers resend; queued; audit logged"
    },
    "pdf_regeneration_example": {
      "policy": "default forbidden",
      "allowed_when": "defined operationally (e.g., wrong template)",
      "actor": "system_admin (or root when root-only configured)",
      "execution": "async with audit"
    }
  },
  "A-06_condition_branch_rules": {
    "source": "Basic Spec v1.0 Appendix D (reconstructed)",
    "applies_to": [
      "visibility_rule",
      "required_rule",
      "step_transition_rule"
    ],
    "conventions": {
      "explicit_logical_ops": true,
      "undefined_field_key": "configuration_error",
      "fallback_on_failure": [
        "hide",
        "not_required",
        "deny_transition"
      ]
    },
    "format": {
      "version": "1",
      "op": "and|or|not|comparison",
      "items": "required for and/or",
      "field": "target field_key",
      "value": "comparison value"
    },
    "operators": [
      "eq",
      "ne",
      "in",
      "contains",
      "gt",
      "gte",
      "lt",
      "lte",
      "between",
      "exists",
      "and",
      "or",
      "not"
    ],
    "examples": {
      "visibility_rule": {
        "version": "1",
        "op": "eq",
        "field": "category",
        "value": "inq"
      },
      "required_rule": {
        "version": "1",
        "op": "exists",
        "field": "company_name",
        "value": true
      },
      "step_transition_rule": {
        "version": "1",
        "op": "eq",
        "field": "terms",
        "value": true
      }
    },
    "apply": {
      "visibility_false": "hide_and_do_not_store",
      "required_false": "not_required",
      "transition_false": "deny_with_error"
    },
    "delegation": {
      "ui": "06.UI Spec",
      "api": "03.API Spec"
    }
  }
}
```

## OTHER-0002 reforma-notes-v1.0.0-form-feature-attachments-.with-samples.j

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-form-feature-attachments-.with-samples.j.json`

```json
{
  "meta": {
    "title": "フォーム機能別表（Attachments） v1.0",
    "version": "1.0",
    "generated_at": "2026-01-12T14:46:31.478591",
    "links": {
      "parent_spec": "フォーム機能詳細仕様書 v1.0"
    },
    "updated_at": "2026-01-12T14:51:45.668980"
  },
  "A-01_csv_column_definition": {
    "modes": [
      "value",
      "label",
      "both"
    ],
    "common_columns": [
      {
        "col_key": "submission_id",
        "label_ja": "受付ID",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.id"
      },
      {
        "col_key": "submitted_at",
        "label_ja": "受付日時",
        "type": "datetime",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.created_at"
      },
      {
        "col_key": "form_code",
        "label_ja": "フォーム識別子",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "forms.code"
      },
      {
        "col_key": "status",
        "label_ja": "ステータス",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.status"
      }
    ],
    "field_column_naming": {
      "value_or_label_mode": "f:{field_key}",
      "both_mode": {
        "value": "f:{field_key}",
        "label": "f:{field_key}__label"
      }
    },
    "type_rules": {
      "text": {
        "value": "string",
        "label": "string"
      },
      "textarea": {
        "value": "string",
        "label": "string"
      },
      "email": {
        "value": "string",
        "label": "string"
      },
      "tel": {
        "value": "string",
        "label": "string"
      },
      "number": {
        "value": "number",
        "label": "number"
      },
      "select": {
        "value": "value",
        "label": "option_label_snapshot_or_translate"
      },
      "radio": {
        "value": "value",
        "label": "option_label_snapshot_or_translate"
      },
      "checkbox": {
        "value": "join(values, delimiter)",
        "label": "join(labels, delimiter)",
        "delimiter_configurable": true
      },
      "date": {
        "value": "iso",
        "label": "iso"
      },
      "time": {
        "value": "iso",
        "label": "iso"
      },
      "datetime": {
        "value": "iso",
        "label": "iso"
      },
      "terms": {
        "value": "boolean",
        "label": "agree_or_disagree_label",
        "label_configurable": true
      },
      "file": {
        "value": "filename_or_url",
        "label": "filename_or_url",
        "depends_on_setting": true
      }
    },
    "csv_rules": {
      "delimiter_default": ",",
      "escape": "rfc4180_like",
      "utf8_bom": "configurable"
    },
    "sample_headers": {
      "form": "CONTACT_2026",
      "mode": "both",
      "csv_header": [
        "submission_id",
        "submitted_at",
        "form_code",
        "status",
        "f:name",
        "f:name__label",
        "f:email",
        "f:category",
        "f:category__label",
        "f:message"
      ],
      "sample_row": [
        "12345",
        "2026-01-12 20:15",
        "CONTACT_2026",
        "received",
        "ishida",
        "石田",
        "email@example.com",
        "inq",
        "お問い合わせ",
        "テストです"
      ]
    }
  },
  "A-02_search_rule_matrix": {
    "default_combine": "AND",
    "type_operators": [
      {
        "field_type": "text/textarea/email/tel",
        "operators": [
          "contains"
        ],
        "value_source": "submission_values.value",
        "index_hint": [
          "LIKE_now",
          "FULLTEXT_future"
        ]
      },
      {
        "field_type": "number",
        "operators": [
          "eq",
          "min",
          "max",
          "between"
        ],
        "value_source": "submission_values.value(normalized)",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "date/datetime",
        "operators": [
          "from",
          "to",
          "between"
        ],
        "value_source": "submission_values.value(iso)",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "select/radio",
        "operators": [
          "eq",
          "in"
        ],
        "value_source": "submission_values.value",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "checkbox",
        "operators": [
          "any_in(default)",
          "all_in(optional)"
        ],
        "value_source": "submission_values.value(array_or_joined)",
        "index_hint": [
          "consider_json_storage_future"
        ]
      },
      {
        "field_type": "terms",
        "operators": [
          "eq"
        ],
        "value_source": "submission_values.value(boolean)",
        "index_hint": [
          "(field_id,value)"
        ]
      }
    ],
    "checkbox_defaults": {
      "operator": "any_in",
      "all_in": "future_extension"
    }
  },
  "A-03_pdf_block_mapping": {
    "block_key_naming": {
      "field": "f:{field_key}",
      "system": [
        "sys:submitted_at",
        "sys:submission_id",
        "sys:form_code"
      ]
    },
    "mapping": [
      {
        "block_key": "sys:submitted_at",
        "source": "submissions.created_at",
        "fallback": null,
        "notes": "受付日時"
      },
      {
        "block_key": "sys:submission_id",
        "source": "submissions.id",
        "fallback": null,
        "notes": "受付ID"
      },
      {
        "block_key": "sys:form_code",
        "source": "forms.code",
        "fallback": null,
        "notes": "フォーム識別子"
      },
      {
        "block_key": "f:{field_key}",
        "source": "submission_values.value",
        "fallback": "empty",
        "notes": "型により整形"
      },
      {
        "block_key": "f:{field_key}__label",
        "source": "option_label_snapshot",
        "fallback": "translate",
        "notes": "選択系のみ"
      }
    ],
    "note": "Coordinates/fonts/layout are managed in template assets; this table defines data mapping only.",
    "sample_template_mapping": {
      "template": "contact_default_v1",
      "blocks": [
        {
          "block_key": "sys:submitted_at",
          "label": "受付日時",
          "note": "header"
        },
        {
          "block_key": "f:name__label",
          "label": "氏名",
          "note": "prefer label"
        },
        {
          "block_key": "f:email",
          "label": "メールアドレス"
        },
        {
          "block_key": "f:category__label",
          "label": "お問い合わせ種別"
        },
        {
          "block_key": "f:message",
          "label": "内容",
          "note": "multiline"
        }
      ]
    }
  },
  "A-04_notification_template_variables": {
    "rules": {
      "allowed_variables_only": true,
      "undefined_variable_behavior": "fail_and_audit_log"
    },
    "variables": [
      {
        "var": "{{form.code}}",
        "meaning": "フォーム識別子",
        "example": "CONTACT_2026"
      },
      {
        "var": "{{form.title}}",
        "meaning": "フォーム名（送信時表示言語）",
        "example": "お問い合わせ",
        "notes": "snapshot preferred"
      },
      {
        "var": "{{submission.id}}",
        "meaning": "受付ID",
        "example": "12345"
      },
      {
        "var": "{{submission.submitted_at}}",
        "meaning": "受付日時",
        "example": "2026-01-12 20:15",
        "notes": "server time"
      },
      {
        "var": "{{confirm_url.ack}}",
        "meaning": "ACK 再表示URL",
        "example": "https://..."
      },
      {
        "var": "{{confirm_url.pdf}}",
        "meaning": "PDF 閲覧URL",
        "example": "https://..."
      },
      {
        "var": "{{fields.summary}}",
        "meaning": "主要項目の抜粋",
        "example": "氏名:...",
        "notes": "form setting (future extension)"
      }
    ],
    "field_access": {
      "value": "{{field.<field_key>}}",
      "label": "{{field_label.<field_key>}}"
    },
    "sample_templates": {
      "user_ja": {
        "body": "{{form.title}} を受け付けました。\\n受付ID：{{submission.id}}\\n受付日時：{{submission.submitted_at}}\\n\\n{{fields.summary}}\\n\\n{{confirm_url.ack}}"
      }
    }
  },
  "A-05_examples": {
    "hidden_field_retention_example": {
      "scenario": "department was entered then hidden; still need to keep value",
      "approach": "configure retention exception rule for field_key=department"
    },
    "notification_resend_example": {
      "scenario": "user did not receive email; resend",
      "approach": "system_admin triggers resend; queued; audit logged"
    },
    "pdf_regeneration_example": {
      "policy": "default forbidden",
      "allowed_when": "defined operationally (e.g., wrong template)",
      "actor": "system_admin (or root when root-only configured)",
      "execution": "async with audit"
    }
  }
}
```

## OTHER-0003 reforma-notes-v1.0.0-impl-handoff-init-pack.json

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-impl-handoff-init-pack.json.json`

```json
{
  "meta": {
    "title": "ReForma 配布物③：実装引き継ぎ Init Pack（構造化JSON）",
    "generated_at": "2026-01-12T11:54:47.330137",
    "timezone": "Asia/Tokyo",
    "applies_to": {
      "spec_baseline": "v1.0 immutable",
      "extensions": [
        "v1.1 delta"
      ],
      "handoff": [
        "2026-01-12 backend->frontend",
        "SUP-FE latest"
      ]
    }
  },
  "priority_rule": [
    "backend-handoff-20260112",
    "sup-fe-latest",
    "extension-v1.1",
    "spec-v1.0"
  ],
  "mounting": {
    "spa_base": "/reforma/",
    "api_base": "/reforma/api/",
    "version_prefix": "/v1",
    "example": "/reforma/api/v1/auth/me",
    "no_api_double_prefix": true
  },
  "api_envelope": {
    "success": "boolean",
    "data": "any",
    "message": "string|null",
    "errors": "object|null",
    "error_extras": {
      "code": "string|null",
      "request_id": "string"
    }
  },
  "frontend_rules": {
    "session_invalid": {
      "trigger_statuses": [
        401,
        419
      ],
      "redirect": "/logout?reason=session_invalid",
      "invalidate_client_state": true
    },
    "theme": "ReForma background common",
    "debug_ui": {
      "modes": [
        "VITE_DEBUG",
        "VITE_DEBUG_UI",
        "?debug=1"
      ],
      "payload_transport": "navigate state.debugPayload"
    }
  },
  "backend_rules": {
    "auth_admin": {
      "method": "Sanctum PAT",
      "token_transport": "Authorization: Bearer <token>",
      "ttl_days_default": 30,
      "rolling_extension": {
        "enabled": true,
        "update_frequency": "once_per_day"
      },
      "expired_behavior": {
        "http_status": 401,
        "code": "TOKEN_EXPIRED"
      }
    },
    "respondent_auth": {
      "method": "session-based",
      "confirm_url_auth": "token-based is sufficient"
    }
  },
  "tokens": {
    "storage": "hash_only_in_db",
    "canonical_types": {
      "confirm_submission": {
        "ttl_hours": 24,
        "one_time": true
      },
      "ack_action": {
        "ttl_hours": 24,
        "one_time": true
      },
      "view_pdf": {
        "ttl_days": 7,
        "one_time": false,
        "one_time_configurable": true
      }
    }
  },
  "queue": {
    "driver": "database",
    "dlq": "failed_jobs",
    "retries": {
      "tries": 5,
      "backoff_seconds": [
        60,
        300,
        900
      ]
    },
    "queues_recommended": [
      "default",
      "notifications",
      "pdf"
    ],
    "async_targets": [
      "mail",
      "slack",
      "pdf_generate",
      "pdf_regenerate"
    ]
  },
  "pdf": {
    "types": [
      "submission",
      "ack"
    ],
    "storage_default": "s3",
    "storage_switchable": [
      "local"
    ],
    "regeneration_policy": {
      "source_of_truth": "submission-time snapshot",
      "default": "do not regenerate",
      "exception": "system_admin explicit action with audit log",
      "violation_http_status": 409
    }
  },
  "settings": {
    "table": "settings",
    "scope": "system",
    "initial_impl": "no UI; insert via seeder/SQL; app reads via cache",
    "schema_recommended": {
      "columns": [
        "id",
        "scope",
        "key",
        "type",
        "value_json",
        "description",
        "is_secret",
        "updated_by",
        "created_at",
        "updated_at"
      ],
      "unique": [
        "scope",
        "key"
      ]
    }
  },
  "deliverables": {
    "s02_implementation_pack": "s-02-implementation-pack.md",
    "settings_key_catalog": "settings-key-catalog.json"
  }
}
```

## OTHER-0004 reforma-notes-v1.0.0-impl-handoff-init-pack.x-root.json

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-impl-handoff-init-pack.x-root.json.json`

```json
{
  "meta": {
    "title": "ReForma 配布物③：実装引き継ぎ Init Pack（構造化JSON）",
    "generated_at": "2026-01-12T12:23:22.721798",
    "timezone": "Asia/Tokyo",
    "applies_to": {
      "spec_baseline": "v1.0 immutable",
      "extensions": [
        "v1.1 delta"
      ],
      "handoff": [
        "2026-01-12 backend->frontend",
        "SUP-FE latest"
      ]
    },
    "version": "draft-2026-01-12+root-only"
  },
  "priority_rule": [
    "backend-handoff-20260112",
    "sup-fe-latest",
    "extension-v1.1",
    "spec-v1.0"
  ],
  "mounting": {
    "spa_base": "/reforma/",
    "api_base": "/reforma/api/",
    "version_prefix": "/v1",
    "example": "/reforma/api/v1/auth/me",
    "no_api_double_prefix": true
  },
  "api_envelope": {
    "success": "boolean",
    "data": "any",
    "message": "string|null",
    "errors": "object|null",
    "error_extras": {
      "code": "string|null",
      "request_id": "string"
    }
  },
  "frontend_rules": {
    "session_invalid": {
      "trigger_statuses": [
        401,
        419
      ],
      "redirect": "/logout?reason=session_invalid",
      "invalidate_client_state": true
    },
    "theme": "ReForma background common",
    "debug_ui": {
      "modes": [
        "VITE_DEBUG",
        "VITE_DEBUG_UI",
        "?debug=1"
      ],
      "payload_transport": "navigate state.debugPayload"
    }
  },
  "backend_rules": {
    "auth_admin": {
      "method": "Sanctum PAT",
      "token_transport": "Authorization: Bearer <token>",
      "ttl_days_default": 30,
      "rolling_extension": {
        "enabled": true,
        "update_frequency": "once_per_day"
      },
      "expired_behavior": {
        "http_status": 401,
        "code": "TOKEN_EXPIRED"
      }
    },
    "respondent_auth": {
      "method": "session-based",
      "confirm_url_auth": "token-based is sufficient"
    }
  },
  "tokens": {
    "storage": "hash_only_in_db",
    "canonical_types": {
      "confirm_submission": {
        "ttl_hours": 24,
        "one_time": true
      },
      "ack_action": {
        "ttl_hours": 24,
        "one_time": true
      },
      "view_pdf": {
        "ttl_days": 7,
        "one_time": false,
        "one_time_configurable": true
      }
    }
  },
  "queue": {
    "driver": "database",
    "dlq": "failed_jobs",
    "retries": {
      "tries": 5,
      "backoff_seconds": [
        60,
        300,
        900
      ]
    },
    "queues_recommended": [
      "default",
      "notifications",
      "pdf"
    ],
    "async_targets": [
      "mail",
      "slack",
      "pdf_generate",
      "pdf_regenerate"
    ]
  },
  "pdf": {
    "types": [
      "submission",
      "ack"
    ],
    "storage_default": "s3",
    "storage_switchable": [
      "local"
    ],
    "regeneration_policy": {
      "source_of_truth": "submission-time snapshot",
      "default": "do not regenerate",
      "exception": "system_admin explicit action with audit log",
      "violation_http_status": 409
    }
  },
  "settings": {
    "table": "settings",
    "scope": "system",
    "initial_impl": "no UI; insert via seeder/SQL; app reads via cache",
    "schema_recommended": {
      "columns": [
        "id",
        "scope",
        "key",
        "type",
        "value_json",
        "description",
        "is_secret",
        "updated_by",
        "created_at",
        "updated_at"
      ],
      "unique": [
        "scope",
        "key"
      ]
    }
  },
  "deliverables": {
    "s02_implementation_pack": "s-02-implementation-pack.md",
    "settings_key_catalog": "settings-key-catalog.json"
  },
  "root_admin": {
    "model": "attribute",
    "user_attribute": "is_root",
    "invariants": [
      "Root must be system_admin",
      "Root account cannot be disabled or deleted",
      "Root flag cannot be modified via UI/API (ops/seeder/SQL only)",
      "Root cannot grant Root to others (including self)"
    ],
    "future_policy": {
      "multiple_root_allowed": true,
      "grant_method": "ops_only"
    },
    "enforcement": {
      "screen_flag": "allow_root_only",
      "api_middleware": "RootOnly (system_admin && is_root)",
      "double_defense_required": true,
      "audit_log_required": true
    }
  },
  "rbac": {
    "root_only_screens": [
      {
        "screen_id": "S-XX",
        "name": "SYSTEM_SETTINGS",
        "route": "/system/settings",
        "status": "planned"
      },
      {
        "screen_id": "S-YY",
        "name": "ROLE_PERMISSION_ASSIGN",
        "route": "/system/roles/permissions",
        "status": "planned"
      }
    ],
    "root_only_apis": [
      {
        "api": "GET:/api/v1/system/settings",
        "status": "planned"
      },
      {
        "api": "PUT:/api/v1/system/settings",
        "status": "planned"
      },
      {
        "api": "GET:/api/v1/system/roles/permissions",
        "status": "planned"
      },
      {
        "api": "PUT:/api/v1/system/roles/permissions",
        "status": "planned"
      }
    ],
    "notes": [
      "Root-only features are not expressible via permission_assignment; require users.is_root=true in addition to system_admin role.",
      "Root-only must be enforced both at screen level (allow_root_only) and API level (RootOnly middleware)."
    ]
  }
}
```

## OTHER-0005 reforma-notes-v1.0.0-root-only-policy-.json

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-root-only-policy-.json.json`

```json
{
  "schema_version": "1.0",
  "doc_type": "security_policy",
  "policy_key": "root_only",
  "version": "v1.0",
  "updated_at": "2026-01-13",
  "principles": [
    "root-only は権限構造や全体影響が極大の操作を is_root=true に限定する二重防御である",
    "UI ではなく API レベルで強制する",
    "拒否時は 403 / code=FORBIDDEN / errors.reason=ROOT_ONLY に統一する"
  ],
  "preconditions": {
    "auth": [
      "auth:sanctum",
      "abilities:admin",
      "reforma.admin_pat"
    ],
    "rbac": [
      "reforma.system_admin"
    ],
    "root_only": [
      "reforma.root_only"
    ]
  },
  "deny_response": {
    "http_status": 403,
    "code": "FORBIDDEN",
    "message": "Forbidden.",
    "errors": {
      "reason": "ROOT_ONLY"
    }
  },
  "targets": {
    "root_only_required": [
      {
        "key": "system_admin_promotion",
        "title": "system_admin 付与（昇格）",
        "rule": "target が system_admin へ昇格する場合のみ root-only 必須",
        "endpoints": [
          "PUT /v1/system/admin-users/{id}"
        ],
        "status": "implemented"
      },
      {
        "key": "root_grant_revoke",
        "title": "root 付与・剥奪（API を提供する場合）",
        "rule": "is_root の true/false 変更は root-only 必須",
        "constraints": [
          "root は必ず1人以上",
          "自己剥奪・自己降格は禁止"
        ],
        "status": "not_provided_v1"
      },
      {
        "key": "rbac_master_change",
        "title": "RBAC マスタ（roles）変更（API を提供する場合）",
        "rule": "roles の追加/削除/code変更は root-only 必須",
        "status": "not_provided_v1"
      }
    ],
    "system_admin_allowed": [
      {
        "key": "system_admin_demotion",
        "title": "system_admin 剥奪（降格）",
        "rule": "root-only は不要。ただし Phase A 制約（自己降格禁止/最後のsystem_admin禁止）は必須",
        "endpoints": [
          "PUT /v1/system/admin-users/{id}"
        ],
        "status": "implemented_with_phase_a_constraints"
      },
      {
        "key": "admin_profile_update",
        "title": "管理者の一般情報更新",
        "rule": "root-only は不要",
        "status": "allowed"
      }
    ],
    "forbidden_v1": [
      {
        "key": "roles_edit_api",
        "title": "roles の任意編集 API",
        "rule": "v1.0 では提供しない（Seeder による固定運用）"
      },
      {
        "key": "self_root_change",
        "title": "root の自己付与・自己剥奪",
        "rule": "抜け道になるため禁止"
      }
    ]
  },
  "sharing": {
    "audiences": [
      "backend",
      "frontend"
    ],
    "frontend_guidance": {
      "source_of_truth": "roles[] と is_root を用いて UI を制御する。root-only 対象操作は UI でも無効化するが、最終的には API で拒否される。",
      "deny_handling": "403 FORBIDDEN + errors.reason=ROOT_ONLY を受けたら『root 権限が必要です』を表示する"
    }
  }
}
```

## OTHER-0006 reforma-notes-v1.0.0-settings-key-catalog.json

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-settings-key-catalog.json.json`

```json
{
  "meta": {
    "title": "ReForma 配布物②：Settings Key Catalog（v1.x）",
    "version": "1.0",
    "scope_policy": "system_fixed",
    "source_priority": [
      "backend-handoff-20260112",
      "backend-canvas-export-20260112",
      "sup-fe-latest",
      "spec-v1.1-delta",
      "spec-v1.0-immutable"
    ]
  },
  "keys": [
    {
      "key": "auth.admin.pat.ttl_days",
      "type": "int",
      "default": 30,
      "scope": "system",
      "is_secret": false,
      "description": "Admin PAT の既定TTL（日）。"
    },
    {
      "key": "auth.admin.pat.rolling_extension.enabled",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "PAT ローリング延長の有効化。"
    },
    {
      "key": "auth.admin.pat.rolling_extension.update_frequency",
      "type": "string",
      "default": "once_per_day",
      "scope": "system",
      "is_secret": false,
      "description": "ローリング延長の更新頻度（確定：1日1回）。"
    },
    {
      "key": "auth.password_policy.min_length",
      "type": "int",
      "default": 8,
      "scope": "system",
      "is_secret": false,
      "description": "Admin/Respondent 共通の最小文字数（変更可）。"
    },
    {
      "key": "auth.password_policy.require.lowercase",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "小文字必須。"
    },
    {
      "key": "auth.password_policy.require.uppercase",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "大文字必須。"
    },
    {
      "key": "auth.password_policy.require.digit",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "数字必須。"
    },
    {
      "key": "auth.password_policy.require.symbol",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "記号必須。"
    },
    {
      "key": "auth.lock_policy.failures",
      "type": "int",
      "default": 3,
      "scope": "system",
      "is_secret": false,
      "description": "失敗回数でロック（変更可）。"
    },
    {
      "key": "auth.lock_policy.lock_minutes",
      "type": "int",
      "default": 15,
      "scope": "system",
      "is_secret": false,
      "description": "ロック時間（分）（変更可）。"
    },
    {
      "key": "auth.session.ttl_minutes",
      "type": "int",
      "default": null,
      "scope": "system",
      "is_secret": false,
      "description": "Admin/Respondent セッションTTL（分）。未設定ならアプリ既定。"
    },
    {
      "key": "token.ttl_hours.confirm_submission",
      "type": "int",
      "default": 24,
      "scope": "system",
      "is_secret": false,
      "description": "confirm_submission token の TTL（時間）。"
    },
    {
      "key": "token.one_time.confirm_submission",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "confirm_submission token は one-time。"
    },
    {
      "key": "token.ttl_hours.ack_action",
      "type": "int",
      "default": 24,
      "scope": "system",
      "is_secret": false,
      "description": "ack_action token の TTL（時間）。"
    },
    {
      "key": "token.one_time.ack_action",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "ack_action token は one-time。"
    },
    {
      "key": "token.ttl_days.view_pdf",
      "type": "int",
      "default": 7,
      "scope": "system",
      "is_secret": false,
      "description": "view_pdf token の TTL（日）。"
    },
    {
      "key": "token.one_time.view_pdf",
      "type": "bool",
      "default": false,
      "scope": "system",
      "is_secret": false,
      "description": "view_pdf token の one-time（既定false、変更可）。"
    },
    {
      "key": "admin_invite.ttl_hours",
      "type": "int",
      "default": 72,
      "scope": "system",
      "is_secret": false,
      "description": "管理アカウント招待 token TTL（時間）。"
    },
    {
      "key": "admin_invite.single_use",
      "type": "bool",
      "default": true,
      "scope": "system",
      "is_secret": false,
      "description": "管理アカウント招待 token は one-time。"
    },
    {
      "key": "admin_invite.rate_limit.min_interval_sec",
      "type": "int",
      "default": 60,
      "scope": "system",
      "is_secret": false,
      "description": "招待再送の最小間隔（秒）。"
    },
    {
      "key": "admin_invite.rate_limit.per_hour",
      "type": "int",
      "default": 5,
      "scope": "system",
      "is_secret": false,
      "description": "招待再送の上限（1時間）。"
    },
    {
      "key": "admin_invite.rate_limit.per_day",
      "type": "int",
      "default": 20,
      "scope": "system",
      "is_secret": false,
      "description": "招待再送の上限（1日）。"
    },
    {
      "key": "pdf.storage.driver",
      "type": "string",
      "default": "s3",
      "scope": "system",
      "is_secret": false,
      "description": "PDF 保存先の既定（s3 推奨 / local 切替可）。"
    },
    {
      "key": "pdf.regeneration.default_allowed",
      "type": "bool",
      "default": false,
      "scope": "system",
      "is_secret": false,
      "description": "PDF 再生成の既定（原則禁止）。"
    },
    {
      "key": "queue.driver",
      "type": "string",
      "default": "database",
      "scope": "system",
      "is_secret": false,
      "description": "Queue driver（確定：database）。"
    },
    {
      "key": "queue.retries.tries",
      "type": "int",
      "default": 5,
      "scope": "system",
      "is_secret": false,
      "description": "Job tries（確定：5）。"
    },
    {
      "key": "queue.retries.backoff_seconds",
      "type": "array<int>",
      "default": [
        60,
        300,
        900
      ],
      "scope": "system",
      "is_secret": false,
      "description": "Job backoff（確定：[60,300,900]）。"
    }
  ]
}
```

## OTHER-0007 A-06 条件分岐 JSON 契約

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-条件分岐-実装整理パック-.json.json`

```json
{
  "id": "a06_contract",
  "title": "A-06 条件分岐 JSON 契約",
  "blocks": [
    {
      "type": "kv",
      "items": {
        "applies_to": [
          "visibility_rule",
          "required_rule",
          "step_transition_rule"
        ],
        "operators": [
          "eq",
          "ne",
          "in",
          "contains",
          "gt",
          "gte",
          "lt",
          "lte",
          "between",
          "exists",
          "and",
          "or",
          "not"
        ],
        "fallback_on_failure": [
          "hide",
          "not_required",
          "deny_transition"
        ],
        "explicit_logical_ops": true,
        "max_nesting_v1x": 1
      }
    },
    {
      "type": "object",
      "title": "format",
      "value": {
        "version": "1",
        "op": "and|or|not|comparison",
        "items": "required for and/or",
        "field": "target field_key",
        "value": "comparison value"
      }
    },
    {
      "type": "object",
      "title": "apply",
      "value": {
        "visibility_false": "hide_and_do_not_store",
        "required_false": "not_required",
        "transition_false": "deny_with_error"
      }
    },
    {
      "type": "object",
      "title": "examples",
      "value": {
        "visibility_rule": {
          "version": "1",
          "op": "eq",
          "field": "category",
          "value": "inq"
        },
        "required_rule": {
          "version": "1",
          "op": "exists",
          "field": "company_name",
          "value": true
        },
        "step_transition_rule": {
          "version": "1",
          "op": "eq",
          "field": "terms",
          "value": true
        }
      }
    }
  ]
}
```

## OTHER-0008 API 評価フロー

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-条件分岐-実装整理パック-.json.json`

```json
{
  "id": "api_evaluation_flow",
  "title": "API 評価フロー",
  "blocks": [
    {
      "type": "list",
      "title": "responsibilities",
      "items": [
        "schema validation (rule JSON)",
        "field_key existence check",
        "type/operator/value compatibility",
        "answers normalization",
        "safe fallback on failure",
        "audit/processing logs (min PII)"
      ]
    },
    {
      "type": "list",
      "title": "apply_points",
      "items": [
        "public GET: return initial computed state",
        "step transition: re-evaluate on API (double defense)",
        "final submit: re-evaluate, finalize required/store targets"
      ]
    },
    {
      "type": "code",
      "language": "pseudo",
      "text": "入力: form_definition, answers_raw, current_step?\n(1) answers = normalize(answers_raw, form_definition)  // 型・配列・トリム等\n(2) validate_form_rules(form_definition)               // publish 時に実施が理想（実行時はキャッシュ）\n(3) visibility_map = eval_all_fields(visibility_rule, answers)\n(4) required_map   = eval_all_fields(required_rule, answers) with visibility_map gating\n(5) if step_mode:\n      can_transition = eval_step_transition(current_step.transition_rule, answers)\n(6) apply_policy:\n      - visibility=false -> hidden\n      - required=false   -> not required\n      - hidden field     -> (default) do_not_store\n(7) on submit:\n      - validate required visible fields\n      - persist snapshots for stored fields only\n      - dispatch async jobs (mail/slack/pdf) after commit (v1.1)"
    }
  ]
}
```

## OTHER-0009 エラー設計

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-条件分岐-実装整理パック-.json.json`

```json
{
  "id": "error_response_design",
  "title": "エラー設計",
  "blocks": [
    {
      "type": "kv",
      "title": "envelope",
      "items": {
        "success": "boolean",
        "data": "object|null",
        "message": "string|null",
        "errors": "object|null"
      }
    },
    {
      "type": "table",
      "title": "status_codes",
      "columns": [
        "category",
        "http",
        "code",
        "errors_shape",
        "note"
      ],
      "rows": [
        [
          "config_validation",
          422,
          "CONDITION_RULE_INVALID",
          "errors.rule / errors.items[n]",
          "save/publish blocked"
        ],
        [
          "input_validation",
          422,
          "VALIDATION_ERROR",
          "errors.fields.{field_key}",
          "visible+required only"
        ],
        [
          "step_transition_denied",
          422,
          "STEP_TRANSITION_DENIED",
          "errors.step",
          "deny_with_error"
        ],
        [
          "runtime_eval_error",
          "200 or 422",
          "CONDITION_EVAL_ERROR",
          "errors.rule(optional)",
          "safe fallback; step->422"
        ]
      ]
    },
    {
      "type": "code",
      "language": "json",
      "text": "// STEP 次へ遷移が拒否された例（422）\n{\n  \"success\": false,\n  \"data\": null,\n  \"message\": \"次へ進む条件を満たしていません。\",\n  \"errors\": {\n    \"code\": \"STEP_TRANSITION_DENIED\",\n    \"step\": {\n      \"step_key\": \"step2\",\n      \"rule\": { \"...\": \"transition_rule(JSON)\" }\n    }\n  }\n}\n\n// ルールが不正で保存できない例（422）\n{\n  \"success\": false,\n  \"data\": null,\n  \"message\": \"条件分岐ルールに誤りがあります。\",\n  \"errors\": {\n    \"code\": \"CONDITION_RULE_INVALID\",\n    \"rule\": {\n      \"path\": \"fields[3].visibility_rule.items[1].field\",\n      \"reason\": \"unknown_field_key\"\n    }\n  }\n}"
    }
  ]
}
```

## OTHER-0010 React / E2E チェック

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-条件分岐-実装整理パック-.json.json`

```json
{
  "id": "frontend_e2e",
  "title": "React / E2E チェック",
  "blocks": [
    {
      "type": "object",
      "title": "ui_builder_constraints",
      "value": {
        "max_conditions": 10,
        "max_nesting": 1
      }
    },
    {
      "type": "list",
      "title": "builder_checks",
      "items": [
        "explicit AND/OR shown",
        "max_nesting=1 enforced",
        "max_conditions=10 enforced",
        "no self reference",
        "operator filtered by field type",
        "value input UI per operator",
        "toggle off => store null/undefined"
      ]
    },
    {
      "type": "list",
      "title": "e2e_min",
      "items": [
        "E2E-01 builder save/reload JSON stable",
        "E2E-02 exclusive_with required",
        "E2E-03 nesting limit",
        "E2E-04 visibility apply",
        "E2E-05 required + 422",
        "E2E-06 step deny + 422",
        "E2E-07 invalid config => safe fallback"
      ]
    }
  ]
}
```

## OTHER-0011 reforma-notes-v1.0.0-条件分岐-評価結果IF-.json

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-条件分岐-評価結果IF-.json.json`

```json
{
  "meta": {
    "title": "ReForma 条件分岐 評価結果I/F 定義（API→UI）",
    "version": "1.0",
    "generated_at": "2026-01-12T15:50:25.108877",
    "timezone": "Asia/Tokyo",
    "depends_on": {
      "A-06": "form-feature-attachments-v1.1.json#/A-06_condition_branch_rules",
      "UI_spec": "condition-ui-spec-v1.0.json"
    }
  },
  "schemas": {
    "FieldConditionState": {
      "visible": "boolean",
      "required": "boolean",
      "store": [
        "store",
        "do_not_store"
      ],
      "eval": [
        "ok",
        "fallback",
        "error"
      ],
      "reasons": {
        "optional": true,
        "item": {
          "kind": [
            "rule",
            "type",
            "missing_field",
            "unknown_operator"
          ],
          "path": "string?",
          "message": "string?"
        }
      }
    },
    "StepTransitionState": {
      "can_transition": "boolean",
      "eval": [
        "ok",
        "fallback",
        "error"
      ],
      "message": "string?",
      "reasons": "Reason[]?"
    },
    "ConditionState": {
      "version": "1",
      "evaluated_at": "ISO8601 string",
      "fields": "map(field_key -> FieldConditionState)",
      "step": "StepTransitionState?"
    }
  },
  "where_to_return": [
    {
      "api": "public form GET",
      "path": "data.condition_state",
      "purpose": "initial render"
    },
    {
      "api": "step transition",
      "path": "success: data.condition_state / fail: errors.step",
      "purpose": "double defense"
    },
    {
      "api": "final submit",
      "path": "optional: data.condition_state (debug)",
      "purpose": "audit/diagnostic"
    }
  ],
  "examples": {
    "public_get": "// 公開フォーム GET の例（抜粋）\n{\n  \"success\": true,\n  \"data\": {\n    \"form\": { \"...\": \"...\" },\n    \"condition_state\": {\n      \"version\": \"1\",\n      \"evaluated_at\": \"2026-01-13T00:00:00+09:00\",\n      \"fields\": {\n        \"company_name\": { \"visible\": true, \"required\": true, \"store\": \"store\", \"eval\": \"ok\" },\n        \"tel\": { \"visible\": false, \"required\": false, \"store\": \"do_not_store\", \"eval\": \"ok\" }\n      }\n    }\n  }\n}",
    "step_denied": "// STEP 次へ遷移 NG（422）の例\n{\n  \"success\": false,\n  \"data\": null,\n  \"message\": \"次へ進む条件を満たしていません。\",\n  \"errors\": {\n    \"code\": \"STEP_TRANSITION_DENIED\",\n    \"step\": {\n      \"can_transition\": false,\n      \"eval\": \"ok\",\n      \"message\": \"必須項目が未入力です。\",\n      \"reasons\": [{ \"kind\":\"rule\", \"path\":\"steps[1].transition_rule\", \"message\":\"rule evaluated false\" }]\n    }\n  }\n}",
    "fallback": "// 評価不能（参照 field_key 不正）→ 安全側フォールバック例（成功レスポンス内）\n{\n  \"condition_state\": {\n    \"version\": \"1\",\n    \"evaluated_at\": \"2026-01-13T00:00:00+09:00\",\n    \"fields\": {\n      \"advanced_section\": {\n        \"visible\": false,\n        \"required\": false,\n        \"store\": \"do_not_store\",\n        \"eval\": \"fallback\",\n        \"reasons\": [{ \"kind\":\"missing_field\", \"path\":\"fields[7].visibility_rule.items[0].field\", \"message\":\"unknown_field_key\" }]\n      }\n    }\n  }\n}"
  },
  "notes": [
    "UI は reasons/eval の有無に依存しない（任意項目）。",
    "評価不能時は A-06 conventions の安全側に倒す。",
    "v1.x は max_nesting=1 をUI/API双方で強制。"
  ],
  "raw_refs": {
    "a06_conventions": {
      "explicit_logical_ops": true,
      "undefined_field_key": "configuration_error",
      "fallback_on_failure": [
        "hide",
        "not_required",
        "deny_transition"
      ]
    },
    "ui_constraints": {
      "max_conditions": 10,
      "max_nesting": 1
    }
  }
}
```

## OTHER-0012 reforma-notes-v1.0.0-追補パッチ-表示モード-テーマ-計算フィールド-.json

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0-追補パッチ-表示モード-テーマ-計算フィールド-.json.json`

```json
{
  "meta": {
    "title": "ReForma 追補パッチ（表示モード / テーマ / 計算フィールド）",
    "version": "1.0",
    "generated_at": "2026-01-13T00:55:21.047728",
    "timezone": "Asia/Tokyo",
    "patch_type": "additive",
    "applies_to": [
      "form-feature-spec-v1.0.complete.json",
      "form-feature-attachments-v1.1.json",
      "03.ReForma-api-spec-v1.1-consolidated.json",
      "04.ReForma-db-spec-v1.1-consolidated.json"
    ]
  },
  "adds": [
    {
      "id": "SUPP-DISPLAY-MODE-001",
      "area": "display_mode",
      "recommended": {
        "name": "render_only + store_snapshot",
        "summary": "保存の正は value。UI表示は label/both を切替可能。保存時に label_snapshot を保持して再現性を担保。",
        "defaults": {
          "store_canonical": "value",
          "default_render_mode": "label",
          "allow_render_modes": [
            "label",
            "both",
            "value"
          ],
          "store_label_snapshot": true,
          "snapshot_locale_policy": "submission_locale_or_form_default"
        },
        "apply_points": {
          "render": [
            "公開フォーム: 選択肢表示（label/both/value）",
            "管理画面プレビュー: locale+mode切替",
            "ACK画面: labelを既定"
          ],
          "store": [
            "submit保存: canonical=valueを保存（value_json）",
            "label_snapshot: submission_values.label_json / field_label_snapshot に保存"
          ],
          "export": [
            "CSV: mode=both/value/label をパラメータ指定（既定both）",
            "PDF/ACK: 既定label（必要ならmode指定を追加可能）",
            "検索: canonical(value) と label_snapshot の両方に対応（A-02に委譲、既定はvalue優先）"
          ]
        }
      },
      "api_contract_additions": [
        {
          "endpoint": "POST /v1/forms/{form_key}/submit",
          "add_request_fields": {
            "locale": {
              "type": "string",
              "enum": [
                "ja",
                "en"
              ],
              "optional": true
            },
            "mode": {
              "type": "string",
              "enum": [
                "both",
                "value",
                "label"
              ],
              "optional": true,
              "note": "保存の正はvalue固定。modeはACK/出力の表示方針用に限定。"
            }
          },
          "add_response_fields": {
            "condition_state": {
              "ref": "ConditionState",
              "required": false
            }
          }
        }
      ],
      "data_model_additions": [
        {
          "table": "submission_values",
          "fields": {
            "value_json": "canonical value (already planned)",
            "label_json": "label snapshot (JSON, optional)",
            "field_label_snapshot": "field label snapshot (string, optional)"
          },
          "note": "既にDB仕様のスナップショット方針がある前提。無ければ追補で追加。"
        }
      ]
    },
    {
      "id": "SUPP-THEME-001",
      "area": "theming",
      "recommended": {
        "name": "theme_tokens_only + template_pack",
        "summary": "v1.xは安全にテーマトークン（CSS変数）とプリセットテーマ選択で提供。外部CSS URLはv2候補。",
        "defaults": {
          "theme_id": "default",
          "theme_tokens_schema": {
            "color_primary": "#xxxxxx",
            "color_secondary": "#xxxxxx",
            "color_bg": "#xxxxxx",
            "color_text": "#xxxxxx",
            "radius": "0|4|8|12",
            "spacing_scale": "sm|md|lg",
            "font_family": "system|noto_sans|custom (v2)",
            "button_style": "solid|outline",
            "input_style": "standard|filled"
          },
          "csp_policy": {
            "allow_external_css": false,
            "style_src": [
              "'self'"
            ],
            "font_src": [
              "'self'"
            ],
            "img_src": [
              "'self'",
              "data:"
            ]
          }
        },
        "ui_application": [
          "公開フォーム root に data-theme-id を付与",
          "theme_tokens を CSS variables に展開（:root ではなくフォームコンテナ配下）",
          "プリセットテーマはフロントに同梱（またはAPIから取得）"
        ]
      },
      "api_contract_additions": [
        {
          "endpoint": "GET /v1/forms/{id}",
          "add_response_fields": {
            "theme_id": {
              "type": "string",
              "required": false
            },
            "theme_tokens": {
              "type": "object",
              "required": false
            }
          }
        },
        {
          "endpoint": "PUT /v1/forms/{id}",
          "add_request_fields": {
            "theme_id": {
              "type": "string",
              "optional": true
            },
            "theme_tokens": {
              "type": "object",
              "optional": true
            }
          }
        }
      ],
      "data_model_additions": [
        {
          "table": "forms",
          "fields": {
            "theme_id": "string nullable",
            "theme_tokens": "json nullable"
          }
        }
      ],
      "out_of_scope_v1x": [
        "任意の外部CSS URL指定（安全/運用のため v2で検討）",
        "任意HTML埋め込み"
      ]
    },
    {
      "id": "SUPP-COMPUTED-001",
      "area": "computed_field",
      "recommended": {
        "name": "readonly_input + built_in_functions + store_snapshot + api_recompute",
        "summary": "v1.xは計算結果をreadonlyフィールドとして表示。式は関数プリセット。送信時にAPIが再計算して確定・保存。",
        "defaults": {
          "presentation": "readonly_input",
          "persistence": "store_snapshot",
          "engine": "built_in_functions",
          "max_dependency_depth": 1,
          "cycle_detection": true,
          "on_error_policy": {
            "display": "blank",
            "required": false,
            "store": "do_not_store"
          }
        },
        "built_in_functions": [
          {
            "fn": "sum",
            "args": "refs[]"
          },
          {
            "fn": "multiply",
            "args": "ref_a, ref_b"
          },
          {
            "fn": "tax",
            "args": "ref_amount, rate"
          },
          {
            "fn": "round",
            "args": "ref_value, digits"
          },
          {
            "fn": "min",
            "args": "refs[]"
          },
          {
            "fn": "max",
            "args": "refs[]"
          },
          {
            "fn": "if",
            "args": "condition, then, else"
          }
        ]
      },
      "form_definition_additions": [
        {
          "field_type": "computed",
          "schema": {
            "type": "computed",
            "field_key": "TOTAL",
            "label": {
              "ja": "合計",
              "en": "Total"
            },
            "result_type": "number|string",
            "format": "integer|decimal|currency",
            "computed_rule": {
              "engine": "built_in_functions",
              "fn": "sum",
              "args": [
                "ref:PRICE",
                "ref:TAX"
              ],
              "fallback": {
                "on_error": "blank",
                "store": "do_not_store"
              }
            },
            "is_required": false,
            "is_readonly": true
          }
        }
      ],
      "api_behavior": [
        "公開フォームUIでも即時計算して表示してよい（UX向上）",
        "submit時はAPIで再計算し、クライアント送信値は信用しない（上書き）",
        "保存は submission_values に value_json として保存（必要なら label_json も）"
      ],
      "validation_rules": [
        "computed_field はユーザ入力を受け取らない（payloadのanswersに含まれても無視/上書き）",
        "参照先 field_key の存在・型整合・循環を RuleValidator で検証（保存/Publish時）"
      ]
    }
  ]
}
```

## OTHER-0013 reforma-notes-v1.0.0

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0.json`

```json
{
  "title": "ReForma Frontend 補足仕様（SUP-FE）【統合・最新版】",
  "scope": "frontend-backend shared",
  "versioning_policy": "v1.0 specs immutable; extensions via SUP only",
  "sections": {
    "SUP-FE-001": {
      "title": "ZIP提供時のコマンド提示テンプレ",
      "commands": [
        "cd /var/www/reforma/frontend",
        "unzip -o reforma-react-vX.Y.Z-diff.zip -d .",
        "npm install  # or npm ci if lock updated",
        "npm run build:stg  # production: build:prd"
      ]
    },
    "SUP-FE-002": {
      "title": "リリース差分ZIP作成時のメタ情報更新",
      "checks": [
        "package.json version",
        "package-lock.json version (if exists)",
        "CHANGELOG.md latest on top",
        "verify build version output"
      ]
    },
    "SUP-FE-003": {
      "title": "E-01 エラー画面 クエリ拡張",
      "error_codes": [
        "FORBIDDEN",
        "AUTH_FAILED",
        "NOT_FOUND",
        "VALIDATION_ERROR",
        "UNKNOWN"
      ]
    },
    "SUP-FE-004": {
      "title": "E-01 Debug UI",
      "debug_modes": [
        "VITE_DEBUG",
        "VITE_DEBUG_UI",
        "?debug=1"
      ],
      "payload_transport": "navigate state.debugPayload"
    },
    "SUP-FE-005": {
      "title": "ReForma テーマ背景（全ページ共通）",
      "policy": "Use v0.4.11 Not Found gradient for all pages under ReForma theme"
    },
    "SUP-FE-006": {
      "title": "アカウント管理画面 追加方針",
      "screens": [
        "S-02",
        "S-03",
        "S-04",
        "S-05"
      ],
      "access": "System Admin only"
    },
    "SUP-FE-007": {
      "title": "管理アカウント管理（招待制）",
      "invite": {
        "ttl_hours": 72,
        "single_use": true,
        "resend_policy": "new token, invalidate old",
        "rate_limit": {
          "min_interval_sec": 60,
          "per_hour": 5,
          "per_day": 20
        }
      },
      "status": [
        "invited",
        "active",
        "disabled"
      ],
      "root_admin": {
        "seeded": true,
        "immutable": [
          "disable",
          "delete"
        ]
      },
      "safety_rules": [
        "cannot disable self",
        "cannot downgrade own role from system_admin",
        "system_admin count cannot be zero"
      ],
      "password_policy": {
        "min_length": 8,
        "require": [
          "lowercase",
          "uppercase",
          "digit",
          "symbol"
        ],
        "configurable": true,
        "lock": {
          "failures": 3,
          "lock_minutes": 15,
          "configurable": true
        }
      },
      "session": {
        "ttl": "configurable"
      },
      "csv_import": {
        "mode": "A",
        "columns": [
          "email",
          "name",
          "role",
          "status",
          "note"
        ],
        "duplicate_email": "error_and_rollback",
        "result_report": true,
        "bulk_invite_ui": true
      },
      "audit_log": "admin_audit_logs"
    },
    "SUP-FE-008": {
      "title": "Respondent 管理（ハイブリッド方式）",
      "model": [
        "respondent_profiles",
        "form_respondents"
      ],
      "profile": {
        "display_name": "required",
        "email": "nullable_unique",
        "external_ref": "unique"
      },
      "form_flow": [
        "login_or_register",
        "email_verify",
        "redirect_to_form"
      ],
      "auth": {
        "session_based": true,
        "policy_shared_with_admin": true
      }
    }
  }
}
```

## OTHER-0014 reforma-notes-v1.0.0

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.0.0.md`

# ReForma 追補仕様まとめ（表示モード / テーマ / 計算フィールド）

_generated: 2026-01-13T00:55:21.047728 (Asia/Tokyo)_

## display_mode – render_only + store_snapshot

**概要**: 保存の正は value。UI表示は label/both を切替可能。保存時に label_snapshot を保持して再現性を担保。

### 推奨設定
```json

{
  "store_canonical": "value",
  "default_render_mode": "label",
  "allow_render_modes": [
    "label",
    "both",
    "value"
  ],
  "store_label_snapshot": true,
  "snapshot_locale_policy": "submission_locale_or_form_default"
}

```

## theming – theme_tokens_only + template_pack

**概要**: v1.xは安全にテーマトークン（CSS変数）とプリセットテーマ選択で提供。外部CSS URLはv2候補。

### 推奨設定
```json

{
  "theme_id": "default",
  "theme_tokens_schema": {
    "color_primary": "#xxxxxx",
    "color_secondary": "#xxxxxx",
    "color_bg": "#xxxxxx",
    "color_text": "#xxxxxx",
    "radius": "0|4|8|12",
    "spacing_scale": "sm|md|lg",
    "font_family": "system|noto_sans|custom (v2)",
    "button_style": "solid|outline",
    "input_style": "standard|filled"
  },
  "csp_policy": {
    "allow_external_css": false,
    "style_src": [
      "'self'"
    ],
    "font_src": [
      "'self'"
    ],
    "img_src": [
      "'self'",
      "data:"
    ]
  }
}

```

## computed_field – readonly_input + built_in_functions + store_snapshot + api_recompute

**概要**: v1.xは計算結果をreadonlyフィールドとして表示。式は関数プリセット。送信時にAPIが再計算して確定・保存。

### 推奨設定
```json

{
  "presentation": "readonly_input",
  "persistence": "store_snapshot",
  "engine": "built_in_functions",
  "max_dependency_depth": 1,
  "cycle_detection": true,
  "on_error_policy": {
    "display": "blank",
    "required": false,
    "store": "do_not_store"
  }
}

```

### フォーム定義追加例
```json

[
  {
    "field_type": "computed",
    "schema": {
      "type": "computed",
      "field_key": "TOTAL",
      "label": {
        "ja": "合計",
        "en": "Total"
      },
      "result_type": "number|string",
      "format": "integer|decimal|currency",
      "computed_rule": {
        "engine": "built_in_functions",
        "fn": "sum",
        "args": [
          "ref:PRICE",
          "ref:TAX"
        ],
        "fallback": {
          "on_error": "blank",
          "store": "do_not_store"
        }
      },
      "is_required": false,
      "is_readonly": true
    }
  }
]

```

### API挙動

- 公開フォームUIでも即時計算して表示してよい（UX向上）
- submit時はAPIで再計算し、クライアント送信値は信用しない（上書き）
- 保存は submission_values に value_json として保存（必要なら label_json も）



## OTHER-0015 reforma-notes-v1.1.0

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.1.0.json`

```json
{
  "meta": {
    "title": "フォーム機能別表（Attachments） v1.0",
    "version": "1.1",
    "generated_at": "2026-01-12T14:46:31.478591",
    "links": {
      "parent_spec": "フォーム機能詳細仕様書 v1.0"
    },
    "updated_at": "2026-01-12T15:12:02.560114"
  },
  "A-01_csv_column_definition": {
    "modes": [
      "value",
      "label",
      "both"
    ],
    "common_columns": [
      {
        "col_key": "submission_id",
        "label_ja": "受付ID",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.id"
      },
      {
        "col_key": "submitted_at",
        "label_ja": "受付日時",
        "type": "datetime",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.created_at"
      },
      {
        "col_key": "form_code",
        "label_ja": "フォーム識別子",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "forms.code"
      },
      {
        "col_key": "status",
        "label_ja": "ステータス",
        "type": "string",
        "modes": [
          "value",
          "label",
          "both"
        ],
        "notes": "submissions.status"
      }
    ],
    "field_column_naming": {
      "value_or_label_mode": "f:{field_key}",
      "both_mode": {
        "value": "f:{field_key}",
        "label": "f:{field_key}__label"
      }
    },
    "type_rules": {
      "text": {
        "value": "string",
        "label": "string"
      },
      "textarea": {
        "value": "string",
        "label": "string"
      },
      "email": {
        "value": "string",
        "label": "string"
      },
      "tel": {
        "value": "string",
        "label": "string"
      },
      "number": {
        "value": "number",
        "label": "number"
      },
      "select": {
        "value": "value",
        "label": "option_label_snapshot_or_translate"
      },
      "radio": {
        "value": "value",
        "label": "option_label_snapshot_or_translate"
      },
      "checkbox": {
        "value": "join(values, delimiter)",
        "label": "join(labels, delimiter)",
        "delimiter_configurable": true
      },
      "date": {
        "value": "iso",
        "label": "iso"
      },
      "time": {
        "value": "iso",
        "label": "iso"
      },
      "datetime": {
        "value": "iso",
        "label": "iso"
      },
      "terms": {
        "value": "boolean",
        "label": "agree_or_disagree_label",
        "label_configurable": true
      },
      "file": {
        "value": "filename_or_url",
        "label": "filename_or_url",
        "depends_on_setting": true
      }
    },
    "csv_rules": {
      "delimiter_default": ",",
      "escape": "rfc4180_like",
      "utf8_bom": "configurable"
    },
    "sample_headers": {
      "form": "CONTACT_2026",
      "mode": "both",
      "csv_header": [
        "submission_id",
        "submitted_at",
        "form_code",
        "status",
        "f:name",
        "f:name__label",
        "f:email",
        "f:category",
        "f:category__label",
        "f:message"
      ],
      "sample_row": [
        "12345",
        "2026-01-12 20:15",
        "CONTACT_2026",
        "received",
        "ishida",
        "石田",
        "email@example.com",
        "inq",
        "お問い合わせ",
        "テストです"
      ]
    }
  },
  "A-02_search_rule_matrix": {
    "default_combine": "AND",
    "type_operators": [
      {
        "field_type": "text/textarea/email/tel",
        "operators": [
          "contains"
        ],
        "value_source": "submission_values.value",
        "index_hint": [
          "LIKE_now",
          "FULLTEXT_future"
        ]
      },
      {
        "field_type": "number",
        "operators": [
          "eq",
          "min",
          "max",
          "between"
        ],
        "value_source": "submission_values.value(normalized)",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "date/datetime",
        "operators": [
          "from",
          "to",
          "between"
        ],
        "value_source": "submission_values.value(iso)",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "select/radio",
        "operators": [
          "eq",
          "in"
        ],
        "value_source": "submission_values.value",
        "index_hint": [
          "(field_id,value)"
        ]
      },
      {
        "field_type": "checkbox",
        "operators": [
          "any_in(default)",
          "all_in(optional)"
        ],
        "value_source": "submission_values.value(array_or_joined)",
        "index_hint": [
          "consider_json_storage_future"
        ]
      },
      {
        "field_type": "terms",
        "operators": [
          "eq"
        ],
        "value_source": "submission_values.value(boolean)",
        "index_hint": [
          "(field_id,value)"
        ]
      }
    ],
    "checkbox_defaults": {
      "operator": "any_in",
      "all_in": "future_extension"
    }
  },
  "A-03_pdf_block_mapping": {
    "block_key_naming": {
      "field": "f:{field_key}",
      "system": [
        "sys:submitted_at",
        "sys:submission_id",
        "sys:form_code"
      ]
    },
    "mapping": [
      {
        "block_key": "sys:submitted_at",
        "source": "submissions.created_at",
        "fallback": null,
        "notes": "受付日時"
      },
      {
        "block_key": "sys:submission_id",
        "source": "submissions.id",
        "fallback": null,
        "notes": "受付ID"
      },
      {
        "block_key": "sys:form_code",
        "source": "forms.code",
        "fallback": null,
        "notes": "フォーム識別子"
      },
      {
        "block_key": "f:{field_key}",
        "source": "submission_values.value",
        "fallback": "empty",
        "notes": "型により整形"
      },
      {
        "block_key": "f:{field_key}__label",
        "source": "option_label_snapshot",
        "fallback": "translate",
        "notes": "選択系のみ"
      }
    ],
    "note": "Coordinates/fonts/layout are managed in template assets; this table defines data mapping only.",
    "sample_template_mapping": {
      "template": "contact_default_v1",
      "blocks": [
        {
          "block_key": "sys:submitted_at",
          "label": "受付日時",
          "note": "header"
        },
        {
          "block_key": "f:name__label",
          "label": "氏名",
          "note": "prefer label"
        },
        {
          "block_key": "f:email",
          "label": "メールアドレス"
        },
        {
          "block_key": "f:category__label",
          "label": "お問い合わせ種別"
        },
        {
          "block_key": "f:message",
          "label": "内容",
          "note": "multiline"
        }
      ]
    }
  },
  "A-04_notification_template_variables": {
    "rules": {
      "allowed_variables_only": true,
      "undefined_variable_behavior": "fail_and_audit_log"
    },
    "variables": [
      {
        "var": "{{form.code}}",
        "meaning": "フォーム識別子",
        "example": "CONTACT_2026"
      },
      {
        "var": "{{form.title}}",
        "meaning": "フォーム名（送信時表示言語）",
        "example": "お問い合わせ",
        "notes": "snapshot preferred"
      },
      {
        "var": "{{submission.id}}",
        "meaning": "受付ID",
        "example": "12345"
      },
      {
        "var": "{{submission.submitted_at}}",
        "meaning": "受付日時",
        "example": "2026-01-12 20:15",
        "notes": "server time"
      },
      {
        "var": "{{confirm_url.ack}}",
        "meaning": "ACK 再表示URL",
        "example": "https://..."
      },
      {
        "var": "{{confirm_url.pdf}}",
        "meaning": "PDF 閲覧URL",
        "example": "https://..."
      },
      {
        "var": "{{fields.summary}}",
        "meaning": "主要項目の抜粋",
        "example": "氏名:...",
        "notes": "form setting (future extension)"
      }
    ],
    "field_access": {
      "value": "{{field.<field_key>}}",
      "label": "{{field_label.<field_key>}}"
    },
    "sample_templates": {
      "user_ja": {
        "body": "{{form.title}} を受け付けました。\\n受付ID：{{submission.id}}\\n受付日時：{{submission.submitted_at}}\\n\\n{{fields.summary}}\\n\\n{{confirm_url.ack}}"
      }
    }
  },
  "A-05_examples": {
    "hidden_field_retention_example": {
      "scenario": "department was entered then hidden; still need to keep value",
      "approach": "configure retention exception rule for field_key=department"
    },
    "notification_resend_example": {
      "scenario": "user did not receive email; resend",
      "approach": "system_admin triggers resend; queued; audit logged"
    },
    "pdf_regeneration_example": {
      "policy": "default forbidden",
      "allowed_when": "defined operationally (e.g., wrong template)",
      "actor": "system_admin (or root when root-only configured)",
      "execution": "async with audit"
    }
  },
  "A-06_condition_branch_rules": {
    "source": "Basic Spec v1.0 Appendix D (reconstructed)",
    "applies_to": [
      "visibility_rule",
      "required_rule",
      "step_transition_rule"
    ],
    "conventions": {
      "explicit_logical_ops": true,
      "undefined_field_key": "configuration_error",
      "fallback_on_failure": [
        "hide",
        "not_required",
        "deny_transition"
      ]
    },
    "format": {
      "version": "1",
      "op": "and|or|not|comparison",
      "items": "required for and/or",
      "field": "target field_key",
      "value": "comparison value"
    },
    "operators": [
      "eq",
      "ne",
      "in",
      "contains",
      "gt",
      "gte",
      "lt",
      "lte",
      "between",
      "exists",
      "and",
      "or",
      "not"
    ],
    "examples": {
      "visibility_rule": {
        "version": "1",
        "op": "eq",
        "field": "category",
        "value": "inq"
      },
      "required_rule": {
        "version": "1",
        "op": "exists",
        "field": "company_name",
        "value": true
      },
      "step_transition_rule": {
        "version": "1",
        "op": "eq",
        "field": "terms",
        "value": true
      }
    },
    "apply": {
      "visibility_false": "hide_and_do_not_store",
      "required_false": "not_required",
      "transition_false": "deny_with_error"
    },
    "delegation": {
      "ui": "06.UI Spec",
      "api": "03.API Spec"
    }
  },
  "revision": [
    {
      "version": "1.1",
      "date": "2026-01-13",
      "description": "Added A-06 (reconstructed from Basic Spec v1.0 Appendix D). Added practical samples to A-01/A-03/A-04."
    },
    {
      "version": "1.0",
      "date": "2026-01-12",
      "description": "Initial release."
    }
  ]
}
```

## OTHER-0016 reforma-notes-v1.1.0

- component_version: `v1.1.0`
- component_file: `classified/notes/reforma-notes-v1.1.0.json`
- source_files: `latest/other/reforma-notes-v1.1.0.txt`

最初に、添付の「共通仕様 正本（v1.3）」と OpenAPI / root-only policy を必ず読み込んでください。
記載内容以外の前提を勝手に追加せず、共通仕様を最優先して実装・調整してください。

【必読（正本）】
1. reforma-frontend-common-ui-spec-v1.3.json（画面共通仕様・確定版/単一正本）
2. openapi-reforma-v1.1-full.updated.yaml（OpenAPI 正本）
3. reforma-root-only-policy-v1.0.json（root-only policy 正本）

【優先順位（矛盾が出た場合）】
共通画面仕様 v1.3 ＞ 画面仕様書 ＞ API仕様書
※ 画面要件を満たすために API 側を調整する方針

【フロント側の前提（共通仕様 v1.3 の要点）】
- 認証/権限の正本は /auth/me
  - RBAC：roles[]
  - root-only：is_root
- root-only の拒否は 403 + errors.reason=ROOT_ONLY を必須（通常403と区別表示する）
- APIエラー（非422）の正規化：
  - 基本エラーページ：/reforma/error
  - 400/403/409：トーストで表示する想定
  - 500/503：エラーページへ遷移する想定
  - raw error は Debug UI（VITE_DEBUG=true の時のみ）に出す。通常画面には出さない。
- 破壊的操作（削除等）は確認ダイアログ必須。
  - root権限のみ実行可能な削除は「対象ID入力（完全一致）」を必須とする。
- CSV/PDF/ファイル操作は進捗表示（プログレスバー）を前提とするため、可能なら進捗取得エンドポイント等を用意してほしい。
- 日時/数値/IDの扱い（宣言）：
  - 日時：APIはISO8601（UTCまたはTZ明示）、表示整形はフロント
  - 数値：APIは生値、表示整形はフロント
  - ID：表示は生値、比較は完全一致（root削除確認に利用）

【今回の依頼（バックエンド側と調整したいこと）】
1) S-02 アカウント一覧（/v1/system/admin-users）の完成に向けた最終すり合わせ
   - page/per_page 必須、sort enum、q/role/status 等（OpenAPI 正本準拠）
2) 進捗表示が必要な処理（CSV/PDF/ファイル）の進捗取得方式（推奨：progress endpoint）
3) エラー構造（errors.reason / code / message 等）の確定（/reforma/error とトースト表示の分岐に必要）

不明点・矛盾・調整が必要な点が出た場合は、必ず指摘し、仕様（v1.3）側へフィードバックしてください。

